var Ct=Object.defineProperty;var Et=(s,t,a)=>t in s?Ct(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var K=(s,t,a)=>Et(s,typeof t!="symbol"?t+"":t,a);import{j as e,m as C,r as o,A as Q,X as I,H as qt,D as dt,C as ht,S as Ft,M as At,a as Ee,L as ut,U as Ue,b as qe,g as st,i as Dt,c as Ot,d as Lt,e as Tt,f as zt,o as mt,h as $t,k as It,l as Pt,t as Ut,n as Rt,V as xt,E as pt,T as Fe,R as Mt,p as he,q as oe,P as de,s as Wt,u as Je,v as Bt,w as Ht,x as Gt,F as Vt,y as Yt,z as Re,B as Kt,G as Qt,I as ee,J as ce,K as Ge,N as xe,O as Ie,Q as pe,W as at,Y as rt,Z as je,_ as Oe,$ as Jt,a0 as it,a1 as Zt,a2 as Xt,a3 as gt,a4 as es,a5 as ts,a6 as ss,a7 as as,a8 as rs,a9 as is,aa as ns}from"./vendor-jUcWw3zO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();const le=({onClick:s,children:t,variant:a="light",glowColor:r="none",isInteractive:i=!1,isSelected:c=!1,className:n="",...l})=>{const h="rounded-lg backdrop-blur-md transition-all",m={light:"bg-white/5",dark:"bg-space-dark/80",darker:"bg-space-darker/90"},d={none:"",blue:"shadow-neon-blue",red:"shadow-neon-red",yellow:"shadow-neon-yellow"},g=i?"cursor-pointer hover:bg-white/10":"",w=c?"bg-white/10 border-blue-400":"border-white/10";return e.jsx(C.div,{onClick:s,...l,className:`
        ${h}
        ${m[a]}
        ${d[r]}
        ${g}
        ${w}
        ${n}
      `,children:t})};function ls({isOpen:s,onClose:t}){const[a,r]=o.useState("idle"),[i,c]=o.useState(""),n=async l=>{l.preventDefault(),r("sending"),c("");try{const h=l.target,m=new FormData(h);if((await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({"form-name":"contact",...Object.fromEntries(m)}).toString()})).ok)r("sent"),h.reset(),setTimeout(()=>{r("idle")},3e3);else throw new Error("Form submission failed")}catch(h){console.error("Submission error:",h),r("error"),c("Failed to send message. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{name:"contact","data-netlify":"true","data-netlify-honeypot":"bot-field",hidden:!0,children:[e.jsx("input",{type:"text",name:"name"}),e.jsx("input",{type:"email",name:"email"}),e.jsx("textarea",{name:"message"}),e.jsx("input",{name:"bot-field"})]}),e.jsx(Q,{children:s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs(C.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative w-full max-w-lg mx-4 bg-space-darker rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"relative p-6 border-b border-white/10 bg-gradient-to-r from-blue-500/10 to-purple-500/10",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsxs("div",{className:"relative flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-orbitron text-white",children:"Welcome to SWGOH TW Counter"}),e.jsx("button",{onClick:t,className:"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-auto max-h-[500px]",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(qt,{className:"w-6 h-6 text-red-400 flex-shrink-0 mt-1"}),e.jsx("p",{className:"text-white/80",children:"This website is a passion project, built and maintained without any profit motive. Our mission is to help SWGOH players optimize their Territory Wars strategy."})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(dt,{className:"w-6 h-6 text-blue-400 flex-shrink-0 mt-1"}),e.jsx("p",{className:"text-white/80",children:"While the site is free to use, there are ongoing costs for domain hosting and database maintenance. Your support helps keep this resource available to the community."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Have any questions or suggestions? Feel free to drop a message:"}),e.jsxs("form",{name:"contact",method:"POST","data-netlify":"true","data-netlify-honeypot":"bot-field",onSubmit:n,className:"space-y-4",children:[e.jsx("input",{type:"hidden",name:"form-name",value:"contact"}),e.jsx("div",{hidden:!0,children:e.jsx("input",{name:"bot-field"})}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("label",{htmlFor:"name",className:"text-white/80",children:"Your Name"}),e.jsx("input",{type:"text",name:"name",id:"name",required:!0,className:"p-2 bg-transparent border border-white/30 text-white rounded-lg",placeholder:"Your Name"})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-white/80",children:"Your Email"}),e.jsx("input",{type:"email",name:"email",id:"email",required:!0,className:"p-2 bg-transparent border border-white/30 text-white rounded-lg",placeholder:"Your Email"})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("label",{htmlFor:"message",className:"text-white/80",children:"Your Message"}),e.jsx("textarea",{name:"message",id:"message",required:!0,className:"p-2 bg-transparent border border-white/30 text-white rounded-lg",placeholder:"Your Message"})]}),e.jsx("button",{type:"submit",className:"px-6 py-3 mt-4 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-all",disabled:a==="sending",children:a==="sending"?"Sending...":"Send Message"})]}),a==="sent"&&e.jsx("p",{className:"mt-4 text-green-500",children:"Thank you for your message! We will get back to you soon."}),a==="error"&&e.jsx("p",{className:"mt-4 text-red-500",children:i})]})]}),e.jsx("div",{className:"p-2 bg-white/5 flex items-center justify-center gap-1",children:e.jsxs("a",{href:"https://www.buymeacoffee.com/jbrannelid",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-1 px-4 py-2 rounded-lg bg-[#FFDD00] text-black hover:bg-[#FFDD00]/90 transition-all text-sm",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:block",children:"Support the Project"})]})})]})})})]})}const os=({isAdmin:s,onLogout:t,onAdminClick:a})=>{const[r,i]=o.useState(!1);return e.jsxs("div",{children:[e.jsx(le,{variant:"darker",className:"sticky top-0 z-50 py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"w-6 h-6 text-yellow-400"}),e.jsx("h1",{className:"text-xl font-orbitron text-white"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:"https://www.buymeacoffee.com/jbrannelid",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[#FFDD00] hover:bg-[#FFDD00]/90 text-black transition-all",children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 transition-all",children:[e.jsx(At,{className:"w-5 h-5"}),"Contact"]}),s?e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-all",children:[e.jsx(ut,{className:"w-5 h-5"}),"Logout"]}):e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 transition-all",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Admin"]})]})]})})}),e.jsx(ls,{isOpen:r,onClose:()=>i(!1)})]})},cs=({activeView:s,onViewChange:t,onOptionsClick:a,filters:r,children:i})=>{const c=!!(r.alignment||r.showTWOmicronOnly||r.showHardCounters||r.excludeGL);return e.jsx(le,{variant:"darker",className:"sticky top-0 z-30 py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"relative flex-1",children:i}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(le,{variant:"light",glowColor:s==="squads"?"blue":"none",isInteractive:!0,isSelected:s==="squads",onClick:()=>t("squads"),className:"flex items-center gap-2 px-6 py-2.5",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(Ue,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Squads"})]}),e.jsxs(le,{variant:"light",glowColor:s==="fleets"?"blue":"none",isInteractive:!0,isSelected:s==="fleets",onClick:()=>t("fleets"),className:"flex items-center gap-2 px-6 py-2.5",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Fleets"})]}),e.jsxs(le,{variant:"light",glowColor:c?"blue":"none",isInteractive:!0,isSelected:c,onClick:a,className:"flex items-center gap-2 px-6 py-2.5",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(Ee,{className:`w-5 h-5 ${c?"text-blue-400":""}`}),e.jsx("span",{className:"font-medium",children:"Filters"}),c&&e.jsx(C.div,{className:"w-2 h-2 rounded-full bg-blue-400",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30}})]})]})]})})})},be={apiKey:"AIzaSyB5RqeXVGSF0nB-3Y7hsiChamqdf7XMRv8",authDomain:"swgoh-tw-guide.firebaseapp.com",projectId:"swgoh-tw-guide",storageBucket:"swgoh-tw-guide.firebasestorage.app",messagingSenderId:"25054528199",appId:"1:25054528199:web:9154ba45e0d0b79f1ab4e2"};if(!be.apiKey)throw new Error("Firebase API Key is missing");if(!be.authDomain)throw new Error("Firebase Auth Domain is missing");if(!be.projectId)throw new Error("Firebase Project ID is missing");if(!be.storageBucket)throw new Error("Firebase Storage Bucket is missing");if(!be.messagingSenderId)throw new Error("Firebase Messaging Sender ID is missing");if(!be.appId)throw new Error("Firebase App ID is missing");const me=class me{constructor(){K(this,"app");K(this,"_auth");K(this,"_db");K(this,"_storage");K(this,"initialized",!1);K(this,"initError",null);K(this,"initializationPromise");this.app=st().length===0?Dt(be):st()[0],this._auth=Ot(this.app),this._db=Lt(this.app,{cacheSizeBytes:$t,experimentalForceLongPolling:!0}),this._storage=Tt(this.app),this.initializationPromise=this.initialize()}async initialize(){try{await this.setupPersistence(),this.setupAuthStateMonitoring(),this.initialized=!0}catch(t){throw this.initError=t,t}}async setupPersistence(){try{await zt(this._db),console.log("Offline persistence enabled")}catch(t){if(t instanceof Error&&"code"in t)switch(t.code){case"failed-precondition":console.warn("Multiple tabs open, persistence can only be enabled in one tab at a time.");break;case"unimplemented":console.warn("The current browser does not support offline persistence.");break;default:console.error("Error enabling offline persistence:",t)}else console.error("Unknown error enabling offline persistence:",t)}}setupAuthStateMonitoring(){mt(this._auth,t=>{t?console.log("User is signed in:",t.uid):console.log("User is signed out")},t=>{console.error("Auth state change error:",t)})}connectToEmulators(){}static getInstance(){return me.instance||(me.instance=new me),me.instance}get auth(){if(this.initError)throw this.initError;return this._auth}get db(){if(this.initError)throw this.initError;return this._db}get storage(){if(this.initError)throw this.initError;return this._storage}get isInitialized(){return this.initialized&&!this.initError}async waitForInitialization(){return this.initializationPromise}async reconnect(){return(!this.initialized||this.initError)&&(this.initError=null,this.initialized=!1,this.initializationPromise=this.initialize()),this.initializationPromise}};K(me,"instance");let Ke=me;const Me=Ke.getInstance(),_e=Me.auth,U=Me.db,ds=Me.storage,ft=()=>Me.waitForInitialization(),hs={triple_zero:"triplezero",fifty_rt:"50rt",arc_trooper:"trooperclone_arc",aayla_secura:"aaylasecura",admiral_ackbar:"ackbaradmiral",admiral_piett:"piett",admiral_raddus:"admiralraddus",admiral_trench:"admiraltrench",ahsoka_fulcrum:"ahsokaadult",ahsoka_snips:"ahsoka",amilyn_holdo:"holdo",asajj_ventress:"ventress",aurra_sing:"aurrasing",b1_battle_droid:"b1",b2_super_battle_droid:"b2",bb_8:"bb8",battle_droid_1:"bt1",barriss_offee:"barriss_light",bastila_shan:"bastilashan",bastila_fallen:"bastilashan_dark",baylan_skoll:"baylanskoll",baze_malbus:"bazemalbus",ben_solo:"bensolo",biggs:"rebelpilot_biggs",bistan:"bistan",bo_katan_mandalore:"mandalorbokatan",bo_katan_kryze:"bokatan",boba_fett:"bobafett",boba_fett_scion:"bobafettold",bodhi_rook:"bodhi",boss_nass:"bossnass",bossk:"bossk",boushh_leia:"boushh",c3po:"c3po",cc_2224_cody:"trooperclone_cody",ct_21_0408_echo:"trooperclone_echo",ct_5555_fives:"trooperclone_fives",ct_7567_rex:"trooperclone_rex",cad_bane:"cadbane",cal_kestis:"calkestis",canderous_ordo:"canderous",captain_drogan:"captaindrogan",captain_enoch:"captainenoch",captain_han_solo:"hoth_han",captain_phasma:"phasma",captain_rex:"captainrex",captain_tarpals:"captaintarpals",cara_dune:"caradune",carth_onasi:"carth",cassian_andor:"cassian",cera_junda:"cerejunda",chewbacca_ot:"chewbacca_ot",chief_chirpa:"ewok_chirpa",chief_nebit:"jawa_nebit",chirrut_imwe:"chirrut",chopper:"chopper",clone_sergeant:"trooperclonegreen",clone_chewbacca:"chewbacca",colonel_stark:"colonel_stark",commander_ahsoka:"commanderahsokatano",lukebespin:"lukebespin",coruscant_police:"coruscantpolice",count_dooku:"dooku",old_daka:"daka",dark_trooper:"darktrooper",dark_trooper_moff:"moffgideons3",darth_bane:"darthbane",darth_malak:"darthmalak",darth_malgus:"darthmalgus",darth_maul:"maul",darth_nihilus:"nihilus",darth_revan:"sithrevan",darth_sidious:"sidious",darth_sion:"sion",darth_talon:"darthtalon",darth_traya:"traya",darth_vader:"vader",dash_rendar:"dashrendar",dathcha:"jawa_dathcha",death_trooper_peridea:"deathtrooperperidea",death_trooper:"trooperdeath",dengar:"dengar",director_krennic:"krennic",doctor_aphra:"doctoraphra",droideka:"droideka",echo:"bb_echo",eeth_koth:"eethkoth",eighth_brother:"eighthbrother",embo:"embo",emperor_palpatine:"palpatineemperor",enfy_nest:"enfys",ewok_elder:"ewok_chief",ewok_scout:"ewok_scout",ezra_bridger:"ezra_s3",ezra_exile:"ezraexile",fennec_shand:"fennec",fifth_brother:"fifthbrother",finn:"finnjakku",fo_executioner:"firstorder_executioner",fo_officer:"firstorderofficer",fo_sf_tie_pilot:"firstorder_pilot",fo_stormtrooper:"firstordertrooper",fo_tie_pilot:"firstordertiepilot",gamorrean_guard:"gamorreanguard",gar_saxon:"gar_saxon",garazeb_zeb:"zeb_s3",general_grievous:"grievous",general_hux:"generalhux",general_kenobi:"obiwangeneral",general_skywalker:"generalanakin",general_veers:"veers",geonosian_brood_alpha:"geonosian_broodalpha",geonosian_soldier:"geonosian_soldier",geonosian_spy:"geonosian_spy",grand_admiral_thrawn:"thrawn",grand_inquisitor:"grandinquisitor",grand_master_yoda:"yodagrandmaster",grand_moff_tarkin:"tarkinadmiral",great_mothers:"greatmothers",greef_karga:"greefkarga",greedo:"greedo",gungan_bombardier:"gunganboomadier",gungan_phalanx:"gunganphalanx",hk_47:"hk47",han:"han",hera_syndulla:"hera_s3",hermit_yoda:"yodahermit",hondo_ohnaka:"hondoohnaka",hoth_rebel_scout:"rebelhothscout",hoth_rebel_soldier:"rebelhoth",hunter:"bb_hunter",ig_100_magnaguard:"magnaguard",ig_11:"ig11_nurse",ig_12_grogu:"ig12",ig_86:"ig86",ig_88:"ig88",iden_versio:"idenversioempire",ima_gun_di:"imagundi",imperial_probe_droid:"probedroid",imperial_super_commando:"imperial_super_commando",jabba_the_hutt:"jabbathehutt",jango_fett:"jangofett",jar_jar_binks:"jarjarbinks",jawa:"jawa_jawa",jawa_engineer:"jawa_engineer",jawa_scavenger:"jawa_scavenger",jedi_consular:"jedi_consular_03",jedi_knight_anakin:"anakinjedi",jedi_knight_guardian:"jedi_guardian_01",jedi_knight_cal_kestis:"jediknightcal",jedi_knight_luke:"luke_jediknight",jedi_knight_revan:"jedirevan",jedi_master_kenobi:"globiwan",jedi_master_luke:"luke_jml",jolee_bindo:"joleebindo",juhani:"juhani",jyn_erso:"jyn",k_2so:"k2so",kanan_jarrus:"kanan_s3",kelleran_beq:"kelleranbeq",ki_adi_mundi:"kiadimundi",kit_fisto:"kitfisto",krrsantan:"krrsantan",kuiil:"kuiil",kyle_katarn:"kylekatarn",kylo_ren:"kyloren",kylo_ren_unmasked:"kylo_unmasked",l3_37:"l337",lando_calrissian:"landobespin",leia_organa:"leiaendor",lobot:"lobot",logray:"ewok_logray",lord_vader:"lordvader",luke_farmboy:"luke_ep4",luminara_unduli:"luminara",luthen_rael:"luthenrael",mace_windu:"macewindu",magmatrooper:"trooperstorm_magma",mara_jade:"marajade",marrok:"marrok",master_qui_gon:"masterquigon",maul:"maul_cyborg",merrin:"merrin",mission_vao:"mission",mob_enforcer:"mob_enforcer",moff_gideon:"moffgideon",mon_mothma:"monmothma",morgan_elsbeth:"morganelsbeth",mother_talzin:"nightsisters_talzin",night_trooper:"nighttrooper_a",nightsister_acolyte:"nightsister_acolyte",nightsister_initiate:"nightsister_initiate",nightsister_spirit:"nightsisters_wraith",nightsister_zombie:"nightsisters_zombie",ninth_sister:"ninthsister",nute_gunray:"nutegunray",obi_wan_old_ben:"obiwanep4",omega:"badbatchomega",padawan_obiwan:"padawanobiwan",padawan_sabine:"padawansabine",padme_amidala:"padme_geonosis",pao:"pao",paploo:"ewok_paploo",paz_vizsla:"pazvizsla",plo_koon:"plokoon",poe_dameron:"poe",poggle_the_lesser:"geonosian_poggle",princess_kneesaa:"princesskneesaa",princess_leia:"leia_princess",qira:"qira",queen_amidala:"queenamidala",qui_gon_jinn:"quigon",r2_d2:"r2d2",range_trooper:"trooperranger",rebel_officer_leia:"leiahoth",resistance_hero_finn:"finn",resistance_hero_poe:"poe_tros",resistance_pilot:"resistancepilot",resistance_trooper:"resistancetrooper",rey_gl:"reyjakku",rey_jedi_training:"rey_tlj",rey_scavenger:"rey_tros",rose_tico:"rose",royal_guard:"royalguard",sabine_wren:"sabine_s3",sana_starros:"sanastarros",savage_opress:"savageopress",saw_gerrera:"sawgerrera",scarif_rebel_pathfinder:"rebel_scarif",scout_trooper:"trooperscout",second_sister:"secondsister",seventh_sister:"seventhsister",shaak_ti:"shaakti",shin_hati:"shinhati",shoretrooper:"troopershore",sith_assassin:"sithassassin",sith_empire_trooper:"sithtrooper",sith_eternal_emperor:"espalpatine_pre",sith_marauder:"sithmarauder",sith_trooper:"firstorder_sithtrooper",skiff_guard_lando:"undercoverlando",snowtrooper:"troopersnow",stap:"stap",starkiller:"starkiller",stormtrooper:"trooperstorm",stormtrooper_han:"trooperstorm_han",sun_fac:"geonosian_sunfac",supreme_leader_kylo:"kyloren_tros",t3_m4:"t3m4",talia:"talia",tarfful:"tarfful",taron_malicos:"taronmalicos",tech:"bb_tech",teebo:"ewok_teebo",the_armorer:"armorer",the_mandalorian:"mandalorian",the_mandalorian_beskar:"mandobeskar",third_sister:"thirdsister",chewbacca_c3po:"chewbacca_c3po",tusken_chieftain:"tuskenchieftain",tusken_raider:"tuskenraider",tusken_shaman:"tuskenshaman",tusken_warrior:"tuskenhuntress",urorrurrr:"urorrurrr",ugnaught:"ugnaught",vandor_chewbacca:"chewbacca_vandor",veteran_smuggler_han:"tfa_han",visas_marr:"visas",wampa:"wampa",wat_tambor:"wattambor",wedge_antilles:"rebelpilot_wedge",wicket:"ewok_wicket",wrecker:"bb_wrecker",young_han_solo:"han_young",young_lando:"younglando",zaalbar:"zaalbar",zam_wesell:"zamwesell",zorii_bliss:"zoriibliss"},us={chimaera:"chimaera",endurance:"venator",executor:"executor",executrix:"stardestroyer",finalizer:"finalizer",home_one:"moncalamarilibertycruiser",profundity:"profundity",leviathan:"leviathan",negotiator:"negotiator",malevolence:"malevolence",furyclassinterceptor:"furyclassinterceptor",ahsoka_tanos_jedi_starfighter:"jedi_fighter_ahsoka",anakins_eta2:"jedi_fighter_anakin",b28:"b28extinctionclassbomber",btl_b_y_wing:"ywing_btlb",biggs_darklighter_x_wing:"xwing_red3",bistan_u_wing:"uwing",cassians_u_wing:"uwing_hero",clone_sergeants_arc_170:"arc170",comeuppance:"comeuppance",ebon_hawk:"ebonhawk",emperors_shuttle:"imperialshuttle",first_order_sf_tie_fighter:"fosf_tie_fighter",first_order_tie_fighter:"firstorder_tiefighter",fury_class_interceptor:"furyclassinterceptor",fives_umbaran_starfighter:"umbaran_star_fighter",gauntlet_starfighter:"gauntlet",geonosian_soldier_starfighter:"geonosis_fighter_soldier",geonosian_spy_starfighter:"geonosis_fighter_spy",ghost:"ghost",hans_millennium_falcon:"mfalcon",hounds_tooth:"houndstooth",hyena_bomber:"hyenabomber",ig2000:"ig2000",imperial_tie_bomber:"tiebomber",imperial_tie_fighter:"tiefighter",jedi_consulars_starfighter:"jedi_fighter",kylo_ren_command_shuttle:"upsilon_shuttle_kylo",lando_millennium_falcon:"mil_fal_pristine",mg_100_starfortress:"mg100",marauder:"marauder",mark_v1_interceptor:"sithsupremacyclass",outrider:"outrider",phantom:"phantom2",plo_koons_jedi_starfighter:"jedi_fighter_bladeofdorin",razor_crest:"razorcrest",rexs_arc_170:"arc170_02",scimitar:"sithinfiltrator",sithsupremacyclass:"sithsupremacyclass",slave_1:"slave1",sun_facs_geonosian_starfighter:"geonosis_fighter_sunfac",tie_advanced_x1:"tieadvanced",tie_interceptor:"tie_interceptor_prototype",umbaran_starfighter:"umbaran_star_fighter",vulture_droid:"vulturedroid",xanadu_blood:"xanadublood",rebel_y_wing:"ywing"},Le=(s,...t)=>{console.debug(`[ImageMapping] ${s}`,...t)},ge=s=>s?s.toLowerCase().replace(/[']/g,"").replace(/[^a-z0-9_\s-]/g,"").trim().replace(/[\s-]+/g,"_"):"";function ms(s,t){if(!s)return Le("No ID provided for image"),"";const a=ge(s);Le(`Normalized ID: ${a} from ${s}`);const r=t.includes("ship")?us:hs,i=r[a];return i||(Le(`No mapping found for ID: ${s}, normalized: ${a}, type: ${t}`),Le("Available mappings:",Object.keys(r)),a)}const xs="/assets",Ve="/placeholder.png",Te=new Map,ze=new Map,ps={xs:{width:32,height:32,containerClass:"w-8 h-8"},sm:{width:40,height:40,containerClass:"w-10 h-10"},md:{width:48,height:48,containerClass:"w-12 h-12"},lg:{width:64,height:64,containerClass:"w-16 h-16"},xl:{width:80,height:80,containerClass:"w-20 h-20"}},Ye=(s,...t)=>{},nt=s=>{const{width:t,height:a}=ps[s];return`data:image/svg+xml;charset=utf-8,<svg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${a}' viewBox='0 0 ${t} ${a}'><rect width='100%' height='100%' fill='%231a1e27'/></svg>`},Qe=async(s,t)=>{if(!s)return Ve;const a=`${s}-${t}`;if(Te.has(a))return Te.get(a);if(ze.has(a))return ze.get(a);const r=(async()=>{try{const i=ms(s,t);if(!i)return Ye(`No mapping found for ${s} (${t})`),Ve;const n=`${t.includes("ship")?"ships":"characters"}/${i}.webp`;try{const l=It(ds,n),h=await Pt(l);return Te.set(a,h),Ye(`Successfully loaded Firebase image for ${s}`),h}catch{const h=`${xs}/${n}`;return Te.set(a,h),Ye(`Using local path: ${h}`),h}}catch(i){return console.error(`Failed to load image for ${s}:`,i),Ve}finally{ze.delete(a)}})();return ze.set(a,r),r};function fe(...s){return Ut(Rt(s))}const $e={},gs={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},D=o.memo(({id:s,name:t,type:a,size:r="md",className:i="",withTooltip:c=!0,isLeader:n=!1,isCapital:l=!1,onLoad:h})=>{const[m,d]=o.useState(()=>$e[s]||nt(r)),[g,w]=o.useState(!0),[p,f]=o.useState(!1),b=o.useMemo(()=>gs[r],[r]);return o.useEffect(()=>{let _=!0;return(async()=>{if($e[s]){d($e[s]),w(!1);return}try{const u=await Qe(s,a);_&&($e[s]=u,d(u),f(!1))}catch(u){_&&(console.error(`Error loading image for ${s}:`,u),f(!0))}finally{_&&w(!1)}})(),()=>{_=!1}},[s,a]),e.jsxs("div",{className:fe("relative","transition-all duration-300 ease-out",b,i),children:[e.jsx("img",{src:m,alt:t,className:fe("w-full h-full","object-cover rounded-full","transition-opacity duration-300",g?"opacity-0 blur-md":"opacity-100",p?"grayscale opacity-50":""),loading:"lazy",onLoad:h,onError:()=>{f(!0),d(nt(r))}}),(n||l)&&e.jsx("div",{className:`absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full \r
                   flex items-center justify-center text-white text-xs font-bold\r
                   shadow-md`,children:n?"L":"C"}),c&&e.jsx("div",{className:`absolute -bottom-6 left-1/2 transform -translate-x-1/2 \r
                     bg-black/90 px-2 py-1 rounded text-xs text-white whitespace-nowrap \r
                     opacity-0 group-hover:opacity-100 transition-opacity z-10`,children:t})]})});D.displayName="UnitImage";const bt=({videoUrl:s})=>{const t=a=>{a.stopPropagation(),window.open(s,"_blank")};return e.jsxs("button",{onClick:t,className:`flex items-center gap-2 px-2 py-1 rounded-full bg-red-500/20 text-red-400 \r
                 hover:bg-red-500/30 transition-colors text-sm`,children:[e.jsx(xt,{className:"w-4 h-4"}),"  ",e.jsx("span",{children:"Watch Guide"})]})},wt=o.memo(({squad:s,isSelected:t,onSelect:a,counters:r,isAdmin:i,onDeleteCounter:c,isFiltered:n=!1})=>{if(o.useState(!1),console.log("Full squad data:",s),!s||!s.characters||!Array.isArray(s.characters))return console.error("Invalid squad data:",s),null;const l=Array.isArray(r)?r:[];return e.jsx(pt,{fallback:e.jsx(le,{variant:"dark",className:"p-4",children:e.jsx("div",{className:"text-red-400",children:"Error loading squad card"})}),children:e.jsx("div",{onClick:()=>a(),children:e.jsx(le,{variant:"dark",glowColor:s.alignment==="light"?"blue":"red",isSelected:t,className:`transition-all duration-300 ease-out hover:scale-[1.01] ${n?"opacity-100":"opacity-50"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-orbitron text-white flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-blue-400"}),s.name]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs
                    ${s.alignment==="light"?"bg-blue-500/20 text-blue-400":"bg-red-500/20 text-red-400"}`,children:s.alignment==="light"?"Light Side":"Dark Side"}),s.twOmicronRequired&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400",children:"TW Omicron"})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4",children:[s.leader&&e.jsx("div",{className:"relative group",children:e.jsx(D,{id:s.leader.id,name:s.leader.name,type:"squad-leader",size:"md",className:"rounded-full border-2 border-blue-400",withTooltip:!0,isLeader:!0})}),s.characters.map(h=>e.jsx("div",{className:"relative group",children:e.jsx(D,{id:h.id,name:h.name,type:"squad-member",size:"md",className:"rounded-full border-2 border-white/20",withTooltip:!0})},h.id))]}),e.jsx(Q,{children:t&&l.length>0&&e.jsxs(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-6 space-y-4 overflow-hidden",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Counters"}),l.map(h=>!h||!h.counterSquad?null:e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs
                              ${h.counterType==="hard"?"bg-green-500/20 text-green-400":h.counterType==="soft"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:h.counterType.charAt(0).toUpperCase()+h.counterType.slice(1)}),h.twOmicronRequired&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400",children:"TW Omni"}),h.video_url&&e.jsx(bt,{videoUrl:h.video_url})]}),i&&c&&e.jsx("button",{onClick:m=>{m.stopPropagation(),c(h.id)},className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"mt-2 text-white/70",children:h.description}),"characters"in h.counterSquad&&e.jsxs("div",{className:"flex items-center gap-2",children:[h.counterSquad.leader&&e.jsx(D,{id:h.counterSquad.leader.id,name:h.counterSquad.leader.name,type:"squad-leader",size:"sm",className:"border-2 border-blue-400"}),h.counterSquad.characters.map(m=>e.jsx(D,{id:m.id,name:m.name,type:"squad-member",size:"sm",className:"border-2 border-white/20"},m.id))]})]},h.id))]})})]})})})})});wt.displayName="SquadCard";class Ae extends Mt.Component{constructor(a){super(a);K(this,"handleReset",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}render(){var a;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-[200px] flex items-center justify-center",children:e.jsx("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4",children:((a=this.state.error)==null?void 0:a.message)||"An unexpected error occurred"}),e.jsxs("button",{onClick:this.handleReset,className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                           bg-red-500/20 text-red-400 hover:bg-red-500/30 \r
                           transition-colors`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Try Again"]})]})]})})}):this.props.children}}const fs=({squads:s,filteredSquads:t,selectedSquadId:a,onSelectSquad:r,getCounters:i,isAdmin:c,onDeleteCounter:n,onViewDetails:l})=>{const h=d=>{r(a===d?null:d)},m=o.useMemo(()=>t.map(d=>e.jsx(C.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(wt,{squad:d,isSelected:a===d.id,onSelect:()=>h(d.id),counters:i(d.id),isFiltered:!0,isAdmin:c,onDeleteCounter:n,onViewDetails:l})},d.id)),[t,a,i,c,n,l]);return!s||s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-white/60",children:[e.jsx(Ue,{className:"w-12 h-12 mb-4 animate-float"}),e.jsx("p",{className:"text-lg",children:"No squads found"})]}):e.jsx(Ae,{fallback:e.jsx("div",{className:"flex flex-col items-center justify-center p-8",children:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Failed to load squads"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4",children:"Please try refreshing the page"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                       bg-red-500/20 text-red-400 hover:bg-red-500/30`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Refresh"]})]})}),children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsx(Q,{mode:"popLayout",children:m})})})},jt=o.memo(({fleet:s,isSelected:t,onSelect:a,counters:r,isAdmin:i,onDeleteCounter:c,isFiltered:n=!1,onAddCounter:l})=>{o.useState(!1);const h=o.useRef(null);console.log("Full fleet data:",s);const m=r.filter(d=>{var f;const g=d.targetSquad.id===s.id,w=d.counterSquad.id===s.id,p="capitalShip"in d.targetSquad&&((f=d.targetSquad.capitalShip)==null?void 0:f.id)===s.id;return g||w||p});return e.jsx(pt,{fallback:e.jsx(le,{variant:"dark",className:"p-4",children:e.jsx("div",{className:"text-red-400",children:"Error loading fleet card"})}),children:e.jsx(le,{variant:"dark",glowColor:s.alignment==="light"?"blue":"red",isInteractive:!0,isSelected:t,onClick:()=>{a()},className:`transition-all duration-300 ease-out hover:scale-[1.01] ${n?"opacity-100":"opacity-50"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-orbitron text-white flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-400"}),s.name]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs
                  ${s.alignment==="light"?"bg-blue-500/20 text-blue-400":"bg-red-500/20 text-red-400"}`,children:s.alignment==="light"?"Light Side":"Dark Side"})})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4",children:[s.capitalShip&&e.jsx(D,{id:s.capitalShip.id,name:s.capitalShip.name,type:"capital-ship",size:"md",className:"rounded-full border-2 border-blue-400",withTooltip:!0,isCapital:!0}),s.startingLineup.map(d=>e.jsx(D,{id:d.id,name:d.name,type:"ship",size:"md",className:"rounded-full border-2 border-white/20",withTooltip:!0},d.id)),s.reinforcements.map(d=>e.jsx("div",{className:"relative group opacity-75",children:e.jsx("div",{className:"relative",children:e.jsx(D,{id:d.id,name:d.name,type:"ship",size:"md",className:"rounded-full border-2 border-white/20",withTooltip:!0})})},d.id))]}),s.callOrder&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-400 mb-1",children:"Call Order"}),e.jsx("p",{className:"text-sm text-white/70",children:s.callOrder})]}),e.jsx(Q,{children:t&&m.length>0&&e.jsxs(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-6 space-y-4 overflow-hidden",ref:h,children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Counters"}),m.map(d=>e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs
                          ${d.counterType==="hard"?"bg-green-500/20 text-green-400":d.counterType==="soft"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:d.counterType.charAt(0).toUpperCase()+d.counterType.slice(1)}),d.video_url&&e.jsx(bt,{videoUrl:d.video_url})]}),i&&c&&e.jsx("button",{onClick:()=>c(d.id),className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-white/70",children:d.description}),"capitalShip"in d.counterSquad&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d.counterSquad.capitalShip&&e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:d.counterSquad.capitalShip.id,name:d.counterSquad.capitalShip.name,type:"capital-ship",size:"sm",className:"border-2 border-blue-400"}),e.jsx("div",{className:`absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full \r
                       flex items-center justify-center text-white text-xs`,children:"C"})]}),d.counterSquad.startingLineup.map(g=>e.jsx(D,{id:g.id,name:g.name,type:"ship",size:"sm",className:"border-2 border-white/20"},g.id)),d.counterSquad.reinforcements.map(g=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:g.id,name:g.name,type:"ship",size:"sm",className:"border-2 border-white/20 opacity-75"}),e.jsx("div",{className:`absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full \r
                       flex items-center justify-center text-white text-xs`,children:"R"})]},g.id))]})}),d.strategy.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-white/80",children:"Strategy:"}),e.jsx("div",{className:"space-y-3",children:d.strategy.map((g,w)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:`flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 text-blue-400 \r
                                            flex items-center justify-center text-sm`,children:w+1}),e.jsx("p",{className:"text-sm text-white/70",children:g.description})]},g.key))})]})]},d.id))]})}),i&&l&&e.jsx("button",{onClick:d=>{d.stopPropagation(),l(s)},className:"p-2 text-green-400 hover:bg-green-400/10 rounded-lg",children:e.jsx(de,{className:"w-4 h-4"})})]})})})});jt.displayName="FleetCard";const bs=({fleets:s,filteredFleets:t,selectedFleetId:a,onSelectFleet:r,getCounters:i,isAdmin:c,onDeleteCounter:n,onViewDetails:l})=>{const h=m=>{r(a===m?null:m)};return!s||s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-white/60",children:[e.jsx(qe,{className:"w-12 h-12 mb-4 animate-float"}),e.jsx("p",{className:"text-lg",children:"No fleets found"})]}):e.jsx(Ae,{fallback:e.jsx("div",{className:"flex flex-col items-center justify-center p-8",children:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Failed to load fleets"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4",children:"Please try refreshing the page"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                       bg-red-500/20 text-red-400 hover:bg-red-500/30`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Refresh"]})]})}),children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsx(Q,{mode:"popLayout",children:t.map(m=>e.jsx(C.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(jt,{fleet:m,isSelected:a===m.id,onSelect:()=>h(m.id),counters:i(m.id),isFiltered:!0,isAdmin:c,onDeleteCounter:n,onViewDetails:l})},m.id))})})})},ws=({isOpen:s,onClose:t,filters:a,onFilterChange:r})=>{const i=o.useRef(null),c=o.useRef(null),n=Object.entries(a).some(([d,g])=>d==="searchTerm"?!1:typeof g=="boolean"?g:g!==null),l=o.useMemo(()=>[{title:"Battle Type",options:[{key:"battleType",value:"team",label:"Squads",icon:e.jsx(Wt,{className:"w-4 h-4"})},{key:"battleType",value:"fleet",label:"Fleets",icon:e.jsx(Je,{className:"w-4 h-4"})}]},{title:"Alignment",options:[{key:"alignment",value:"light",label:"Light Side",icon:e.jsx(Bt,{className:"w-4 h-4"})},{key:"alignment",value:"dark",label:"Dark Side",icon:e.jsx(Ht,{className:"w-4 h-4"})}]}],[]),h=[{key:"showTWOmicronOnly",label:"TW Omicron Only",description:"Show only teams with Territory Wars Omicron abilities"},{key:"showHardCounters",label:"Hard Counters Only",description:"Show only teams with reliable counter options"},{key:"excludeGL",label:"Exclude Galactic Legends",description:"Hide teams with Galactic Legend characters"}];o.useEffect(()=>{if(s&&i.current){const d=Gt(i.current,{escapeDeactivates:!0,allowOutsideClick:!0});return d.activate(),()=>{d.deactivate()}}},[s]);const m=()=>{r("battleType",null),r("alignment",null),r("showTWOmicronOnly",!1),r("showHardCounters",!1),r("excludeGL",!1)};return e.jsx(C.div,{initial:{opacity:0},animate:{opacity:s?1:0},exit:{opacity:0},transition:{duration:.2},className:`fixed inset-0 bg-black/50 backdrop-blur-sm z-50 ${!s&&"pointer-events-none"}`,onClick:t,children:e.jsxs(C.div,{ref:i,initial:{x:"100%"},animate:{x:s?0:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:`fixed inset-y-0 right-0 w-full max-w-md flex flex-col bg-gradient-to-br \r
                 from-space-darker/90 to-space-dark/90 backdrop-blur-xl border-l \r
                 border-white/10 shadow-2xl rounded-l-2xl overflow-hidden z-50`,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vt,{className:`w-5 h-5 ${n?"text-blue-400":"text-white/60"}`}),e.jsx("h2",{className:"text-xl font-orbitron text-white",children:"Filters"})]}),e.jsx(C.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t,className:`p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg \r
                     transition-colors`,children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsx("div",{ref:c,className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-6 space-y-8",children:[l.map(d=>e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/60",children:d.title}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.options.map(g=>e.jsxs(C.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>r(g.key,a[g.key]===g.value?null:g.value),className:`flex items-center justify-center gap-2 p-3 rounded-lg border 
                              transition-all ${a[g.key]===g.value?"bg-blue-500/20 border-blue-400 text-white shadow-neon-blue":"border-white/10 text-white/60 hover:bg-white/5"}`,children:[g.icon,g.label]},g.value))})]},d.title)),e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/60",children:"Additional Options"}),h.map(d=>e.jsxs(C.label,{whileHover:{scale:1.01},className:`flex items-start gap-3 p-4 rounded-lg border border-white/10 \r
                           hover:bg-white/5 cursor-pointer group`,children:[e.jsx("input",{type:"checkbox",checked:a[d.key],onChange:g=>r(d.key,g.target.checked),className:`mt-1 w-4 h-4 rounded border-white/20 bg-white/5 checked:bg-blue-500 \r
                             checked:border-blue-500 transition-colors`}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-white group-hover:text-blue-400 transition-colors",children:d.label}),e.jsx("div",{className:"text-sm text-white/40",children:d.description})]})]},d.key))]})]})}),e.jsx("div",{className:"p-6 border-t border-white/10 bg-space-darker/90 backdrop-blur-xl",children:e.jsxs(C.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:m,disabled:!n,className:`flex items-center justify-center gap-2 w-full p-3 rounded-lg \r
                     bg-white/5 text-white hover:bg-white/10 disabled:opacity-50 \r
                     disabled:cursor-not-allowed transition-colors`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Reset All Filters"]})})]})})},js="modulepreload",ys=function(s,t){return new URL(s,t).href},lt={},vs=function(t,a,r){let i=Promise.resolve();if(a&&a.length>0){const n=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=Promise.allSettled(a.map(m=>{if(m=ys(m,r),m in lt)return;lt[m]=!0;const d=m.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!r)for(let f=n.length-1;f>=0;f--){const b=n[f];if(b.href===m&&(!d||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${g}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":js,d||(p.as="script"),p.crossOrigin="",p.href=m,h&&p.setAttribute("nonce",h),document.head.appendChild(p),d)return new Promise((f,b)=>{p.addEventListener("load",f),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function c(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return i.then(n=>{for(const l of n||[])l.status==="rejected"&&c(l.reason);return t().catch(c)})},Ns=Yt("relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50",{variants:{variant:{default:"bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",destructive:"border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900"}},defaultVariants:{variant:"default"}}),te=o.forwardRef(({className:s,variant:t,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:fe(Ns({variant:t}),s),...a}));te.displayName="Alert";const se=o.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:fe("mb-1 font-medium leading-none tracking-tight",s),...t}));se.displayName="AlertTitle";const ae=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:fe("text-sm [&_p]:leading-relaxed",s),...t}));ae.displayName="AlertDescription";function Ze({type:s,isOpen:t,onClose:a,onSelect:r,availableUnits:i,alignment:c,selectionType:n,title:l="Select Unit",isCounterContext:h}){const[m,d]=o.useState(""),g=o.useMemo(()=>i!=null&&i.length?i.filter(p=>{const f=!m||p.name.toLowerCase().includes(m.toLowerCase());if(s==="ship"){const b=p;if(h||n==="capital")return f&&b.isCapital}return f}):[],[i,m,c,s,n,h]);o.useEffect(()=>{var p;console.log("UnitSelector mounted/updated:",{type:s,alignment:c,availableUnitsCount:i.length,selectionType:n,firstUnitName:(p=i[0])==null?void 0:p.name,filteredCount:g.length})},[s,c,i,n,g]),o.useEffect(()=>{console.log("Available Units:",i)},[i]);const w=o.useCallback(p=>{r(p)},[r]);return e.jsx(Q,{children:t&&e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[70] flex items-center justify-center",onClick:a,children:e.jsxs(C.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"w-full max-w-md bg-space-darker rounded-lg border border-white/10",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:l}),e.jsx("button",{onClick:a,className:"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Re,{className:"absolute left-3 top-2.5 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",value:m,onChange:p=>d(p.target.value),className:`w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg \r
                         text-white placeholder-white/40`,placeholder:`Search ${s}s...`,autoFocus:!0})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:g.length>0?g.map(p=>e.jsxs(C.button,{onClick:()=>w(p),className:`w-full flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg \r
                               text-left transition-colors`,whileHover:{x:4},children:[e.jsx(D,{id:p.id,name:p.name,type:s==="character"?n==="leader"?"squad-leader":"squad-member":n==="capital"?"capital-ship":"ship",size:"sm",className:"rounded-full border-2 border-blue-500/50",isLeader:n==="leader",isCapital:n==="capital"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white",children:p.name}),"role"in p&&e.jsx("div",{className:"text-sm text-white/60",children:p.role}),"isCapital"in p&&p.isCapital&&e.jsx("div",{className:"text-sm text-blue-400",children:"Capital Ship"})]})]},p.id)):e.jsx("div",{className:"text-center text-white/60 py-4",children:m.trim()?`No ${s}s found matching "${m}"`:`No ${s}s available`})})})]})]})})})}const Ss=({videoUrl:s,title:t,autoplay:a=!1})=>{const[r,i]=o.useState(!1),[c,n]=o.useState(a),h=(g=>{const w=g.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?\s]+)/);return w?w[1]:null})(s);if(!h)return null;const m=`https://img.youtube.com/vi/${h}/maxresdefault.jpg`,d=()=>{n(!0)};return e.jsx("div",{className:`relative ${r?"fixed inset-0 z-50 bg-black/90":""}`,children:e.jsxs("div",{className:`relative ${r?"w-full h-full flex items-center justify-center p-4":"w-full aspect-video"}`,children:[c?e.jsx("iframe",{src:`https://www.youtube.com/embed/${h}?autoplay=1`,title:t||"Strategy Guide",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:`rounded-lg ${r?"w-full max-w-6xl aspect-video":"w-full h-full"}`}):e.jsxs("div",{className:"relative w-full aspect-video rounded-lg overflow-hidden group",children:[e.jsx("img",{src:m,alt:t||"Video thumbnail",className:"w-full h-full object-cover"}),e.jsx("div",{className:`absolute inset-0 bg-black/40 flex items-center justify-center\r
                         group-hover:bg-black/60 transition-colors`,children:e.jsx("button",{onClick:d,className:`bg-red-600 text-white rounded-full p-4 transform\r
                         transition-transform group-hover:scale-110`,children:e.jsx(Kt,{className:"w-8 h-8"})})}),t&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80",children:e.jsx("h3",{className:"text-white font-medium",children:t})})]}),e.jsx("button",{onClick:()=>i(!r),className:`absolute top-2 right-2 p-2 rounded-lg bg-black/50 text-white hover:bg-black/70\r
                   transition-colors`,children:r?e.jsx(I,{className:"w-5 h-5"}):e.jsx(Qt,{className:"w-5 h-5"})})]})})},_s=({isOpen:s,onClose:t,targetDefense:a,onSave:r,onDelete:i,availableUnits:c,existingCounter:n,isFleet:l})=>{var W,z,M;const[h,m]=o.useState(()=>{if(!n)return[];if(l){const v=n.counterSquad;return[v.capitalShip,...v.startingLineup,...v.reinforcements].filter(A=>A!==null)}else{const v=n.counterSquad;return[v.leader,...v.characters||[]].filter(A=>A!==null)}}),[d,g]=o.useState((n==null?void 0:n.counterType)||"hard"),[w,p]=o.useState((n==null?void 0:n.description)||""),[f,b]=o.useState(null),[_,x]=o.useState(!1),[u,N]=o.useState(!1),[q,$]=o.useState({required:(n==null?void 0:n.twOmicronRequired)||!1,comment:(n==null?void 0:n.twOmicronComment)||""}),[T,V]=o.useState((n==null?void 0:n.video_url)||""),[L,Y]=o.useState((n==null?void 0:n.datacronRequired)||null),[G,J]=o.useState(((W=n==null?void 0:n.requirements)==null?void 0:W.filter(v=>v.type==="mods").map(v=>{const[A,...H]=v.description.split(":");return{character:A.trim(),description:H.join(":").trim()}}))||[]);o.useEffect(()=>{console.log("CounterEditor received props:",{targetDefenseType:a.type,targetDefenseName:a.name,availableUnitsCount:c.length,hasExistingCounter:!!n,isFleet:l})},[a,c,n,l]),o.useEffect(()=>{if(n)if(g(n.counterType),p(n.description),n.counterSquad.type==="squad"){const v=n.counterSquad;m([v.leader,...v.characters].filter(A=>A!==null))}else{const v=n.counterSquad;m([v.capitalShip,...v.startingLineup,...v.reinforcements].filter(A=>A!==null))}},[n]);const ie=async()=>{if(!navigator.onLine){b("Cannot save while offline");return}try{if(N(!0),h.length===0){b("Please select counter units");return}let v;const A={id:(n==null?void 0:n.id)||`counter-${Date.now()}`,counterType:d,description:w.trim(),video_url:T||void 0,strategy:(n==null?void 0:n.strategy)||[]};if(l){const H=h,j=E(H);if(j){b(j);return}v={...A,targetSquad:a,counterSquad:{id:`fleet-${Date.now()}`,type:"fleet",name:`Counter for ${a.name}`,alignment:a.alignment,capitalShip:H[0],startingLineup:H.slice(1,4),reinforcements:H.slice(4)},requirements:[]}}else v={...A,targetSquad:a,counterSquad:{id:`squad-${Date.now()}`,type:"squad",name:`Counter for ${a.name}`,alignment:a.alignment,leader:h[0],characters:h.slice(1)},twOmicronRequired:q.required,twOmicronComment:q.comment,datacronRequired:L!=null&&L.level?L:void 0,requirements:G.map(H=>({type:"mods",description:`${H.character}: ${H.description}`,priority:"required"}))};await r(v),t()}catch(v){console.error("Error saving counter:",v),b(v instanceof Error?v.message:"Failed to save counter")}finally{N(!1)}},X=async()=>{if(!(!n||!i)){if(!navigator.onLine){b("Cannot delete while offline");return}try{N(!0),await i(n.id),t()}catch(v){console.error("Error deleting counter:",v),b(v instanceof Error?v.message:"Failed to delete counter")}finally{N(!1)}}},O=v=>v===0?"Capital Ship":v>=1&&v<=3?`Starting Ship ${v}`:`Reinforcement ${v-3}`,E=v=>v.length===0?"At least one ship is required":v[0].isCapital?v.length>7?"Maximum of 7 ships allowed":null:"First ship must be a capital ship";return e.jsx(Ae,{fallback:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Counter Editor Error"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4",children:"An error occurred while editing the counter."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:t,className:`px-4 py-2 rounded-lg bg-white/10 text-white \r
                       hover:bg-white/20`,children:"Close"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                       bg-red-500/20 text-red-400 hover:bg-red-500/30`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Refresh"]})]})]}),children:e.jsxs(C.div,{initial:{opacity:0},animate:{opacity:s?1:0},exit:{opacity:0},className:`fixed inset-0 z-50 overflow-y-auto ${!s&&"pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),e.jsx("div",{className:"min-h-screen flex items-start justify-center py-8",children:e.jsxs(C.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"relative w-full max-w-2xl mx-4 bg-space-darker rounded-lg border border-white/10",onClick:v=>v.stopPropagation(),children:[e.jsx("div",{className:"sticky top-0 z-10 bg-space-darker border-b border-white/10 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-medium text-white",children:n?"Edit Counter":"Add Counter"}),e.jsx("button",{onClick:t,className:"p-2 text-white/60 hover:text-white",children:e.jsx(I,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"max-h-[calc(100vh-theme(spacing.32))] overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-6 space-y-6",children:[f&&e.jsxs(te,{variant:"destructive",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(se,{children:"Error"}),e.jsx(ae,{children:f})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Counter Type"}),e.jsx("div",{className:"flex gap-3",children:["hard","soft","risky"].map(v=>e.jsx("button",{onClick:()=>g(v),className:`px-4 py-2 rounded-lg capitalize ${d===v?v==="hard"?"bg-green-500/20 text-green-400":v==="soft"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400":"bg-white/5 text-white/60"}`,children:v},v))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Counter Units"}),e.jsx("button",{onClick:()=>x(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"+ Add Unit"})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:h.filter(v=>v&&v.id).map((v,A)=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:v.id,name:v.name,type:a.type==="squad"?"squad-member":"ship",size:"md",className:`${A===0&&l?"border-2 border-blue-400":""}`}),l&&e.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-black/90 px-2 py-1 rounded text-xs text-white whitespace-nowrap",children:O(A)}),e.jsx("button",{onClick:()=>m(H=>H.filter((j,S)=>S!==A)),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},v.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Description"}),e.jsx("textarea",{value:w,onChange:v=>p(v.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white",rows:3,placeholder:"Describe how this counter works..."})]}),!l&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:"Datacron Requirement (Optional)"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"number",min:"1",max:"9",placeholder:"Level",value:(L==null?void 0:L.level)||"",onChange:v=>Y({level:parseInt(v.target.value),description:(L==null?void 0:L.description)||""}),className:"w-24 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"}),e.jsx("input",{type:"text",placeholder:"Description",value:(L==null?void 0:L.description)||"",onChange:v=>Y({level:(L==null?void 0:L.level)||1,description:v.target.value}),className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:"Mod Requirements (Optional)"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Character",value:((z=G[0])==null?void 0:z.character)||"",onChange:v=>{var A;return J([{character:v.target.value,description:((A=G[0])==null?void 0:A.description)||""}])},className:"w-1/3 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"}),e.jsx("input",{type:"text",placeholder:"Description",value:((M=G[0])==null?void 0:M.description)||"",onChange:v=>{var A;return J([{character:((A=G[0])==null?void 0:A.character)||"",description:v.target.value}])},className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"twOmicron",checked:q.required,onChange:v=>$({...q,required:v.target.checked}),className:"w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500"}),e.jsx("label",{htmlFor:"twOmicron",className:"text-sm text-white",children:"Requires Territory Wars Omicron"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Video Guide URL (Optional)"}),e.jsx("input",{type:"url",value:T,onChange:v=>V(v.target.value),placeholder:"YouTube URL...",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"}),T&&e.jsx("div",{className:"mt-2",children:e.jsx(Ss,{videoUrl:T})})]}),e.jsxs("div",{className:"flex justify-between gap-3 pt-4",children:[e.jsx("div",{children:n&&i&&e.jsx("button",{onClick:X,disabled:u,className:"px-4 py-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 disabled:opacity-50",children:"Delete Counter"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:t,disabled:u,className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ie,disabled:u,className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:u?"Saving...":n?"Update Counter":"Save Counter"})]})]})]})}),_&&e.jsx(Ze,{type:a.type==="squad"?"character":"ship",isOpen:_,onClose:()=>x(!1),onSelect:v=>{if(l){const A=v;m(H=>{const j=H;return j.length===0?A.isCapital?[A]:(b("First ship must be a capital ship"),j):j.length<=3?[...j,A]:j.length<=6?[...j,A]:j})}else m(A=>[...A,v]);x(!1)},availableUnits:c,alignment:a.alignment,selectionType:"member"})]})})]})})},ks={validateSquadStructure:s=>!!(s.id&&s.name&&s.alignment&&Array.isArray(s.characters)),validateCharacters:s=>s.every(t=>!!(t.id&&t.name&&t.alignment)),validateLeader:s=>s?!!(s.id&&s.name&&s.alignment):!0,validateCompleteSquad:s=>{var t,a,r;return console.log("Validating squad:",{name:s.name,hasLeader:!!s.leader,leader:s.leader,membersCount:(t=s.characters)==null?void 0:t.length,members:s.characters}),(a=s.name)!=null&&a.trim()?s.leader?(r=s.characters)!=null&&r.length?{isValid:!0,error:null}:{isValid:!1,error:"Squad must have at least one member"}:(console.log("Leader validation failed:",s.leader),{isValid:!1,error:"Squad must have a leader"}):{isValid:!1,error:"Squad name is required"}}};class ke{static async withLock(t,a,r=3e4){return this.locks.get(t)?(console.log(`Operation ${t} is locked, waiting...`),new Promise((i,c)=>{const n=setTimeout(()=>{this.locks.set(t,!1),c(new Error(`Operation ${t} timed out`))},r),l=setInterval(()=>{this.locks.get(t)||(clearInterval(l),clearTimeout(n),this.executeWithLock(t,a).then(i).catch(c))},100)})):this.executeWithLock(t,a)}static async executeWithLock(t,a){try{return console.log(`Acquiring lock for ${t}`),this.locks.set(t,!0),await a()}finally{console.log(`Releasing lock for ${t}`),this.locks.set(t,!1)}}static isLocked(t){return this.locks.get(t)||!1}}K(ke,"locks",new Map);class Pe{static async add(t,a){console.log(`Adding operation to queue: ${t}`),this.queue.push({operation:a,key:t}),this.isProcessing||await this.processQueue()}static async processQueue(){if(!(this.isProcessing||this.queue.length===0)){for(this.isProcessing=!0,console.log("Starting queue processing");this.queue.length>0;){const t=this.queue.shift();if(t)try{await ke.withLock(t.key,t.operation),console.log(`Successfully processed operation: ${t.key}`)}catch(a){console.error(`Error processing operation ${t.key}:`,a)}}this.isProcessing=!1,console.log("Queue processing completed")}}}K(Pe,"queue",[]),K(Pe,"isProcessing",!1);class Ce{static schedule(t,a,r=this.defaultDelay){this.timers.has(t)&&clearTimeout(this.timers.get(t));const i=setTimeout(async()=>{try{await Pe.add(t,a),this.timers.delete(t)}catch(c){console.error(`Error in debounced operation ${t}:`,c)}},r);this.timers.set(t,i)}}K(Ce,"timers",new Map),K(Ce,"defaultDelay",1e3);class R{static async checkOnline(){return navigator.onLine}static async handleOperation(t,a){if(!await this.checkOnline())throw new Error("Operation cannot be performed while offline");try{return await t()}catch(i){throw console.error(`${a}:`,i),new Error(a)}}static cleanDataForFirestore(t){if(console.log("cleanDataForFirestore called with:",{type:typeof t,isArray:Array.isArray(t),value:t}),t==null)return null;if(Array.isArray(t))return console.log("Processing array with length:",t.length),t.map(a=>this.cleanDataForFirestore(a));if(typeof t=="object"){console.log("Processing object with keys:",Object.keys(t));const a={};for(const[r,i]of Object.entries(t)){console.log(`Processing key "${r}":`,{type:typeof i,isArray:Array.isArray(i),hasValue:i!=null});const c=this.cleanDataForFirestore(i),n=["characters","leader","startingLineup","reinforcements","capitalShip"].includes(r);(c!==null||n)&&(a[r]=c,console.log(`Saved value for "${r}":`,c))}return a}return t}static async logChange(t){var a,r;try{const i=ee(ce(U,"changes")),c={...t,id:i.id,timestamp:Ge(),changes:{...t.changes,[t.entityType]:{old:((a=t.changes[t.entityType])==null?void 0:a.old)||null,new:((r=t.changes[t.entityType])==null?void 0:r.new)||null}}};await xe(i,c)}catch(i){console.error("Error logging change:",i)}}static async deleteSquad(t){try{const a=Ie(U),r=await this.getCurrentUserId(),i=ee(U,"squads",t),c=await pe(i);if(!c.exists())throw new Error("Squad not found");a.delete(i);const n=at(ce(U,"counters"),rt("targetSquad.id","==",t));(await je(n)).docs.forEach(h=>{a.delete(h.ref)}),await a.commit(),await this.logChange({entityId:t,entityType:"squad",changeType:"delete",userId:r,changes:{squad:{old:c.data(),new:null}}})}catch(a){throw console.error("Error deleting squad:",a),new Error("Failed to delete squad")}}static async addOrUpdateSquad(t){return ke.withLock("squad-sync",async()=>this.handleOperation(async()=>{const a=ks.validateCompleteSquad(t);if(!a.isValid)throw new Error(a.error||"Invalid squad data");const r=await this.getCurrentUserId(),i=await this.documentExists("squads",t.id),c=Date.now(),n={...t,lastUpdated:c,createdAt:i?t.createdAt:c,updatedBy:r,type:"squad"};n.createdAt===void 0&&delete n.createdAt;const l=ee(U,"squads",t.id);await xe(l,n,{merge:!0}),console.log("Saving squad with timestamps:",n)},"Failed to save squad"))}static validateFleetData(t){var i;const a=(i=t.startingLineup)==null?void 0:i.every(c=>c.id&&c.name&&c.alignment),r=!t.capitalShip||t.capitalShip.id&&t.capitalShip.name&&t.capitalShip.alignment;return!!(t.id&&t.name&&t.alignment&&a&&r)}static async addOrUpdateFleet(t){return ke.withLock("fleet-sync",async()=>this.handleOperation(async()=>{if(!this.validateFleetData(t))throw new Error("Invalid fleet data structure");const a=await this.getCurrentUserId(),r=await this.documentExists("fleets",t.id),i=Date.now(),c={...t,lastUpdated:i,createdAt:r&&t.createdAt||i,updatedBy:a,type:"fleet"},n=ee(U,"fleets",t.id);await xe(n,c,{merge:!0}),console.log("Saving fleet with timestamps:",c)},"Failed to save fleet"))}static async deleteFleet(t){try{const a=Ie(U),r=await this.getCurrentUserId(),i=ee(U,"fleets",t),c=await pe(i);if(!c.exists())throw new Error("Fleet not found");a.delete(i);const n=at(ce(U,"counters"),rt("targetSquad.id","==",t));(await je(n)).docs.forEach(h=>{a.delete(h.ref)}),await a.commit(),await this.logChange({entityId:t,entityType:"fleet",changeType:"delete",userId:r,changes:{fleet:{old:c.data(),new:null}}})}catch(a){throw console.error("Error deleting fleet:",a),new Error("Failed to delete fleet")}}static async addOrUpdateCounter(t){return ke.withLock("counter-sync",async()=>this.handleOperation(async()=>{const a=t.id||`counter-${Date.now()}`,r=await this.documentExists("counters",a),i=Ge(),c=await this.getCurrentUserId(),n={...t,id:a,lastUpdated:i,createdAt:r?void 0:i,updatedBy:c},l=ee(U,"counters",a);return await xe(l,this.cleanDataForFirestore(n)),n},"Failed to save counter"))}static async deleteCounter(t){return this.handleOperation(async()=>{console.log("Starting delete operation for counter:",t);const a=ee(U,"counters",t),r=await pe(a);if(!r.exists()){console.log(`Counter ${t} already deleted or doesn't exist`);return}const i=r.data();console.log("Found counter data:",i);const c=Ie(U);c.delete(a);const n=ee(ce(U,"changes")),l=await this.getCurrentUserId();c.set(n,{id:n.id,entityId:t,entityType:"counter",changeType:"delete",userId:l,timestamp:Ge(),changes:{counter:{old:i,new:null}}}),await c.commit(),console.log("Successfully deleted counter and created change log")},"Failed to delete counter")}static async getFleets(){try{return(await je(ce(U,"fleets"))).docs.map(a=>{const r=a.data();console.log("Raw fleet data before processing:",r);let i={...r,id:a.id};try{r.createdAt&&(r.createdAt instanceof Oe?i.createdAt=r.createdAt.toDate().toISOString():typeof r.createdAt=="number"&&(i.createdAt=new Date(r.createdAt).toISOString())),r.lastUpdated&&(r.lastUpdated instanceof Oe?i.lastUpdated=r.lastUpdated.toDate().toISOString():typeof r.lastUpdated=="number"&&(i.lastUpdated=new Date(r.lastUpdated).toISOString()))}catch(c){console.warn("Error processing timestamps:",c)}return console.log("Processed fleet data:",i),i})}catch(t){throw console.error("Error getting fleets:",t),new Error("Failed to get fleets")}}static async getSquads(){try{const t=await je(ce(U,"squads"));return t.empty?(console.warn("No squads found"),[]):t.docs.map(a=>{const r=a.data();console.log("Raw squad data before processing:",r);let i={...r,id:a.id};try{r.createdAt&&(r.createdAt instanceof Oe?i.createdAt=r.createdAt.toDate().toISOString():typeof r.createdAt=="number"&&(i.createdAt=new Date(r.createdAt).toISOString())),r.lastUpdated&&(r.lastUpdated instanceof Oe?i.lastUpdated=r.lastUpdated.toDate().toISOString():typeof r.lastUpdated=="number"&&(i.lastUpdated=new Date(r.lastUpdated).toISOString()))}catch(c){console.warn("Error processing timestamps:",c)}return console.log("Processed squad data:",i),i})}catch(t){throw console.error("Error getting squads:",t),new Error("Failed to get squads")}}static async getCounters(){try{return(await je(ce(U,"counters"))).docs.map(a=>({id:a.id,...a.data()}))}catch(t){throw console.error("Error getting counters:",t),new Error("Failed to get counters")}}static async documentExists(t,a){const r=ee(U,t,a);return(await pe(r)).exists()}static async syncAllData(){try{const[t,a,r]=await Promise.all([this.getSquads(),this.getFleets(),this.getCounters()]);return{squads:t,fleets:a,counters:r,timestamp:new Date().toISOString()}}catch(t){throw console.error("Error syncing data:",t),new Error("Failed to sync data")}}static async getCurrentUserId(){const t=_e.currentUser;if(!t)throw new Error("No authenticated user");return t.uid}}const Cs={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},ye=({size:s="md",variant:t="default",message:a,className:r=""})=>{const i={default:"border-blue-400",light:"border-white/40",dark:"border-gray-600"};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(C.div,{className:fe("border-2 border-t-transparent rounded-full",Cs[s],i[t],r),animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),a&&e.jsx("p",{className:"mt-4 text-white/60",children:a})]})},yt=o.createContext(null);function Es({children:s}){const[t,a]=o.useState(!1),[r,i]=o.useState(navigator.onLine),[c,n]=o.useState(!0),[l,h]=o.useState(null),[m,d]=o.useState(0);o.useEffect(()=>{(async()=>{try{n(!0),h(null);try{await ft();const p=new Promise((f,b)=>{setTimeout(()=>b(new Error("Firestore connection timeout")),1e4)});await Promise.race([R.syncAllData(),p]),a(!0)}catch(p){console.error("Firebase initialization error:",p),h(p instanceof Error?p.message:"Failed to initialize Firebase")}}catch(p){console.error("Error in initialize:",p),h(p instanceof Error?p.message:"Unknown error occurred")}finally{n(!1)}})()},[m]),o.useEffect(()=>{const w=()=>{i(!0)},p=()=>i(!1);return window.addEventListener("online",w),window.addEventListener("offline",p),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",p)}},[]);const g=async()=>{d(w=>w+1)};return c&&!l?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-space-darker",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ye,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-white/60",children:"Initializing..."})]})}):l?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-space-darker",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-400 text-xl mb-4",children:l}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Retry"})]})}):e.jsx(yt.Provider,{value:{isInitialized:t,isOnline:r,isLoading:c,error:l,retry:g},children:e.jsxs("div",{className:"relative",children:[!r&&e.jsx("div",{className:"sticky top-0 bg-yellow-500/90 text-black py-2 px-4 text-center z-50",children:"You are currently offline. Changes will be synced when you reconnect."}),s]})})}function ve(){const s=o.useContext(yt);if(!s)throw new Error("useFirebase must be used within a FirebaseProvider");return s}const ne={SQUADS:"swgoh-tw-squads",FLEETS:"swgoh-tw-fleets",COUNTERS:"swgoh-tw-counters",VERSION:"1.0.0"};class qs{validateData(t){return Array.isArray(t)&&t.every(a=>typeof a=="object"&&a!==null)}async saveData(t,a){try{if(console.log(`Saving data to ${t}:`,a),!this.validateData(a))throw new Error("Invalid data format");const r={data:a,version:ne.VERSION,lastUpdated:new Date().toISOString()};localStorage.setItem(t,JSON.stringify(r)),console.log(`Data saved successfully to ${t}`)}catch(r){throw console.error(`Error saving ${t}:`,r),r}}getData(t,a=[]){try{console.log(`Getting data from ${t}`);const r=localStorage.getItem(t);if(!r)return console.log(`No data found in ${t}, using default value`),a;const i=JSON.parse(r);return Array.isArray(i)?(console.log(`Found legacy data format in ${t}`),i):i.data&&Array.isArray(i.data)?(console.log(`Found data in ${t}:`,i.data),i.data):(console.log(`Invalid data format in ${t}, using default value`),a)}catch(r){return console.error(`Error getting ${t}:`,r),a}}async saveSquads(t){Ce.schedule("save-squads",async()=>{await this.saveData(ne.SQUADS,t),await R.addOrUpdateSquad(t[t.length-1])})}getSquads(){return this.getData(ne.SQUADS,[])}async saveFleets(t){Ce.schedule("save-fleets",async()=>{await this.saveData(ne.FLEETS,t),await R.addOrUpdateFleet(t[t.length-1])})}getFleets(){return this.getData(ne.FLEETS,[])}async saveCounters(t){Ce.schedule("save-counters",async()=>{await this.saveData(ne.COUNTERS,t),t.length>0&&await R.addOrUpdateCounter(t[t.length-1])})}getCounters(){return this.getData(ne.COUNTERS,[])}async clearAllData(){await Pe.add("clear-all",async()=>{try{console.log("Clearing all data"),localStorage.removeItem(ne.SQUADS),localStorage.removeItem(ne.FLEETS),localStorage.removeItem(ne.COUNTERS),console.log("All data cleared successfully")}catch(t){throw console.error("Error clearing data:",t),t}})}}const Fs=new qs,vt=o.createContext(null);function Nt({children:s}){const[t,a]=o.useState(navigator.onLine),[r,i]=o.useState(null),[c,n]=o.useState(!1),[l,h]=o.useState(!1),[m,d]=o.useState(!0),[g,w]=o.useState(null);o.useEffect(()=>{const _=mt(_e,async x=>{try{if(x){const N=(await pe(ee(U,"users",x.uid))).data();n((N==null?void 0:N.isAdmin)||!1),h((N==null?void 0:N.isMasterAdmin)||!1),i(x)}else i(null),n(!1),h(!1)}catch(u){console.error("Error checking admin status:",u),w("Failed to verify admin status")}finally{d(!1)}});return()=>_()},[]),o.useEffect(()=>{const _=()=>a(!0),x=()=>a(!1);return window.addEventListener("online",_),window.addEventListener("offline",x),()=>{window.removeEventListener("online",_),window.removeEventListener("offline",x)}},[]);const b={currentUser:r,isAdmin:c,isMasterAdmin:l,login:async(_,x)=>{if(!t)throw new Error("Cannot login while offline");try{w(null);const u=await Jt(_e,_,x),N=ee(U,"users",u.user.uid);(await pe(N)).exists()?await xe(N,{lastLogin:new Date().toISOString()},{merge:!0}):await xe(N,{email:u.user.email,isAdmin:!1,isMasterAdmin:!1,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()});const T=(await pe(N)).data();if(!(T!=null&&T.isAdmin)&&!(T!=null&&T.isMasterAdmin))throw await it(_e),new Error("Unauthorized access - not an admin user")}catch(u){const N=u;console.error("Login error:",N);let q="Failed to login. Please try again.";throw N.code==="auth/user-not-found"||N.code==="auth/wrong-password"?q="Invalid email or password":N.code==="auth/too-many-requests"&&(q="Too many failed attempts. Please try again later."),w(q),new Error(q)}},logout:async()=>{if(!t)throw new Error("Cannot logout while offline");try{await it(_e),i(null),n(!1),h(!1),Fs.clearAllData()}catch(_){throw console.error("Logout error:",_),w("Failed to logout"),_}},loading:m,error:g};return e.jsx(vt.Provider,{value:b,children:!m&&s})}function Xe(){const s=o.useContext(vt);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s}const We=({value:s,onChange:t,label:a=!0})=>{const[r,i]=o.useState(!1),c=()=>{i(!r)},n=l=>{t(l),i(!1)};return e.jsxs("div",{className:"relative",children:[a&&e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Alignment"}),e.jsxs("button",{type:"button",onClick:c,className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-left flex justify-between items-center",children:[e.jsx("span",{children:s==="light"?"Light Side":"Dark Side"}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r&&e.jsxs("div",{className:"absolute left-0 right-0 mt-1 bg-space-darker border border-white/10 rounded-lg shadow-lg z-[60]",children:[e.jsx("button",{type:"button",onClick:()=>n("light"),className:"w-full px-3 py-2 text-white hover:bg-white/5 text-left first:rounded-t-lg",children:"Light Side"}),e.jsx("button",{type:"button",onClick:()=>n("dark"),className:"w-full px-3 py-2 text-white hover:bg-white/5 text-left last:rounded-b-lg",children:"Dark Side"})]})]})},As=({leader:s,members:t,onAddUnit:a,onRemoveUnit:r,alignment:i,showLeaderSelection:c=!0,availableUnits:n})=>{const[l,h]=o.useState(""),[m,d]=o.useState(!1),g=o.useCallback((f,b,_)=>{f.preventDefault(),f.stopPropagation();const x={id:b.id,name:b.name,role:b.role||"",alignment:b.alignment,isGalacticLegend:b.isGalacticLegend||!1};a(x,_),d(!1)},[a]),w=f=>{f.preventDefault(),f.stopPropagation(),d(!0)},p=o.useMemo(()=>{const f=l.toLowerCase(),b=new Set([s==null?void 0:s.id,...t.map(_=>_.id)]);return n.filter(_=>{const x=!l||_.name.toLowerCase().includes(f),u=!b.has(_.id),N=_.alignment===i;return x&&u&&N})},[l,n,s,t,i]);return e.jsxs("div",{className:"space-y-6",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",value:l,onChange:f=>h(f.target.value),onClick:f=>{f.stopPropagation(),d(!0)},className:`w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg \r
                   text-white placeholder-white/40`,placeholder:"Search characters..."}),m&&e.jsxs(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`absolute z-50 w-full mt-2 bg-gray-900 border border-white/10 \r
                     rounded-lg shadow-lg max-h-64 overflow-y-auto`,onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-2 border-b border-white/10",children:[e.jsx("span",{className:"text-sm text-white/60",children:"Select Character"}),e.jsx("button",{onClick:f=>{f.stopPropagation(),d(!1)},className:"p-1 hover:bg-white/10 rounded",children:e.jsx(I,{className:"w-4 h-4 text-white/60"})})]}),p.length>0?p.map(f=>e.jsx("div",{className:"p-3 hover:bg-white/5 transition-colors",onClick:b=>b.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{id:f.id,name:f.name,type:!s&&c?"squad-leader":"squad-member",size:"sm",className:"rounded-full border-2 border-white/20"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white",children:f.name}),e.jsx("div",{className:"text-sm text-white/60",children:f.role})]})]}),e.jsxs("div",{className:"flex gap-2",children:[c&&!s&&e.jsx("button",{onClick:b=>g(b,f,!0),className:"px-3 py-1 text-sm rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30",children:"Set as Leader"}),t.length<4&&e.jsx("button",{onClick:b=>g(b,f,!1),className:"px-3 py-1 text-sm rounded-md bg-white/10 text-white hover:bg-white/20",children:"Add Member"})]})]})},f.id)):e.jsx("div",{className:"p-3 text-white/60 text-center",children:"No matching characters found"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-white/60 mb-2 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Leader"]}),e.jsx("div",{className:"relative group inline-block",children:s?e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:s.id,name:s.name,type:"squad-leader",size:"md",className:"rounded-full border-2 border-blue-400"}),e.jsx("button",{onClick:f=>{f.stopPropagation(),r(s.id,!0)},className:`absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full \r
                           flex items-center justify-center opacity-0 group-hover:opacity-100 \r
                           transition-opacity`,children:e.jsx(I,{className:"w-3 h-3 text-white"})})]}):e.jsx("button",{onClick:w,className:`w-12 h-12 rounded-full border-2 border-dashed border-blue-400/40 \r
                         flex items-center justify-center hover:border-blue-400/60 \r
                         transition-colors`,children:e.jsx("span",{className:"text-blue-400/60",children:"+"})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-2",children:"Squad Members"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.map(f=>e.jsxs("div",{className:"relative group",children:[e.jsx(D,{id:f.id,name:f.name,type:"squad-member",size:"md",className:"rounded-full border-2 border-white/20"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),r(f.id,!1)},className:`absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full \r
                           flex items-center justify-center opacity-0 group-hover:opacity-100 \r
                           transition-opacity`,children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},f.id)),t.length<4&&e.jsx("button",{onClick:w,className:`w-12 h-12 rounded-full border-2 border-dashed border-white/20 \r
                         flex items-center justify-center hover:border-white/40 \r
                         transition-colors`,children:e.jsx("span",{className:"text-white/40",children:"+"})})]})]})]})]})},Ds=({onSave:s,onCancel:t,availableUnits:a})=>{const[r,i]=o.useState(""),[c,n]=o.useState("light"),[l,h]=o.useState(null),[m,d]=o.useState([]),[g,w]=o.useState(!1),[p,f]=o.useState(""),[b,_]=o.useState(null),x=u=>{if(u.preventDefault(),_(null),!r.trim()){_("Squad name is required");return}if(!l){_("Squad must have a leader");return}if(m.length===0){_("Squad must have at least one member");return}const N={id:ge(r),name:r.trim(),type:"squad",alignment:c,leader:l,characters:m,description:p.trim()||void 0,twOmicronRequired:g};s(N)};return e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[b&&e.jsxs(te,{variant:"destructive",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(se,{children:"Error"}),e.jsx(ae,{children:b})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Squad Name"}),e.jsx("input",{type:"text",value:r,onChange:u=>i(u.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white",placeholder:"Enter squad name"})]}),e.jsx("div",{children:e.jsx(We,{value:c,onChange:n})})]}),e.jsx(As,{leader:l,members:m,onAddUnit:(u,N)=>{N?h(u):m.length<4&&d(q=>[...q,u])},onRemoveUnit:(u,N)=>{N?h(null):d(q=>q.filter($=>$.id!==u))},alignment:c,availableUnits:a}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"twOmicron",checked:g,onChange:u=>w(u.target.checked),className:"w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500"}),e.jsx("label",{htmlFor:"twOmicron",className:"ml-2 text-sm text-white",children:"Requires Territory Wars Omicron"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:p,onChange:u=>f(u.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none",rows:3,placeholder:"Add any notes or description..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600",children:"Save Squad"})]})]})},Os=({capitalShip:s,startingLineup:t,reinforcements:a,onAddUnit:r,onRemoveUnit:i,alignment:c,availableUnits:n,isCounterSelector:l=!1})=>{const[h,m]=o.useState(""),[d,g]=o.useState(!1),[w,p]=o.useState("capital"),f=o.useCallback((x,u,N)=>{x.preventDefault(),x.stopPropagation();const q={id:u.id,name:u.name,type:u.type,isCapital:u.isCapital,alignment:u.alignment};r(q,N),g(!1)},[r]),b=(x,u)=>{x.preventDefault(),x.stopPropagation(),p(u),g(!0)},_=o.useMemo(()=>{const x=h.toLowerCase(),u=new Set([s==null?void 0:s.id,...t.map(N=>N.id),...a.map(N=>N.id)]);return n.filter(N=>{const q=!h||N.name.toLowerCase().includes(x),$=!u.has(N.id),T=N.alignment===c;if(l)return q&&$&&T;const V=w==="capital"?N.isCapital:!N.isCapital;return q&&$&&T&&V})},[h,n,s,t,a,c,l,w]);return e.jsxs("div",{className:"space-y-6",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",value:h,onChange:x=>m(x.target.value),onClick:x=>x.stopPropagation(),className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40",placeholder:"Search ships..."}),d&&e.jsxs(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-50 w-full mt-2 bg-gray-900 border border-white/10 rounded-lg shadow-lg max-h-64 overflow-y-auto",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-2 border-b border-white/10",children:[e.jsxs("span",{className:"text-sm text-white/60",children:["Select ",w==="capital"?"Capital Ship":"Ship"]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),g(!1)},className:"p-1 hover:bg-white/10 rounded",children:e.jsx(I,{className:"w-4 h-4 text-white/60"})})]}),_.length>0?_.map(x=>e.jsx("div",{className:"p-3 hover:bg-white/5 transition-colors",onClick:u=>u.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{id:x.id,name:x.name,type:x.isCapital?"capital-ship":"ship",size:"sm",className:"rounded-full border-2 border-white/20"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white",children:x.name}),e.jsx("div",{className:"text-sm text-white/60",children:x.isCapital?"Capital Ship":"Ship"})]})]}),e.jsxs("button",{onClick:u=>f(u,x,w),className:"px-3 py-1 text-sm rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30",children:["Add ",w==="reinforcement"?"Reinforcement":""]})]})},x.id)):e.jsx("div",{className:"p-3 text-white/60 text-center",children:"No matching ships found"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-white/60 mb-2 flex items-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Capital Ship"]}),e.jsx("div",{className:"relative group inline-block",children:s?e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:s.id,name:s.name,type:"capital-ship",size:"lg",className:"rounded-full border-2 border-blue-400"}),e.jsx("button",{onClick:x=>{x.stopPropagation(),i(s.id,"capital")},className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]}):e.jsx("button",{onClick:x=>b(x,"capital"),className:"w-16 h-16 rounded-full border-2 border-dashed border-blue-400/40 flex items-center justify-center hover:border-blue-400/60 transition-colors",children:e.jsx("span",{className:"text-blue-400/60",children:"+"})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-2",children:"Starting Lineup"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.map(x=>e.jsxs("div",{className:"relative group",children:[e.jsx(D,{id:x.id,name:x.name,type:"ship",size:"md",className:"rounded-full border-2 border-white/20"}),e.jsx("button",{onClick:u=>{u.stopPropagation(),i(x.id,"starting")},className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},x.id)),t.length<3&&e.jsx("button",{onClick:x=>b(x,"starting"),className:"w-12 h-12 rounded-full border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40 transition-colors",children:e.jsx("span",{className:"text-white/40",children:"+"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-2",children:"Reinforcements"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.map((x,u)=>e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:x.id,name:x.name,type:"ship",size:"md",className:"rounded-full border-2 border-white/20"}),e.jsx("div",{className:"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs",children:u+1}),e.jsx("button",{onClick:N=>{N.stopPropagation(),i(x.id,"reinforcement")},className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]})},x.id)),a.length<3&&e.jsx("button",{onClick:x=>b(x,"reinforcement"),className:"w-12 h-12 rounded-full border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40 transition-colors",children:e.jsx("span",{className:"text-white/40",children:"+"})})]})]})]})},Ls=({onSave:s,onCancel:t,availableUnits:a})=>{const[r,i]=o.useState(""),[c,n]=o.useState("light"),[l,h]=o.useState(null),[m,d]=o.useState([]),[g,w]=o.useState([]),[p,f]=o.useState(""),[b,_]=o.useState(null),x=u=>{if(u.preventDefault(),_(null),!r.trim()){_("Fleet name is required");return}if(!l){_("Fleet must have a capital ship");return}if(m.length===0){_("Fleet must have at least one ship in starting lineup");return}const N={id:ge(r),name:r.trim(),type:"fleet",alignment:c,capitalShip:l,startingLineup:m,reinforcements:g,description:p.trim()||void 0};s(N)};return e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[b&&e.jsxs(te,{variant:"destructive",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(se,{children:"Error"}),e.jsx(ae,{children:b})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Fleet Name"}),e.jsx("input",{type:"text",value:r,onChange:u=>i(u.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white",placeholder:"Enter fleet name"})]}),e.jsx("div",{children:e.jsx(We,{value:c,onChange:n})})]}),e.jsx(Os,{capitalShip:l,startingLineup:m,reinforcements:g,onAddUnit:(u,N)=>{switch(N){case"capital":h(u);break;case"starting":m.length<3&&d(q=>[...q,u]);break;case"reinforcement":g.length<3&&w(q=>[...q,u]);break}},onRemoveUnit:(u,N)=>{switch(N){case"capital":h(null);break;case"starting":d(q=>q.filter($=>$.id!==u));break;case"reinforcement":w(q=>q.filter($=>$.id!==u));break}},alignment:c,availableUnits:a}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:p,onChange:u=>f(u.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none",rows:3,placeholder:"Add any notes or description..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600",children:"Create Fleet"})]})]})},Ts=({isOpen:s,onClose:t,onSave:a,initialType:r="squad",availableUnits:i})=>{const[c,n]=o.useState(r);if(!s)return null;const l=async h=>{try{await a(h),console.log("Defense saved successfully"),t()}catch(m){console.error("Error saving:",m)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto",children:e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"w-full max-w-2xl mx-4 my-8 bg-space-darker rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>n("squad"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${c==="squad"?"bg-blue-500":"bg-white/5"}`,children:[e.jsx(Je,{className:"w-4 h-4"}),"Squad"]}),e.jsxs("button",{onClick:()=>n("fleet"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${c==="fleet"?"bg-blue-500":"bg-white/5"}`,children:[e.jsx(qe,{className:"w-4 h-4"}),"Fleet"]})]}),e.jsx("button",{onClick:t,className:"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx("div",{className:"p-6",children:c==="squad"?e.jsx(Ds,{onSave:l,onCancel:t,availableUnits:i}):e.jsx(Ls,{onSave:l,onCancel:t,availableUnits:i})})})]})})},zs=({notifications:s,onDismiss:t})=>e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.jsx(Q,{children:s.map(a=>e.jsxs(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm
              ${a.type==="success"?"bg-green-500/10 text-green-400 border border-green-400/20":"bg-red-500/10 text-red-400 border border-red-400/20"}`,onClick:()=>t(a.id),children:[a.type==="success"?e.jsx(Xt,{className:"w-3.5 h-3.5"}):e.jsx(gt,{className:"w-3.5 h-3.5"}),a.message]},a.id))})}),$s=({onClose:s})=>e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs(C.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-space-darker w-full max-w-2xl rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-white/10",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Admin Settings"}),e.jsx("button",{onClick:s,className:"p-2 text-green-500 hover:text-green-100 hover:bg-green-500 rounded-lg",children:"Tillbaka"})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-white/60",children:"Hr var det tom. Funktionen r fr nrvarande inaktiverad men kan anvndas i framtiden."})})]})});class Is{static cleanDataForFirestore(t){if(t==null)return null;if(Array.isArray(t))return t.map(a=>this.cleanDataForFirestore(a)).filter(a=>a!=null);if(typeof t=="object"){const a={};for(const[r,i]of Object.entries(t)){const c=this.cleanDataForFirestore(i);c!=null&&(a[r]=c)}return a}return t}static async createAdminUser(t){try{console.log("Creating admin user...");const a=ee(U,"users","admin");return await xe(a,{email:t,isAdmin:!0,isMasterAdmin:!0,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()}),console.log("Admin user created successfully"),!0}catch(a){throw console.error("Error creating admin user:",a),a}}static async syncAll(){try{return console.log("Starting full data sync..."),await Promise.all([this.createAdminUser("admin@example.com")]),console.log("All data synced successfully"),!0}catch(t){throw console.error("Error during full sync:",t),t}}static async clearAllData(){try{console.log("Starting data clear...");const t=["squads","fleets","counters"],a=Ie(U);for(const r of t)(await je(ce(U,r))).forEach(c=>{a.delete(c.ref)});return await a.commit(),console.log("All data cleared successfully"),!0}catch(t){throw console.error("Error clearing data:",t),t}}}const Ps=()=>{const[s,t]=o.useState(!1),[a,r]=o.useState(null),[i,c]=o.useState(!1),[n,l]=o.useState(!1);o.useEffect(()=>{let d;return n&&(d=setTimeout(()=>{l(!1)},4e3)),()=>{d&&clearTimeout(d)}},[n]);const h=async()=>{t(!0),r(null),c(!1),l(!1);try{await Promise.all([Is.syncAll(),new Promise(d=>setTimeout(d,2e3))]),c(!0),setTimeout(()=>{l(!0),c(!0),setTimeout(()=>{c(!1),l(!1)},4e3)},100)}catch(d){r(d instanceof Error?d.message:"Ett fel uppstod vid synkronisering"),setTimeout(()=>{l(!0),setTimeout(()=>{r(null),l(!1)},4e3)},100)}finally{t(!1)}},m=()=>{if(s)return"bg-gray-500 cursor-not-allowed";if(n){if(i)return"bg-green-500 hover:bg-green-600";if(a)return"bg-red-500 hover:bg-red-600"}return"bg-blue-500 hover:bg-blue-600"};return e.jsxs("div",{className:"relative",children:[e.jsxs(C.button,{onClick:h,disabled:s,className:`flex items-center gap-2 px-4 py-2 rounded-lg ${m()} 
                   text-white transition-all duration-300`,animate:{scale:s?.98:1},children:[e.jsx(oe,{className:`w-4 h-4 transition-transform ${s?"animate-spin":""}`}),s?"Syncing...":"Sync Data"]}),e.jsx(Q,{children:(a||i)&&e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full mt-2 right-0 min-w-[200px]",children:[a&&e.jsxs(te,{variant:"destructive",children:[e.jsx(se,{children:"Error"}),e.jsx(ae,{children:a})]}),i&&e.jsxs(te,{className:"bg-green-500/10 border-green-500/20 text-green-400",children:[e.jsx(se,{children:"Success"}),e.jsx(ae,{children:"Data synced successfully!"})]})]})})]})},et=o.memo(({value:s,onChange:t,onClear:a,suggestions:r=[],onSelectSuggestion:i,placeholder:c="Search teams or ships..."})=>{const n=o.useMemo(()=>r.slice(0,10),[r]),[l,h]=o.useState(!1),[m,d]=o.useState({}),g=o.useRef(null);return o.useEffect(()=>{const w=async()=>{const p={};for(const f of n)try{"leader"in f&&f.leader?p[f.leader.id]=await Qe(f.leader.id,"character"):"capitalShip"in f&&f.capitalShip&&(p[f.capitalShip.id]=await Qe(f.capitalShip.id,"ship"))}catch(b){console.error("Failed to load image for suggestion:",b),p[f.id]="/placeholder.png"}d(p)};n.length>0&&w()},[n]),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:g,type:"text",value:s,onChange:w=>t(w.target.value),onFocus:()=>h(!0),onBlur:()=>setTimeout(()=>h(!1),200),className:`w-full bg-white/5 border border-white/10 rounded-lg pl-10 pr-10 py-2 \r
                   text-white placeholder-white/40 focus:outline-none focus:ring-2 \r
                   focus:ring-blue-400/50 focus:border-transparent`,placeholder:c}),e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40"}),s&&e.jsx("button",{onClick:()=>{var w;a(),(w=g.current)==null||w.focus()},className:`absolute right-3 top-1/2 transform -translate-y-1/2 \r
                     text-white/40 hover:text-white`,children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsx(Q,{children:l&&n.length>0&&e.jsx(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`absolute z-50 w-full mt-2 bg-space-dark border border-white/10 \r
                     rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto`,children:n.map(w=>e.jsxs("button",{onClick:()=>i==null?void 0:i(w),className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-white/5 \r
                         transition-colors text-left`,children:["leader"in w&&w.leader?e.jsx("img",{src:m[w.leader.id]||"/placeholder.png",alt:w.leader.name,className:"w-8 h-8 rounded-full object-cover",loading:"lazy"}):"capitalShip"in w&&w.capitalShip?e.jsx("img",{src:m[w.capitalShip.id]||"/placeholder.png",alt:w.capitalShip.name,className:"w-8 h-8 rounded-full object-cover",loading:"lazy"}):null,e.jsxs("div",{children:[e.jsx("div",{className:"text-white",children:w.name}),e.jsx("div",{className:"text-sm text-white/40",children:"leader"in w?"Squad":"Fleet"})]})]},w.id))})})]})});et.displayName="SearchBar";const Us=s=>"leader"in s.counterSquad,Be=({counters:s,targetDefense:t,onEdit:a,onDelete:r})=>{const i=l=>!!(l&&l.id&&l.targetSquad&&l.counterSquad),c=(l,h,m)=>`${l.id}-${h}-${m}`;if(!Array.isArray(s)||s.length===0)return null;const n=s.filter(l=>i(l)&&l.targetSquad.id===t.id);return n.length===0?null:e.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:[e.jsxs("h4",{className:"text-sm font-medium text-white/60",children:["Counters for ",t.name]}),e.jsx("div",{className:"space-y-3",children:e.jsx(Q,{children:n.map((l,h)=>{var m;return e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"p-4 bg-white/5 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${l.counterType==="hard"?"bg-green-500/20 text-green-400":l.counterType==="soft"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:l.counterType.charAt(0).toUpperCase()+l.counterType.slice(1)}),l.twOmicronRequired&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400",children:"TW Omicron"}),l.video_url&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-red-500/20 text-red-400",children:[e.jsx(xt,{className:"w-3 h-3"}),"Video"]})]}),e.jsxs("div",{className:"flex gap-2",children:[a&&e.jsx("button",{onClick:()=>a(l),className:"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg",children:e.jsx(es,{className:"w-4 h-4"})}),r&&e.jsx("button",{onClick:()=>r(l.id),className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]}),l.description&&e.jsx("p",{className:"text-white/70",children:l.description}),l.counterSquad&&e.jsx("div",{className:"flex items-center gap-2",children:Us(l)?e.jsxs(e.Fragment,{children:[l.counterSquad.leader&&e.jsx(D,{id:l.counterSquad.leader.id,name:l.counterSquad.leader.name,type:"squad-leader",size:"sm",className:"border-2 border-blue-400"},c(l,h,l.counterSquad.leader.id)),l.counterSquad.characters.map(d=>e.jsx(D,{id:d.id,name:d.name,type:"squad-member",size:"sm",className:"border-2 border-white/20"},c(l,h,d.id)))]}):e.jsxs(e.Fragment,{children:["capitalShip"in l.counterSquad&&l.counterSquad.capitalShip&&e.jsx(D,{id:l.counterSquad.capitalShip.id,name:l.counterSquad.capitalShip.name,type:"capital-ship",size:"sm",className:"border-2 border-blue-400"},c(l,h,l.counterSquad.capitalShip.id)),"startingLineup"in l.counterSquad&&((m=l.counterSquad.startingLineup)==null?void 0:m.map(d=>e.jsx(D,{id:d.id,name:d.name,type:"ship",size:"sm",className:"border-2 border-white/20"},c(l,h,d.id))))]})}),l.requirements&&l.requirements.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-400 mb-2",children:"Requirements"}),l.requirements.map((d,g)=>e.jsx("div",{className:"text-sm text-white/70",children:d.description},`${l.id}-req-${g}`))]})]},l.id)})})})]})},He=({defense:s,onAddCounter:t,disabled:a=!1})=>e.jsxs("button",{onClick:()=>t(s),disabled:a,className:`flex items-center gap-2 px-4 py-2 rounded-lg 
                ${a?"bg-gray-500/20 text-gray-400 cursor-not-allowed":"bg-green-500/20 text-green-400 hover:bg-green-500/30"} 
                transition-colors`,children:[e.jsx(de,{className:"w-4 h-4"}),"Add Counter"]}),Rs=({squad:s,counters:t,availableUnits:a,onClose:r,onUpdate:i,onDelete:c,onUpdateCounter:n,onDeleteCounter:l,onAddCounter:h,isOnline:m,saving:d=!1})=>{const[g,w]=o.useState(s.name),[p,f]=o.useState(!1),[b,_]=o.useState(s.alignment),[x,u]=o.useState(s.description||""),[N,q]=o.useState(s.twOmicronRequired||!1),[$,T]=o.useState(!1),[V,L]=o.useState("leader"),Y=async()=>{if(m)try{const O={...s,name:g,alignment:b,id:ge(g),description:x.trim()||void 0,twOmicronRequired:N};await i(O),r()}catch(O){console.error("Error saving squad:",O)}},G=()=>{c(s.id),r()},J=(O,E)=>{const W={...s};E?W.leader=null:W.characters=W.characters.filter(z=>z.id!==O),i(W)},ie=(O,E)=>{const W={...O,id:ge(O.name)},z={...s};E?z.leader=W:z.characters.length<4&&(z.characters=[...z.characters,W]),i(z)},X=t.filter(O=>O.targetSquad.id===s.id);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto",children:[e.jsx("div",{className:"min-h-full w-full flex items-start justify-center py-8",children:e.jsxs("div",{className:"relative w-full max-w-4xl mx-4 bg-space-darker rounded-lg border border-white/10",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex justify-between items-center p-4 border-b border-white/10 bg-space-darker",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Squad"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(!0),className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:r,className:"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Squad Name"}),e.jsx("input",{type:"text",value:g,onChange:O=>w(O.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"})]}),e.jsx("div",{children:e.jsx(We,{value:b,onChange:_})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Squad Formation"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"Leader"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.leader&&e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:s.leader.id,name:s.leader.name,type:"squad-leader",size:"lg",className:"border-2 border-blue-400"}),e.jsx("button",{onClick:()=>J(s.leader.id,!0),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]}),!s.leader&&e.jsx("button",{onClick:()=>{L("leader"),T(!0)},className:"w-20 h-20 rounded-lg border-2 border-dashed border-blue-500/50 flex items-center justify-center hover:border-blue-500",children:e.jsx(de,{className:"w-6 h-6 text-blue-500/50"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"Squad Members"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.characters.map(O=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:O.id,name:O.name,type:"squad-member",size:"md",className:"border-2 border-white/20"}),e.jsx("button",{onClick:()=>J(O.id,!1),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},O.id)),s.characters.length<4&&e.jsx("button",{onClick:()=>{L("member"),T(!0)},className:"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40",children:e.jsx(de,{className:"w-4 h-4 text-white/40"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:x,onChange:O=>u(O.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none",rows:2,placeholder:"Add any additional notes about this squad..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"twOmicron",checked:N,onChange:O=>q(O.target.checked),className:`w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500 \r
                           focus:ring-blue-500 focus:ring-offset-space-darker`}),e.jsx("label",{htmlFor:"twOmicron",className:"ml-2 text-sm text-white",children:"Requires Territory Wars Omicron"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Counters"}),e.jsx(He,{defense:s,onAddCounter:()=>h(s)})]}),e.jsx(Be,{counters:X,targetDefense:s,onEdit:n,onDelete:l})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",disabled:d,children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:!m||d,className:`px-4 py-2 rounded-lg ${!m||d?"bg-gray-500 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white`,children:d?"Saving...":"Save Changes"})]})]})]})}),e.jsx(Q,{children:p&&e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center",children:e.jsxs(C.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-space-darker p-6 rounded-lg max-w-md w-full mx-4 border border-white/10",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Delete Squad"}),e.jsx("p",{className:"text-white/70 mb-6",children:"Are you sure you want to delete this squad? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",children:"Cancel"}),e.jsx("button",{onClick:G,className:"px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600",children:"Delete"})]})]})})}),d&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(ye,{size:"lg"})}),$&&e.jsx(Ze,{type:"character",isOpen:$,onClose:()=>T(!1),onSelect:O=>{ie(O,V==="leader"),T(!1)},availableUnits:a,alignment:s.alignment,selectionType:V,title:`Select ${V==="leader"?"Leader":"Member"}`})]})},Ms=({squads:s,counters:t,availableUnits:a,onUpdate:r,onDelete:i,onAddCounter:c,onEditCounter:n,onDeleteCounter:l})=>{const{isOnline:h,isLoading:m}=ve(),[d,g]=o.useState(!1),[w,p]=o.useState(null),[f,b]=o.useState(null),_=async u=>{if(!h){b("Cannot save while offline");return}try{g(!0),await r(u),b(null)}catch(N){console.error("Error updating squad:",N),b("Failed to update squad")}finally{g(!1)}},x=async u=>{try{await i(u),b(null)}catch(N){console.error("Error deleting squad:",N),b("Failed to delete squad")}};return m?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(ye,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[!h&&e.jsxs(te,{children:[e.jsx(se,{children:"Offline Mode"}),e.jsx(ae,{children:"You are currently offline. Changes will be saved when you reconnect."})]}),f&&e.jsxs(te,{variant:"destructive",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(se,{children:"Error"}),e.jsx(ae,{children:f})]}),s.map(u=>e.jsxs("div",{className:"p-4 rounded-lg bg-space-dark border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[u.leader&&e.jsx(D,{id:u.leader.id,name:u.leader.name,type:"squad-leader",size:"md",className:"border-2 border-blue-400"}),u.characters.map(N=>e.jsx(D,{id:N.id,name:N.name,type:"squad-member",size:"md",className:"border-2 border-white/20"},N.id))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:u.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs
                    ${u.alignment==="light"?"bg-blue-500/20 text-blue-400":"bg-red-500/20 text-red-400"}`,children:u.alignment==="light"?"Light Side":"Dark Side"}),u.twOmicronRequired&&e.jsx("span",{className:"inline-block px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400",children:"TW Omicron"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{defense:u,onAddCounter:()=>c(u),disabled:!h}),e.jsx("button",{onClick:()=>p(u),className:"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg",disabled:!h,children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),u.description&&e.jsx("div",{className:"mt-2 text-sm text-white/60",children:u.description}),e.jsx("div",{className:"mt-4",children:e.jsx(Be,{counters:t.filter(N=>N.targetSquad.id===u.id),targetDefense:u,onEdit:n,onDelete:l})})]},u.id)),w&&e.jsx(Rs,{squad:w,counters:t,availableUnits:a,onClose:()=>{p(null),b(null)},onUpdate:_,onDelete:x,onUpdateCounter:n,onDeleteCounter:l,onAddCounter:c,isOnline:h,saving:d})]})},Ws=({fleet:s,counters:t,availableUnits:a,onClose:r,onUpdate:i,onDelete:c,onUpdateCounter:n,onDeleteCounter:l,onSelectForCounter:h})=>{const[m,d]=o.useState(s.name),[g,w]=o.useState(s.callOrder||""),[p,f]=o.useState(!1),[b,_]=o.useState(s.alignment),[x,u]=o.useState(!1),[N,q]=o.useState("capital"),[$,T]=o.useState(!1),[V,L]=o.useState(null),{isOnline:Y}=ve(),G=async()=>{if(!Y){L("Cannot save while offline");return}try{T(!0);const E={...s,name:m,alignment:b,id:ge(m),callOrder:g.trim()||void 0};await i(E),r()}catch(E){console.error("Error saving fleet:",E),L("Failed to save fleet")}finally{T(!1)}},J=async()=>{if(!Y){L("Cannot delete while offline");return}try{T(!0),await c(s.id),r()}catch(E){console.error("Error deleting fleet:",E),L("Failed to delete fleet")}finally{T(!1)}},ie=(E,W)=>{const z={...E,id:ge(E.name)},M={...s};switch(W){case"capital":M.capitalShip=z;break;case"starting":M.startingLineup.length<3&&(M.startingLineup=[...M.startingLineup,z]);break;case"reinforcement":M.reinforcements.length<3&&(M.reinforcements=[...M.reinforcements,z]);break}i(M)},X=(E,W)=>{const z={...s};switch(W){case"capital":z.capitalShip=null;break;case"starting":z.startingLineup=z.startingLineup.filter(M=>M.id!==E);break;case"reinforcement":z.reinforcements=z.reinforcements.filter(M=>M.id!==E);break}i(z)},O=t.filter(E=>E.targetSquad.id===s.id);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto",children:[e.jsx("div",{className:"min-h-full w-full flex items-start justify-center py-8",children:e.jsxs("div",{className:"relative w-full max-w-4xl mx-4 bg-space-darker rounded-lg border border-white/10",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex justify-between items-center p-4 border-b border-white/10 bg-space-darker",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Fleet"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(!0),className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:r,className:"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Fleet Name"}),e.jsx("input",{type:"text",value:m,onChange:E=>d(E.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white"})]}),e.jsx("div",{children:e.jsx(We,{value:b,onChange:_})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Fleet Formation"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"Capital Ship"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.capitalShip&&e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:s.capitalShip.id,name:s.capitalShip.name,type:"capital-ship",size:"lg",className:"border-2 border-blue-400"}),e.jsx("button",{onClick:()=>X(s.capitalShip.id,"capital"),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]}),!s.capitalShip&&e.jsx("button",{onClick:()=>{q("capital"),u(!0)},className:"w-20 h-20 rounded-lg border-2 border-dashed border-blue-500/50 flex items-center justify-center hover:border-blue-500",children:e.jsx(de,{className:"w-6 h-6 text-blue-500/50"})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"Starting Lineup"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.startingLineup.map(E=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:E.id,name:E.name,type:"ship",size:"md",className:"border-2 border-white/20"}),e.jsx("button",{onClick:()=>X(E.id,"starting"),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},E.id)),s.startingLineup.length<3&&e.jsx("button",{onClick:()=>{q("starting"),u(!0)},className:"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40",children:e.jsx(de,{className:"w-4 h-4 text-white/40"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"Reinforcements"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.reinforcements.map((E,W)=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:E.id,name:E.name,type:"ship",size:"md",className:"border-2 border-white/20"}),e.jsx("div",{className:"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs",children:W+1}),e.jsx("button",{onClick:()=>X(E.id,"reinforcement"),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600",children:e.jsx(I,{className:"w-3 h-3 text-white"})})]},E.id)),s.reinforcements.length<3&&e.jsx("button",{onClick:()=>{q("reinforcement"),u(!0)},className:"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40",children:e.jsx(de,{className:"w-4 h-4 text-white/40"})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Call Order"}),e.jsx("textarea",{value:g,onChange:E=>w(E.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none",rows:2,placeholder:"Enter reinforcement call order strategy..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Counters"}),e.jsx(He,{defense:s,onAddCounter:()=>h(s),disabled:!Y||$})]}),e.jsx(Be,{counters:O,targetDefense:s,onEdit:n,onDelete:l})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",children:"Cancel"}),e.jsx("button",{onClick:G,className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600",disabled:!Y||$,children:"Save Changes"})]})]})]})}),e.jsx(Q,{children:p&&e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center",children:e.jsxs(C.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-space-darker p-6 rounded-lg max-w-md w-full mx-4 border border-white/10",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Delete Fleet"}),e.jsx("p",{className:"text-white/70 mb-6",children:"Are you sure you want to delete this fleet? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20",children:"Cancel"}),e.jsx("button",{onClick:J,className:"px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600",disabled:!Y||$,children:"Delete"})]})]})})}),x&&e.jsx(Ze,{type:"ship",isOpen:x,onClose:()=>u(!1),onSelect:E=>{ie(E,N),u(!1)},availableUnits:a,alignment:s.alignment,selectionType:N,title:`Select ${N==="capital"?"Capital Ship":N==="starting"?"Starting Ship":"Reinforcement"}`}),$&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(ye,{size:"lg"})}),V&&e.jsxs(te,{variant:"destructive",children:[e.jsx(se,{children:"Error"}),e.jsxs(ae,{className:"flex justify-between items-center",children:[V,e.jsx("button",{onClick:()=>L(null),className:"ml-2 text-red-400 hover:text-red-300",children:e.jsx(I,{className:"w-4 h-4"})})]})]})]})},Bs=({fleets:s,counters:t,availableUnits:a,onUpdate:r,onDelete:i,onAddCounter:c,onEditCounter:n,onDeleteCounter:l})=>{const{isOnline:h,isLoading:m}=ve(),[d,g]=o.useState(null),[w,p]=o.useState(!1),[f,b]=o.useState(null),_=async x=>{if(!h){b("Cannot save while offline");return}try{p(!0),await r(x),b(null)}catch(u){throw console.error("Error updating fleet:",u),b("Failed to update fleet"),u}finally{p(!1)}};return m?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(ye,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[!h&&e.jsxs(te,{children:[e.jsx(se,{children:"Offline Mode"}),e.jsx(ae,{children:"You are currently offline. Changes will be saved when you reconnect."})]}),f&&e.jsxs(te,{variant:"destructive",children:[e.jsx(se,{children:"Error"}),e.jsxs(ae,{className:"flex justify-between items-center",children:[f,e.jsx("button",{onClick:()=>b(null),className:"ml-2 text-red-400 hover:text-red-300",children:e.jsx(I,{className:"w-4 h-4"})})]})]}),s.map(x=>e.jsxs("div",{className:"p-4 rounded-lg bg-space-dark border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[x.capitalShip&&e.jsx(D,{id:x.capitalShip.id,name:x.capitalShip.name,type:"capital-ship",size:"md",className:"border-2 border-blue-400"}),x.startingLineup.map(u=>e.jsx(D,{id:u.id,name:u.name,type:"ship",size:"md",className:"border-2 border-white/20"},u.id))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:x.name}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs mt-1
                    ${x.alignment==="light"?"bg-blue-500/20 text-blue-400":"bg-red-500/20 text-red-400"}`,children:x.alignment==="light"?"Light Side":"Dark Side"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{defense:x,onAddCounter:()=>c(x),disabled:!h||w}),e.jsx("button",{onClick:()=>g(x),className:"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:!h||w,children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),x.reinforcements.length>0&&e.jsxs("div",{className:"mt-4 border-t border-white/10 pt-4",children:[e.jsx("span",{className:"text-sm text-white/40 block mb-2",children:"Reinforcements:"}),e.jsx("div",{className:"flex items-center gap-2",children:x.reinforcements.map((u,N)=>e.jsxs("div",{className:"relative",children:[e.jsx(D,{id:u.id,name:u.name,type:"ship",size:"sm",className:"border-2 border-white/20"}),e.jsx("div",{className:`absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full \r
                                  flex items-center justify-center text-white text-xs`,children:N+1})]},u.id))})]}),x.callOrder&&e.jsx("div",{className:"mt-2 text-sm text-white/60",children:x.callOrder}),e.jsx("div",{className:"mt-4",children:e.jsx(Be,{counters:t.filter(u=>u.targetSquad.id===x.id),targetDefense:x,onEdit:n,onDelete:l})})]},x.id)),d&&e.jsx(Ws,{fleet:d,counters:t,availableUnits:a,onClose:()=>{g(null),b(null)},onUpdate:_,onDelete:i,onUpdateCounter:n,onDeleteCounter:l,onSelectForCounter:c})]})},Hs=({error:s,onDismiss:t})=>s?e.jsxs(te,{variant:"destructive",className:"mb-4",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"Error"})]}),e.jsx("button",{onClick:t,className:"text-red-400 hover:text-red-300",children:e.jsx(I,{className:"w-4 h-4"})})]})}),e.jsx(ae,{children:s})]}):null,Gs=({squads:s,fleets:t,counters:a,onUpdateSquad:r,onDeleteSquad:i,onUpdateFleet:c,onDeleteFleet:n,onAddCounter:l,onDeleteCounter:h,onLogout:m})=>{const[d,g]=o.useState("squads"),[w,p]=o.useState(null),[f,b]=o.useState(!1),[_,x]=o.useState(null),[u,N]=o.useState([]),[q,$]=o.useState([]),[T,V]=o.useState(null),[L,Y]=o.useState(!1),{isOnline:G,error:J}=ve(),{isAdmin:ie,currentUser:X}=Xe(),[O,E]=o.useState([]),[W,z]=o.useState(!1),[M,v]=o.useState(""),[A,H]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const{characters:P,ships:re,capital_ships:we}=await vs(async()=>{const{characters:St,ships:_t,capital_ships:kt}=await import("./initialData-Bghu_pyR.js");return{characters:St,ships:_t,capital_ships:kt}},[],import.meta.url);console.log("Loading initial units:",{charactersCount:Object.keys(P).length,shipsCount:Object.keys(re).length,capitalShipsCount:Object.keys(we).length});const De=Object.values(P),tt=[...Object.values(re),...Object.values(we)];N(De),$(tt),console.log("Units loaded into state:",{charactersLoaded:De.length,shipsLoaded:tt.length})}catch(P){console.error("Failed to load units:",P),p("Failed to load available units")}})()},[]);const j=F=>{const P=!("leader"in F),re=P?q:u;console.log("Adding counter for:",{defenseType:P?"Fleet":"Squad",defenseName:F.name,availableUnits:re.length}),x(F),H(P),b(!0),p(null)},S=async F=>{if(!G||!ie||!X){p("Not authorized or offline");return}try{console.log("AdminDashboard: Saving counter data:",F),await l(F),b(!1),x(null),p(null)}catch(P){console.error("Error saving counter:",P);const re=P instanceof Error?P.message:"Failed to save counter";p(re)}},y=async F=>{try{console.log("AdminDashboard handling delete for counter:",F),await R.deleteCounter(F),h(F)}catch(P){console.error("Error deleting counter:",P),p("Failed to delete counter")}},k=(F,P)=>{const re=Date.now().toString();E(we=>[...we,{id:re,type:F,message:P}]),setTimeout(()=>{E(we=>we.filter(De=>De.id!==re))},3e3)},B=o.useCallback(async F=>{try{if(!G){p("Cannot save while offline");return}F.type==="squad"?(await R.addOrUpdateSquad(F),r(F),k("success","Squad saved successfully")):(await R.addOrUpdateFleet(F),c(F),k("success","Fleet saved successfully")),p(null)}catch(P){console.error("Error saving defense:",P),k("error","Failed to save defense")}},[G,r,c]),Z=async F=>{try{localStorage.setItem("adminUsers",JSON.stringify(F.users)),k("success","Settings saved successfully"),z(!1)}catch{k("error","Failed to save settings")}},ue=w||J,Ne=async F=>{x(F.targetSquad),b(!0),V(F),p(null)},Se=()=>{Y(!1)};return e.jsx("div",{className:"min-h-screen bg-space-darker",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-orbitron text-white flex items-center gap-2",children:[e.jsx(dt,{className:"w-6 h-6"}),"Defense Manager"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>Y(!0),className:`flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500 \r
                       text-white hover:bg-blue-600`,children:[e.jsx(de,{className:"w-4 h-4"}),"Add New Defense"]}),e.jsx(Ps,{}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>z(!0),className:`p-2 text-blue-400/70 hover:text-blue-400 \r
                       hover:bg-blue-400/10 rounded-lg transition-colors`,children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:m,className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                       bg-red-500/20 text-red-400 hover:bg-red-500/30`,children:[e.jsx(ut,{className:"w-4 h-4"}),"Logout"]})]})]}),e.jsx(Hs,{error:ue,onDismiss:()=>p(null)}),e.jsxs(Ae,{fallback:e.jsx("div",{className:"min-h-screen bg-space-darker flex items-center justify-center",children:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Admin Dashboard Error"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4",children:"There was an error loading the admin dashboard. Please try logging in again."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:`px-4 py-2 rounded-lg bg-red-500/20 text-red-400 \r
                             hover:bg-red-500/30`,children:"Logout"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-4 py-2 rounded-lg \r
                             bg-blue-500 text-white hover:bg-blue-600`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Refresh"]})]})]})}),children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>g("squads"),className:`px-4 py-2 rounded-lg flex items-center gap-2 ${d==="squads"?"bg-blue-500 text-white":"bg-white/5 text-white/60"}`,children:[e.jsx(Ue,{className:"w-4 h-4"}),"Squad Defense"]}),e.jsxs("button",{onClick:()=>g("fleets"),className:`px-4 py-2 rounded-lg flex items-center gap-2 ${d==="fleets"?"bg-blue-500 text-white":"bg-white/5 text-white/60"}`,children:[e.jsx(qe,{className:"w-4 h-4"}),"Fleet Defense"]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-96",children:e.jsx(et,{value:M,onChange:v,onClear:()=>v(""),placeholder:`Search ${d}...`})})}),e.jsx("div",{className:"space-y-6",children:d==="squads"?e.jsx(Ms,{squads:s.filter(F=>F.name.toLowerCase().includes(M.toLowerCase())),counters:a.filter(F=>"leader"in F.targetSquad),availableUnits:u,onUpdate:r,onDelete:i,onAddCounter:j,onEditCounter:Ne,onDeleteCounter:y}):e.jsx(Bs,{fleets:t.filter(F=>F.name.toLowerCase().includes(M.toLowerCase())),counters:a.filter(F=>!("leader"in F.targetSquad)),availableUnits:q,onUpdate:c,onDelete:n,onAddCounter:j,onEditCounter:Ne,onDeleteCounter:y})})]}),f&&_&&e.jsx(_s,{isOpen:f,onClose:()=>{b(!1),x(null),V(null),p(null)},targetDefense:_,onSave:S,onDelete:y,availableUnits:"leader"in _?u:q,existingCounter:T,isFleet:A}),L&&e.jsx(Ts,{isOpen:L,onClose:Se,onSave:B,initialType:d==="squads"?"squad":"fleet",availableUnits:d==="squads"?u:q}),W&&e.jsx($s,{onClose:()=>z(!1),onSave:Z}),e.jsx(zs,{notifications:O,onDismiss:F=>E(P=>P.filter(re=>re.id!==F))})]})})},Vs=({onLogin:s,onClose:t})=>{const[a,r]=o.useState(!1),[i,c]=o.useState({email:"",password:""}),[n,l]=o.useState(!1),{login:h,error:m}=Xe(),[d,g]=o.useState(null),[w,p]=o.useState(0);o.useEffect(()=>{m&&g(m)},[m]);const f=async b=>{b.preventDefault(),g(null),l(!0);try{if(w>=5)throw new Error("Too many login attempts. Please try again later.");await h(i.email,i.password),s(!0),t()}catch(_){console.error("Login error:",_),p(x=>x+1),g(_ instanceof Error?_.message:"Failed to login")}finally{l(!1)}};return e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx(C.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-md bg-space-darker rounded-lg border border-white/10",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Admin Login"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:i.email,onChange:b=>c({...i,email:b.target.value}),className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white",placeholder:"Enter email",required:!0,disabled:n}),e.jsx(ts,{className:"absolute left-3 top-2.5 h-5 w-5 text-white/40"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:a?"text":"password",value:i.password,onChange:b=>c({...i,password:b.target.value}),className:"w-full pl-10 pr-12 py-2 bg-white/5 border border-white/10 rounded-lg text-white",placeholder:"Enter password",required:!0,disabled:n}),e.jsx(ss,{className:"absolute left-3 top-2.5 h-5 w-5 text-white/40"}),e.jsx("button",{type:"button",onClick:()=>r(!a),className:"absolute right-3 top-2.5 text-white/40 hover:text-white",disabled:n,children:a?e.jsx(as,{className:"h-5 w-5"}):e.jsx(rs,{className:"h-5 w-5"})})]})]}),e.jsx(Q,{children:d&&e.jsxs(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-3 rounded-lg bg-red-500/10 border border-red-500/20 \r
                           flex items-start gap-2 text-red-400 text-sm`,children:[e.jsx(gt,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:d})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:`px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 \r
                         disabled:opacity-50 disabled:cursor-not-allowed`,disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||w>=5,className:`px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 \r
                         disabled:opacity-50 disabled:cursor-not-allowed relative`,children:n?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(C.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full"}),"Logging in..."]}):"Login"})]}),w>=5&&e.jsx(C.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-yellow-400 mt-4",children:"Too many login attempts. Please try again later."})]})]})})})},Ys=({title:s,subtitle:t,className:a,withAnimation:r=!0,onAction:i,children:c,...n})=>{const l=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),i==null||i())};return e.jsxs(C.div,{role:"region","aria-label":s||"Hero section","aria-live":"polite",tabIndex:0,onKeyDown:l,initial:r?{opacity:0,y:20}:!1,animate:r?{opacity:1,y:0}:!1,transition:{duration:.5},className:fe("relative overflow-hidden hero-section","min-h-[300px] py-16 px-4",a),...n,children:[e.jsx("div",{className:"absolute inset-0 bg-hero-pattern bg-cover sm:bg-contain bg-center animate-pulse-slow"}),e.jsx("div",{className:"absolute inset-0 bg-grid-pattern bg-grid opacity-20"}),e.jsx(C.div,{animate:{opacity:[.4,.6,.4],scale:[1,1.1,1.2]},transition:{duration:4,repeat:1/0,repeatType:"reverse"},className:"absolute inset-0 bg-glow-pattern transform-none sm:scale-110 md:scale-125"}),e.jsxs("div",{className:"relative z-10 container mx-auto",children:[s&&e.jsx(C.h1,{initial:r?{opacity:0,y:20}:!1,animate:r?{opacity:1,y:0}:!1,transition:{delay:.2},className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-orbitron text-white text-center mb-4 tracking-wider",children:s}),t&&e.jsx(C.p,{initial:r?{opacity:0,y:20}:!1,animate:r?{opacity:1,y:0}:!1,transition:{delay:.3},className:"text-xl sm:text-2xl lg:text-3xl text-white/80 text-center mb-8 max-w-3xl mx-auto",children:t}),e.jsx(C.div,{initial:r?{opacity:0,y:20}:!1,animate:r?{opacity:1,y:0}:!1,transition:{delay:.4},children:c})]})]})},ot={showEditor:!1,targetDefense:null,editingCounter:null},Ks=o.createContext(void 0),Qs=({children:s})=>{const[t,a]=o.useState(ot),{isOnline:r}=ve(),i=o.useCallback(l=>{a(h=>({...h,...l}))},[]),c=o.useCallback(()=>{a(ot)},[]),n=o.useCallback(async l=>{if(!r)throw new Error("Cannot update counter while offline");try{await R.addOrUpdateCounter(l),a(h=>({...h,editingCounter:null}))}catch(h){throw console.error("Failed to update counter:",h),h}},[r]);return e.jsx(Ks.Provider,{value:{state:t,updateState:i,resetState:c,updateCounter:n},children:s})},Js=o.createContext(null);function Zs({children:s}){const[t,a]=o.useState(()=>localStorage.getItem("theme")||"dark");o.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.classList.toggle("light-theme",t==="light"),document.documentElement.classList.toggle("dark-theme",t==="dark")},[t]);const r=()=>{a(i=>i==="dark"?"light":"dark")};return e.jsx(Js.Provider,{value:{theme:t,toggleTheme:r},children:s})}const Xs=()=>{const s="Squads";return e.jsxs(e.Fragment,{children:[e.jsxs(is,{children:[e.jsx("title",{children:`SWGOH TW Counters - ${s}`}),e.jsx("meta",{name:"description",content:`View ${s} counters for SWGOH Territory Wars`}),e.jsx("meta",{property:"og:title",content:`SWGOH TW Counters - ${s}`}),e.jsx("meta",{property:"og:description",content:`View ${s} counters for SWGOH Territory Wars`})]}),e.jsx(Ae,{fallback:e.jsx("div",{className:"min-h-screen bg-space-darker flex items-center justify-center",children:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full text-center",children:[e.jsx(he,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-red-400 mb-2",children:"Application Error"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-6",children:"We apologize, but something went wrong with the application. Please try refreshing the page."}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-6 py-3 rounded-lg 
                         bg-red-500/20 text-red-400 hover:bg-red-500/30 mx-auto`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Reload Application"]})]})}),children:e.jsx(Es,{children:e.jsx(Nt,{children:e.jsx(Zs,{children:e.jsx(Qs,{children:e.jsx(ea,{})})})})})})]})};function ct(s,t){return Array.isArray(s)?s.filter(a=>{if(t.searchTerm){const r=t.searchTerm.toLowerCase(),i=a.name.toLowerCase().includes(r);if("characters"in a){const c=a.characters.some(l=>l.name.toLowerCase().includes(r)),n=a.leader&&a.leader.name.toLowerCase().includes(r);if(!i&&!c&&!n)return!1}else if(!i)return!1}return!(t.alignment&&a.alignment!==t.alignment||t.showTWOmicronOnly&&"twOmicronRequired"in a&&!a.twOmicronRequired||t.excludeGL&&"characters"in a&&(a.characters.some(i=>i.isGalacticLegend)||a.leader&&a.leader.isGalacticLegend))}):[]}function ea(){const[s,t]=o.useState(null),{isOnline:a,isLoading:r}=ve(),{isAdmin:i,loading:c,logout:n}=Xe(),[l,h]=o.useState(!1),[m,d]=o.useState("squads"),[g,w]=o.useState([]),[p,f]=o.useState([]),[b,_]=o.useState([]),[x,u]=o.useState(null),[N,q]=o.useState(!0),[$,T]=o.useState(!1),[V,L]=o.useState(""),[Y,G]=o.useState(!1),[J,ie]=o.useState({battleType:null,alignment:null,showTWOmicronOnly:!1,showHardCounters:!1,excludeGL:!1,searchTerm:""});o.useEffect(()=>{(async()=>{q(!0),t(null);try{await ft();const{squads:S,fleets:y,counters:k}=await R.syncAllData();w(S),f(y),_(k),T(!1)}catch(S){console.error("Failed to initialize app:",S),t("Failed to load application data. Please try again.")}finally{q(!1)}})()},[]);const X=m==="squads"?ct(g,J):[],O=m==="fleets"?ct(p,J):[],E=o.useCallback((j,S)=>!b||!j?[]:b.filter(y=>{var k,B,Z,ue,Ne;if(S==="squad"){const Se=((k=y==null?void 0:y.targetSquad)==null?void 0:k.id)===j,F=((B=y==null?void 0:y.counterSquad)==null?void 0:B.id)===j;return Se||F}else{const Se=((Z=y==null?void 0:y.targetSquad)==null?void 0:Z.id)===j,F=((ue=y==null?void 0:y.counterSquad)==null?void 0:ue.id)===j,P="capitalShip"in y.targetSquad&&((Ne=y.targetSquad.capitalShip)==null?void 0:Ne.id)===j;return Se||F||P}}),[b]);o.useEffect(()=>{!N&&$&&(async()=>{try{await Promise.all([...g.map(S=>R.addOrUpdateSquad(S)),...p.map(S=>R.addOrUpdateFleet(S)),...b.map(S=>R.addOrUpdateCounter(S))]),T(!1)}catch(S){console.error("Error saving data:",S)}})()},[g,p,b,N,$]),o.useEffect(()=>{const j=S=>{$&&(S.preventDefault(),S.returnValue="")};return window.addEventListener("beforeunload",j),()=>window.removeEventListener("beforeunload",j)},[$]);const W=()=>{h(!1)},z=async()=>{try{if($&&!window.confirm("Du har osparade ndringar. Vill du verkligen logga ut?"))return;await n(),h(!1)}catch(j){console.error("Error logging out:",j)}},M=(j,S)=>{ie(y=>({...y,[j]:S})),u(null)},v=j=>{L(j),ie(S=>({...S,searchTerm:j}))},A=async j=>{if(!a){t("Cannot delete counter while offline");return}try{console.log("Starting delete counter process for:",j),await R.deleteCounter(j),_(S=>S.filter(y=>y.id!==j)),console.log("Counter removed from local state"),t(null)}catch(S){console.error("Error deleting counter:",S);const y=S instanceof Error?S.message:"Failed to delete counter";y!=="Counter not found"&&t(y)}},H={onUpdateSquad:async j=>{try{await R.addOrUpdateSquad(j),w(S=>{const y=S.findIndex(k=>k.id===j.id);if(y>=0){const k=[...S];return k[y]=j,k}return[...S,j]})}catch(S){console.error("Error updating squad:",S)}},onDeleteSquad:async j=>{if(!a){t("Cannot delete while offline");return}try{const S=b.filter(y=>{var k,B;return(((k=y==null?void 0:y.targetSquad)==null?void 0:k.id)===j||((B=y==null?void 0:y.counterSquad)==null?void 0:B.id)===j)&&(y==null?void 0:y.id)});await Promise.all(S.map(y=>R.deleteCounter(y.id))),await R.deleteSquad(j),_(y=>y.filter(k=>{var B,Z;return((B=k==null?void 0:k.targetSquad)==null?void 0:B.id)!==j&&((Z=k==null?void 0:k.counterSquad)==null?void 0:Z.id)!==j})),w(y=>y.filter(k=>k.id!==j))}catch(S){console.error("Error deleting squad:",S),t("Failed to delete squad and its counters")}},onUpdateFleet:async j=>{try{await R.addOrUpdateFleet(j),f(S=>{const y=S.findIndex(k=>k.id===j.id);if(y>=0){const k=[...S];return k[y]=j,k}return[...S,j]})}catch(S){console.error("Error updating fleet:",S)}},onDeleteFleet:async j=>{if(!a){t("Cannot delete while offline");return}try{const S=b.filter(y=>{var k,B,Z;return(((k=y==null?void 0:y.targetSquad)==null?void 0:k.id)===j||((B=y==null?void 0:y.counterSquad)==null?void 0:B.id)===j||(y==null?void 0:y.targetSquad)&&"capitalShip"in y.targetSquad&&((Z=y.targetSquad.capitalShip)==null?void 0:Z.id)===j)&&(y==null?void 0:y.id)});await Promise.all(S.map(y=>R.deleteCounter(y.id))),await R.deleteFleet(j),_(y=>y.filter(k=>{var B,Z,ue;return((B=k==null?void 0:k.targetSquad)==null?void 0:B.id)!==j&&((Z=k==null?void 0:k.counterSquad)==null?void 0:Z.id)!==j&&!("capitalShip"in(k==null?void 0:k.targetSquad)&&((ue=k.targetSquad.capitalShip)==null?void 0:ue.id)===j)})),f(y=>y.filter(k=>k.id!==j))}catch(S){console.error("Error deleting fleet:",S),t("Failed to delete fleet and its counters")}},onAddCounter:async j=>{try{const S={...j,id:`counter-${Date.now()}`},y=await R.addOrUpdateCounter(S);_(k=>k.filter(B=>B.id!==y.id).concat(y))}catch(S){console.error("Error adding counter:",S)}},onDeleteCounter:async j=>{if(!a){t("Cannot delete counter while offline");return}try{console.log("Starting delete counter process for:",j),await R.deleteCounter(j),_(S=>S.filter(y=>y.id!==j)),console.log("Counter deleted and state updated")}catch(S){console.error("Error deleting counter:",S);const y=S instanceof Error?S.message:"Failed to delete counter";t(y)}},onUpdateCounter:async j=>{try{await R.addOrUpdateCounter(j),_(S=>{const y=S.findIndex(k=>k.id===j.id);if(y>=0){const k=[...S];return k[y]=j,k}return S})}catch(S){console.error("Error updating counter:",S)}}};return r||c||N?e.jsx("div",{className:"min-h-screen bg-space-black flex items-center justify-center",children:e.jsx(ye,{size:"lg",message:"Loading application data..."})}):s?e.jsx("div",{className:"min-h-screen bg-space-black flex items-center justify-center",children:e.jsxs("div",{className:"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full text-center",children:[e.jsx(he,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-red-400 mb-2",children:"Application Error"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-6",children:s}),e.jsxs("button",{onClick:()=>window.location.reload(),className:`flex items-center gap-2 px-6 py-3 rounded-lg 
                     bg-red-500/20 text-red-400 hover:bg-red-500/30 mx-auto`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Retry Loading"]})]})}):e.jsxs("div",{className:"min-h-screen bg-space-black text-white",children:[!a&&e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-yellow-500/90 text-black py-2 px-4 text-center z-50",children:"Du r offline. ndringar kommer att synkroniseras nr du teransluter."}),e.jsxs("div",{className:"min-h-screen bg-space-gradient bg-fixed",children:[e.jsx(Q,{mode:"wait",children:i?e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(Gs,{squads:g,fleets:p,counters:b,...H,onLogout:z})},"admin-interface"):e.jsxs(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(os,{isAdmin:i,onAdminClick:()=>h(!0),onLogout:z}),e.jsx(Ys,{title:"SWGOH Territory Wars",subtitle:"Find the perfect counter for any squad or fleet",children:e.jsx(cs,{activeView:m,onViewChange:d,onOptionsClick:()=>G(!0),filters:J,children:e.jsx(et,{value:V,onChange:v,onClear:()=>v(""),suggestions:m==="squads"?X:O,onSelectSuggestion:j=>{u(j.id),v("")},placeholder:`Search ${m==="squads"?"teams":"fleets"}...`})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx(Q,{mode:"wait",children:N?e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center min-h-[400px]",children:e.jsx(C.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-saber-blue-400/50 border-t-saber-blue-400 rounded-full"})},"loading"):e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:m==="squads"?e.jsx(fs,{squads:g,filteredSquads:X,selectedSquadId:x,onSelectSquad:u,getCounters:j=>E(j,"squad"),isAdmin:i,onDeleteCounter:A,onViewDetails:()=>{}}):e.jsx(bs,{fleets:p,filteredFleets:O,selectedFleetId:x,onSelectFleet:u,getCounters:j=>E(j,"fleet"),isAdmin:i,onDeleteCounter:A,onViewDetails:()=>{}})},`content-${m}`)})}),e.jsx(ws,{isOpen:Y,onClose:()=>G(!1),filters:J,onFilterChange:M})]},"user-interface")}),l&&e.jsx(Vs,{onLogin:W,onClose:()=>h(!1)})]})]})}ns(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Nt,{children:e.jsx(Xs,{})})}));
//# sourceMappingURL=index-CNhLMpj-.js.map
