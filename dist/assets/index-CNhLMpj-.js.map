{"version":3,"mappings":"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","names":["GlassCard","onClick","children","variant","glowColor","isInteractive","isSelected","className","motionProps","baseClasses","variantClasses","glowClasses","interactiveClasses","selectedClasses","jsx","motion","ContactModal","isOpen","onClose","formStatus","setFormStatus","useState","errorMessage","setErrorMessage","handleFormSubmit","event","form","formData","error","jsxs","Fragment","AnimatePresence","X","Heart","Database","Coffee","Header","isAdmin","onLogout","onAdminClick","showModal","setShowModal","Star","Mail","LogOut","Settings","SearchPanel","activeView","onViewChange","onOptionsClick","filters","hasActiveFilters","Users","Ship","firebaseConfig","_FirebaseClient","__publicField","getApps","initializeApp","getAuth","initializeFirestore","CACHE_SIZE_UNLIMITED","getStorage","enableMultiTabIndexedDbPersistence","onAuthStateChanged","user","FirebaseClient","firebaseClient","auth","db","storage","ensureFirebaseInitialized","characterMappings","shipMappings","logDebug","message","args","normalizeId","name","getImageFileName","id","type","normalizedId","mappings","fileName","ASSETS_BASE_PATH","DEFAULT_PLACEHOLDER","IMAGE_CACHE","LOADING_CACHE","IMAGE_SIZES","getPlaceholderDataUrl","size","width","height","getUnitImage","cacheKey","loadingPromise","imagePath","imageRef","ref","url","getDownloadURL","localPath","cn","inputs","twMerge","clsx","imageCache","SIZE_CLASSES","UnitImage","memo","withTooltip","isLeader","isCapital","onLoad","imageUrl","setImageUrl","isLoading","setIsLoading","hasError","setHasError","sizeClasses","useMemo","useEffect","isMounted","VideoIndicator","videoUrl","handleClick","e","Video","SquadCard","squad","onSelect","counters","onDeleteCounter","isFiltered","safeCounters","ErrorBoundary","char","counter","Trash2","React","props","errorInfo","AlertTriangle","RefreshCw","SquadList","squads","filteredSquads","selectedSquadId","onSelectSquad","getCounters","onViewDetails","handleSquadSelect","squadId","renderedSquads","FleetCard","fleet","onAddCounter","contentRef","useRef","fleetCounters","isTargetFleet","isCounterFleet","isTargetCapitalShip","_a","ship","step","idx","Plus","FleetList","fleets","filteredFleets","selectedFleetId","onSelectFleet","handleFleetSelect","fleetId","FiltersMenu","onFilterChange","menuRef","key","value","filterCategories","Swords","Shield","SunMedium","Moon","toggleOptions","trap","createFocusTrap","resetFilters","Filter","category","option","alertVariants","cva","Alert","React.forwardRef","AlertTitle","AlertDescription","UnitSelector","availableUnits","alignment","selectionType","title","isCounterContext","searchTerm","setSearchTerm","filteredUnits","unit","matchesSearch","handleSelect","useCallback","Search","VideoGuide","autoplay","isExpanded","setIsExpanded","isPlaying","setIsPlaying","videoId","match","thumbnailUrl","handlePlay","Play","Maximize2","CounterEditor","targetDefense","onSave","onDelete","existingCounter","isFleet","selectedUnits","setSelectedUnits","counterType","setCounterType","description","setDescription","setError","showSelector","setShowSelector","saving","setSaving","twOmicron","setTwOmicron","setVideoUrl","datacronRequired","setDatacronRequired","modRequirements","setModRequirements","req","character","descParts","handleSave","counterData","baseCounter","fleetUnits","validationError","validateFleetUnits","mod","handleDelete","getShipRole","index","units","_","i","_b","_c","prev","prevShips","squadValidators","characters","leader","SyncLock","operation","timeout","resolve","reject","wait","checkLock","SyncQueue","item","DebounceSync","delay","timer","FirebaseService","obj","cleanedObj","cleanedValue","isImportantField","change","changeRef","doc","collection","changeData","serverTimestamp","setDoc","batch","writeBatch","userId","squadRef","squadDoc","getDoc","countersQuery","query","where","getDocs","validation","isUpdate","now","normalizedSquad","docRef","hasValidShips","hasValidCapital","normalizedFleet","fleetRef","fleetDoc","counterId","timestamp","counterWithId","counterRef","counterDoc","data","processedData","Timestamp","timestampError","querySnapshot","collectionName","LoadingIndicator","variants","FirebaseContext","createContext","FirebaseProvider","isInitialized","setIsInitialized","isOnline","setIsOnline","retryCount","setRetryCount","firestoreTimeout","err","handleOnline","handleOffline","retry","useFirebase","context","useContext","STORAGE_KEYS","StorageService","storageData","defaultValue","stored","parsed","AuthContext","AuthProvider","currentUser","setCurrentUser","setIsAdmin","isMasterAdmin","setIsMasterAdmin","loading","setLoading","unsubscribe","userData","email","password","userCredential","signInWithEmailAndPassword","userRef","signOut","authError","useAuth","AlignmentDropdown","onChange","label","setIsOpen","newValue","CharacterSelector","members","onAddUnit","onRemoveUnit","showLeaderSelection","showSearch","setShowSearch","handleSelectCharacter","normalizedCharacter","handleSearchClick","filteredCharacters","searchLower","selectedIds","m","isNotSelected","matchesAlignment","member","NewSquadForm","onCancel","setName","setAlignment","setLeader","setMembers","twOmicronRequired","setTwOmicronRequired","handleSubmit","unitId","ShipSelector","capitalShip","startingLineup","reinforcements","isCounterSelector","selectionMode","setSelectionMode","handleSelectShip","position","normalizedShip","mode","filteredShips","s","matchesType","Anchor","NewFleetForm","setCapitalShip","setStartingLineup","setReinforcements","shipId","NewDefenseModal","initialType","defenseType","setDefenseType","defense","ShipIcon","NotificationManager","notifications","onDismiss","notification","Check","AlertCircle","SettingsPanel","FirebaseSync","collections","document","SyncButton","isSyncing","setIsSyncing","success","setSuccess","showFeedback","setShowFeedback","feedbackTimer","handleSync","getButtonStyles","SearchBar","onClear","suggestions","onSelectSuggestion","placeholder","filteredSuggestions","isFocused","setIsFocused","imageUrls","setImageUrls","inputRef","loadImages","urls","isSquadCounter","CounterList","onEdit","isValidCounter","getUniqueKey","relevantCounters","Edit","reqIndex","CounterButton","disabled","EditModal","onUpdate","onUpdateCounter","showDeleteConfirm","setShowDeleteConfirm","selectorMode","setSelectorMode","updatedSquad","handleRemoveCharacter","characterId","c","handleAddCharacter","squadCounters","SquadEditor","onEditCounter","editingSquad","setEditingSquad","handleUpdateSquad","handleDeleteSquad","onSelectForCounter","callOrder","setCallOrder","updatedFleet","handleAddShip","handleRemoveShip","FleetEditor","editingFleet","setEditingFleet","handleUpdate","ErrorDisplay","AdminDashboard","onUpdateSquad","onDeleteSquad","onUpdateFleet","onDeleteFleet","activeTab","setActiveTab","showCounterEditor","setShowCounterEditor","selectedDefense","setSelectedDefense","availableCharacters","setAvailableCharacters","availableShips","setAvailableShips","setExistingCounter","showNewDefenseModal","setShowNewDefenseModal","firebaseError","setNotifications","showSettings","setShowSettings","setIsFleet","ships","capital_ships","allCharacters","allShips","handleAddCounter","handleSaveCounter","handleDeleteCounter","addNotification","n","handleSaveDefense","handleSaveSettings","settings","displayError","handleEditCounter","handleCloseModal","Auth","onLogin","showPassword","setShowPassword","credentials","setCredentials","login","localError","setLocalError","attemptCount","setAttemptCount","User","Lock","EyeOff","Eye","HeroSection","subtitle","withAnimation","onAction","handleKeyDown","initialState","CounterContext","CounterProvider","state","setState","updateState","updates","resetState","updateCounter","ThemeContext","ThemeProvider","theme","setTheme","toggleTheme","current","App","currentView","Helmet","AppContent","filterUnits","nameMatch","characterMatch","leaderMatch","firebaseLoading","authLoading","logout","showAdminLogin","setShowAdminLogin","setActiveView","setSquads","setFleets","setCounters","selectedId","setSelectedId","hasUnsavedChanges","setHasUnsavedChanges","isFiltersOpen","setFiltersOpen","setFilters","getCountersForUnit","isTargetSquad","isCounterSquad","_d","_e","handleBeforeUnload","handleAdminLogin","handleAdminLogout","handleFilterChange","handleSearchChange","prevCounters","adminHandlers","newSquads","relatedCounters","f","newFleets","newCounter","savedCounter","newCounters","createRoot","StrictMode"],"ignoreList":[],"sources":["../../src/components/ui/GlassCard.tsx","../../src/components/ContactModal.tsx","../../src/components/Header.tsx","../../src/components/SearchPanel.tsx","../../src/lib/firebase.ts","../../src/lib/imageMapping.ts","../../src/lib/imageUtils.ts","../../src/lib/utils.ts","../../src/components/ui/UnitImage.tsx","../../src/components/ui/VideoIndicator.tsx","../../src/components/SquadCard.tsx","../../src/components/ErrorBoundary.tsx","../../src/components/SquadList.tsx","../../src/components/FleetCard.tsx","../../src/components/FleetList.tsx","../../src/components/filters/FiltersMenu.tsx","../../src/components/ui/alert.tsx","../../src/components/UnitSelector.tsx","../../src/components/VideoGuide.tsx","../../src/components/Counter/CounterEditor.tsx","../../src/lib/validators.ts","../../src/components/Utils/SyncUtils.ts","../../src/services/firebaseService.ts","../../src/components/ui/LoadingIndicator.tsx","../../src/contexts/FirebaseContext.tsx","../../src/services/storage.ts","../../src/contexts/AuthContext.tsx","../../src/components/admin/AlignmentDropdown.tsx","../../src/components/admin/CharacterSelector.tsx","../../src/components/admin/NewSquadForm.tsx","../../src/components/admin/ShipSelector.tsx","../../src/components/admin/NewFleetForm.tsx","../../src/components/admin/NewDefenseModal.tsx","../../src/components/admin/NotificationManager.tsx","../../src/components/admin/SettingsPanel.tsx","../../src/services/firebaseSync.ts","../../src/components/admin/SyncButton.tsx","../../src/components/SearchBar.tsx","../../src/components/admin/CounterList.tsx","../../src/components/admin/CounterButton.tsx","../../src/components/admin/SquadEditor.tsx","../../src/components/admin/FleetEditor.tsx","../../src/components/admin/AdminDashboard.tsx","../../src/components/Auth.tsx","../../src/components/layouts/HeroSection.tsx","../../src/contexts/CounterContext.tsx","../../src/contexts/ThemeContext.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["import { motion, HTMLMotionProps } from 'framer-motion';\r\nimport { ReactNode } from 'react';\r\n\r\ninterface GlassCardProps extends HTMLMotionProps<\"div\"> {\r\n  children: ReactNode;\r\n  variant?: 'light' | 'dark' | 'darker';\r\n  glowColor?: 'blue' | 'red' | 'yellow' | 'none';\r\n  isInteractive?: boolean;\r\n  isSelected?: boolean;\r\n  className?: string;\r\n  onClick?: (e: React.MouseEvent) => void;\r\n}\r\n\r\nexport const GlassCard: React.FC<GlassCardProps> = ({\r\n  onClick,\r\n  children,\r\n  variant = 'light',\r\n  glowColor = 'none',\r\n  isInteractive = false,\r\n  isSelected = false,\r\n  className = '',\r\n  ...motionProps\r\n}) => {\r\n  const baseClasses = 'rounded-lg backdrop-blur-md transition-all';\r\n  \r\n  const variantClasses = {\r\n    light: 'bg-white/5',\r\n    dark: 'bg-space-dark/80',\r\n    darker: 'bg-space-darker/90'\r\n  };\r\n\r\n  const glowClasses = {\r\n    none: '',\r\n    blue: 'shadow-neon-blue',\r\n    red: 'shadow-neon-red',\r\n    yellow: 'shadow-neon-yellow'\r\n  };\r\n\r\n  const interactiveClasses = isInteractive\r\n    ? 'cursor-pointer hover:bg-white/10'\r\n    : '';\r\n\r\n  const selectedClasses = isSelected\r\n    ? 'bg-white/10 border-blue-400'\r\n    : 'border-white/10';\r\n\r\n  return (\r\n    <motion.div\r\n      onClick={onClick}\r\n      {...motionProps}\r\n      className={`\r\n        ${baseClasses}\r\n        ${variantClasses[variant]}\r\n        ${glowClasses[glowColor]}\r\n        ${interactiveClasses}\r\n        ${selectedClasses}\r\n        ${className}\r\n      `}\r\n    >\r\n      {children}\r\n    </motion.div>\r\n  );\r\n};","import { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Heart, Coffee, Database } from 'lucide-react';\r\nimport { useState } from 'react';\r\n\r\ninterface ContactModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function ContactModal({ isOpen, onClose }: ContactModalProps) {\r\n  // State för att hantera skickad status och felmeddelanden\r\n  const [formStatus, setFormStatus] = useState<'idle' | 'sending' | 'sent' | 'error'>('idle');\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n\r\n  // Hantera formulärinlämning\r\n  const handleFormSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    setFormStatus('sending');\r\n    setErrorMessage('');\r\n  \r\n    try {\r\n      const form = event.target as HTMLFormElement;\r\n      const formData = new FormData(form);\r\n  \r\n      // För utvecklingsmiljö\r\n      if (process.env.NODE_ENV === 'development') {\r\n        await new Promise(resolve => setTimeout(resolve, 1000));\r\n        setFormStatus('sent');\r\n        form.reset();\r\n        return;\r\n      }\r\n  \r\n      // För produktion\r\n      const response = await fetch('/', {\r\n        method: 'POST',\r\n        headers: { \r\n          \"Content-Type\": \"application/x-www-form-urlencoded\" \r\n        },\r\n        body: new URLSearchParams({\r\n          'form-name': 'contact',\r\n          ...Object.fromEntries(formData)\r\n        }).toString()\r\n      });\r\n  \r\n      if (response.ok) {\r\n        setFormStatus('sent');\r\n        form.reset();\r\n        setTimeout(() => {\r\n          setFormStatus('idle');\r\n        }, 3000);\r\n      } else {\r\n        throw new Error('Form submission failed');\r\n      }\r\n    } catch (error) {\r\n      console.error('Submission error:', error);\r\n      setFormStatus('error');\r\n      setErrorMessage('Failed to send message. Please try again.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Hidden Netlify Form */}\r\n      <form name=\"contact\" data-netlify=\"true\" data-netlify-honeypot=\"bot-field\" hidden>\r\n        <input type=\"text\" name=\"name\" />\r\n        <input type=\"email\" name=\"email\" />\r\n        <textarea name=\"message\"></textarea>\r\n        <input name=\"bot-field\" />\r\n      </form>\r\n      \r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center\">\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              exit={{ opacity: 0, scale: 0.95 }}\r\n              className=\"relative w-full max-w-lg mx-4 bg-space-darker rounded-lg border border-white/10 overflow-hidden\"\r\n            >\r\n              {/* Header with glow effect */}\r\n              <div className=\"relative p-6 border-b border-white/10 bg-gradient-to-r from-blue-500/10 to-purple-500/10\">\r\n                <div className=\"absolute inset-0 bg-grid-pattern opacity-10\" />\r\n                <div className=\"relative flex justify-between items-center\">\r\n                  <h2 className=\"text-xl font-orbitron text-white\">Welcome to SWGOH TW Counter</h2>\r\n                  <button\r\n                    onClick={onClose}\r\n                    className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n                  >\r\n                    <X className=\"w-5 h-5\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div className=\"p-6 space-y-6 overflow-auto max-h-[500px]\">\r\n                {/* Mission Statement */}\r\n                <div className=\"flex items-start gap-4\">\r\n                  <Heart className=\"w-6 h-6 text-red-400 flex-shrink-0 mt-1\" />\r\n                  <p className=\"text-white/80\">\r\n                    This website is a passion project, built and maintained without any profit motive. Our mission is to help SWGOH players optimize their Territory Wars strategy.\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Infrastructure Info */}\r\n                <div className=\"flex items-start gap-4\">\r\n                  <Database className=\"w-6 h-6 text-blue-400 flex-shrink-0 mt-1\" />\r\n                  <p className=\"text-white/80\">\r\n                    While the site is free to use, there are ongoing costs for domain hosting and database maintenance. Your support helps keep this resource available to the community.\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Form Content */}\r\n                <div>\r\n                  <p className=\"text-white/80 mb-2\">Have any questions or suggestions? Feel free to drop a message:</p>\r\n\r\n                  {/* Netlify Form */}\r\n                  <form\r\n                    name=\"contact\"\r\n                    method=\"POST\"\r\n                    data-netlify=\"true\"\r\n                    data-netlify-honeypot=\"bot-field\"\r\n                    onSubmit={handleFormSubmit}\r\n                    className=\"space-y-4\"\r\n                  >\r\n                    <input type=\"hidden\" name=\"form-name\" value=\"contact\" />\r\n                    <div hidden>\r\n                      <input name=\"bot-field\" />\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col space-y-2\">\r\n                      <label htmlFor=\"name\" className=\"text-white/80\">Your Name</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"name\"\r\n                        id=\"name\"\r\n                        required\r\n                        className=\"p-2 bg-transparent border border-white/30 text-white rounded-lg\"\r\n                        placeholder=\"Your Name\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col space-y-2\">\r\n                      <label htmlFor=\"email\" className=\"text-white/80\">Your Email</label>\r\n                      <input\r\n                        type=\"email\"\r\n                        name=\"email\"\r\n                        id=\"email\"\r\n                        required\r\n                        className=\"p-2 bg-transparent border border-white/30 text-white rounded-lg\"\r\n                        placeholder=\"Your Email\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col space-y-2\">\r\n                      <label htmlFor=\"message\" className=\"text-white/80\">Your Message</label>\r\n                      <textarea\r\n                        name=\"message\"\r\n                        id=\"message\"\r\n                        required\r\n                        className=\"p-2 bg-transparent border border-white/30 text-white rounded-lg\"\r\n                        placeholder=\"Your Message\"\r\n                      />\r\n                    </div>\r\n\r\n                    <button\r\n                      type=\"submit\"\r\n                      className=\"px-6 py-3 mt-4 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-all\"\r\n                      disabled={formStatus === 'sending'}\r\n                    >\r\n                      {formStatus === 'sending' ? 'Sending...' : 'Send Message'}\r\n                    </button>\r\n                  </form>\r\n\r\n                  {/* Status Messages */}\r\n                  {formStatus === 'sent' && (\r\n                    <p className=\"mt-4 text-green-500\">Thank you for your message! We will get back to you soon.</p>\r\n                  )}\r\n                  {formStatus === 'error' && (\r\n                    <p className=\"mt-4 text-red-500\">{errorMessage}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Footer */}\r\n              <div className=\"p-2 bg-white/5 flex items-center justify-center gap-1\">\r\n                <a\r\n                  href=\"https://www.buymeacoffee.com/jbrannelid\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"flex items-center justify-center gap-1 px-4 py-2 rounded-lg bg-[#FFDD00] text-black hover:bg-[#FFDD00]/90 transition-all text-sm\"\r\n                >\r\n                  <Coffee className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:block\">Support the Project</span>\r\n                </a>\r\n              </div>\r\n            </motion.div>\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Star, Settings, LogOut, Coffee, Mail } from 'lucide-react';\r\nimport { GlassCard } from './ui/GlassCard';\r\nimport ContactModal from './ContactModal';\r\n\r\ninterface HeaderProps {\r\n  isAdmin: boolean;\r\n  onLogout: () => void;\r\n  onAdminClick: () => void;\r\n}\r\n\r\nexport const Header: React.FC<HeaderProps> = ({\r\n  isAdmin,\r\n  onLogout,\r\n  onAdminClick\r\n}) => {\r\n  const [showModal, setShowModal] = useState(false);\r\n\r\n  return (\r\n    <div>\r\n      <GlassCard variant=\"darker\" className=\"sticky top-0 z-50 py-4\">\r\n        <div className=\"container mx-auto px-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Star className=\"w-6 h-6 text-yellow-400\" />\r\n              <h1 className=\"text-xl font-orbitron text-white\"></h1>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center gap-2\">\r\n              <a\r\n                href=\"https://www.buymeacoffee.com/jbrannelid\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-[#FFDD00] hover:bg-[#FFDD00]/90 text-black transition-all\"\r\n              >\r\n                <Coffee className=\"w-5 h-5\" />\r\n              </a>\r\n\r\n              <button\r\n                onClick={() => setShowModal(true)}\r\n                className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 transition-all\"\r\n              >\r\n                <Mail className=\"w-5 h-5\" />\r\n                Contact\r\n              </button>\r\n\r\n              {!isAdmin ? (\r\n                <button\r\n                  onClick={onAdminClick}\r\n                  className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 transition-all\"\r\n                >\r\n                  <Settings className=\"w-5 h-5\" />\r\n                  Admin\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  onClick={onLogout}\r\n                  className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-all\"\r\n                >\r\n                  <LogOut className=\"w-5 h-5\" />\r\n                  Logout\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </GlassCard>\r\n      <ContactModal isOpen={showModal} onClose={() => setShowModal(false)} />\r\n    </div>\r\n  );\r\n};","import React, { ReactNode } from 'react';\r\nimport { Users, Ship, Settings } from 'lucide-react';\r\nimport { GlassCard } from './ui/GlassCard';\r\nimport { Filters } from '@/types';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface SearchPanelProps {\r\n  activeView: 'squads' | 'fleets';\r\n  onViewChange: (view: 'squads' | 'fleets') => void;\r\n  onOptionsClick: () => void;\r\n  filters: Filters;\r\n  children?: ReactNode;\r\n}\r\n\r\nexport const SearchPanel: React.FC<SearchPanelProps> = ({\r\n  activeView,\r\n  onViewChange,\r\n  onOptionsClick,\r\n  filters,\r\n  children\r\n}) => {\r\n  const hasActiveFilters = Boolean(\r\n    filters.alignment || \r\n    filters.showTWOmicronOnly || \r\n    filters.showHardCounters || \r\n    filters.excludeGL\r\n  );\r\n\r\n  return (\r\n    <GlassCard variant=\"darker\" className=\"sticky top-0 z-30 py-4\">\r\n      <div className=\"container mx-auto px-4\">\r\n        <div className=\"flex flex-col md:flex-row gap-4\">\r\n          {/* Search Bar */}\r\n          <div className=\"relative flex-1\">\r\n            {children}\r\n          </div>\r\n\r\n          {/* View Toggles */}\r\n          <div className=\"flex gap-2\">\r\n            <GlassCard\r\n              variant=\"light\"\r\n              glowColor={activeView === 'squads' ? 'blue' : 'none'}\r\n              isInteractive\r\n              isSelected={activeView === 'squads'}\r\n              onClick={() => onViewChange('squads')}\r\n              className=\"flex items-center gap-2 px-6 py-2.5\"\r\n              whileHover={{ scale: 1.02 }}\r\n              whileTap={{ scale: 0.98 }}\r\n            >\r\n              <Users className=\"w-5 h-5\" />\r\n              <span className=\"font-medium\">Squads</span>\r\n            </GlassCard>\r\n\r\n            <GlassCard\r\n              variant=\"light\"\r\n              glowColor={activeView === 'fleets' ? 'blue' : 'none'}\r\n              isInteractive\r\n              isSelected={activeView === 'fleets'}\r\n              onClick={() => onViewChange('fleets')}\r\n              className=\"flex items-center gap-2 px-6 py-2.5\"\r\n              whileHover={{ scale: 1.02 }}\r\n              whileTap={{ scale: 0.98 }}\r\n            >\r\n              <Ship className=\"w-5 h-5\" />\r\n              <span className=\"font-medium\">Fleets</span>\r\n            </GlassCard>\r\n\r\n            <GlassCard\r\n              variant=\"light\"\r\n              glowColor={hasActiveFilters ? 'blue' : 'none'}\r\n              isInteractive\r\n              isSelected={hasActiveFilters}\r\n              onClick={onOptionsClick}\r\n              className=\"flex items-center gap-2 px-6 py-2.5\"\r\n              whileHover={{ scale: 1.02 }}\r\n              whileTap={{ scale: 0.98 }}\r\n            >\r\n              <Settings className={`w-5 h-5 ${hasActiveFilters ? 'text-blue-400' : ''}`} />\r\n              <span className=\"font-medium\">Filters</span>\r\n              {hasActiveFilters && (\r\n                <motion.div\r\n                  className=\"w-2 h-2 rounded-full bg-blue-400\"\r\n                  initial={{ scale: 0 }}\r\n                  animate={{ scale: 1 }}\r\n                  transition={{\r\n                    type: \"spring\",\r\n                    stiffness: 500,\r\n                    damping: 30\r\n                  }}\r\n                />\r\n              )}\r\n            </GlassCard>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </GlassCard>\r\n  );\r\n};","\r\nimport { initializeApp, getApps, FirebaseApp } from 'firebase/app';\r\nimport { \r\n  getAuth, \r\n  Auth, \r\n  connectAuthEmulator, \r\n  onAuthStateChanged \r\n} from 'firebase/auth';\r\nimport { \r\n  Firestore, \r\n  connectFirestoreEmulator,\r\n  enableMultiTabIndexedDbPersistence,\r\n  initializeFirestore,\r\n  CACHE_SIZE_UNLIMITED\r\n} from 'firebase/firestore';\r\nimport { \r\n  getStorage, \r\n  FirebaseStorage, \r\n  connectStorageEmulator \r\n} from 'firebase/storage';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\r\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\r\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\r\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: import.meta.env.VITE_FIREBASE_APP_ID\r\n};\r\n\r\n// Validera miljövariabler\r\nif (!firebaseConfig.apiKey) throw new Error('Firebase API Key is missing');\r\nif (!firebaseConfig.authDomain) throw new Error('Firebase Auth Domain is missing');\r\nif (!firebaseConfig.projectId) throw new Error('Firebase Project ID is missing');\r\nif (!firebaseConfig.storageBucket) throw new Error('Firebase Storage Bucket is missing');\r\nif (!firebaseConfig.messagingSenderId) throw new Error('Firebase Messaging Sender ID is missing');\r\nif (!firebaseConfig.appId) throw new Error('Firebase App ID is missing');\r\n\r\nclass FirebaseClient {\r\n  private static instance: FirebaseClient;\r\n  private app: FirebaseApp;\r\n  private _auth: Auth;\r\n  private _db: Firestore;\r\n  private _storage: FirebaseStorage;\r\n  private initialized: boolean = false;\r\n  private initError: Error | null = null;\r\n  private initializationPromise: Promise<void>;\r\n\r\n  private constructor() {\r\n    // Initialisera alla properties direkt\r\n    this.app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\r\n    this._auth = getAuth(this.app);\r\n    this._db = initializeFirestore(this.app, {\r\n      cacheSizeBytes: CACHE_SIZE_UNLIMITED,\r\n      experimentalForceLongPolling: true,\r\n    });\r\n    this._storage = getStorage(this.app);\r\n    \r\n    // Initiera promise\r\n    this.initializationPromise = this.initialize();\r\n\r\n    // Anslut till emulatorer i utvecklingsmiljö\r\n    if (process.env.NODE_ENV === 'development') {\r\n      this.connectToEmulators();\r\n    }\r\n  }\r\n\r\n  private async initialize(): Promise<void> {\r\n    try {\r\n      await this.setupPersistence();\r\n      this.setupAuthStateMonitoring();\r\n      this.initialized = true;\r\n    } catch (error) {\r\n      this.initError = error as Error;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async setupPersistence(): Promise<void> {\r\n    try {\r\n      await enableMultiTabIndexedDbPersistence(this._db);\r\n      console.log('Offline persistence enabled');\r\n    } catch (error) {\r\n      if (error instanceof Error && 'code' in error) {\r\n        const firebaseError = error as { code: string };\r\n        \r\n        switch (firebaseError.code) {\r\n          case 'failed-precondition':\r\n            console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time.');\r\n            break;\r\n          case 'unimplemented':\r\n            console.warn('The current browser does not support offline persistence.');\r\n            break;\r\n          default:\r\n            console.error('Error enabling offline persistence:', error);\r\n        }\r\n      } else {\r\n        console.error('Unknown error enabling offline persistence:', error);\r\n      }\r\n      // Fortsätt även om persistence misslyckas\r\n    }\r\n  }\r\n\r\n  private setupAuthStateMonitoring(): void {\r\n    onAuthStateChanged(\r\n      this._auth,\r\n      (user) => {\r\n        if (user) {\r\n          console.log('User is signed in:', user.uid);\r\n        } else {\r\n          console.log('User is signed out');\r\n        }\r\n      },\r\n      (error) => {\r\n        console.error('Auth state change error:', error);\r\n      }\r\n    );\r\n  }\r\n\r\n  private connectToEmulators(): void {\r\n    if (import.meta.env.VITE_USE_FIREBASE_EMULATOR === 'true') {\r\n      try {\r\n        connectAuthEmulator(this._auth, 'http://localhost:9099', { disableWarnings: true });\r\n        connectFirestoreEmulator(this._db, 'localhost', 8080);\r\n        connectStorageEmulator(this._storage, 'localhost', 9199);\r\n        console.log('Connected to Firebase emulators');\r\n      } catch (error) {\r\n        console.error('Error connecting to emulators:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static getInstance(): FirebaseClient {\r\n    if (!FirebaseClient.instance) {\r\n      FirebaseClient.instance = new FirebaseClient();\r\n    }\r\n    return FirebaseClient.instance;\r\n  }\r\n\r\n  public get auth(): Auth {\r\n    if (this.initError) throw this.initError;\r\n    return this._auth;\r\n  }\r\n\r\n  public get db(): Firestore {\r\n    if (this.initError) throw this.initError;\r\n    return this._db;\r\n  }\r\n\r\n  public get storage(): FirebaseStorage {\r\n    if (this.initError) throw this.initError;\r\n    return this._storage;\r\n  }\r\n\r\n  public get isInitialized(): boolean {\r\n    return this.initialized && !this.initError;\r\n  }\r\n\r\n  public async waitForInitialization(): Promise<void> {\r\n    return this.initializationPromise;\r\n  }\r\n\r\n  // Metod för att återansluta vid nätverksproblem\r\n  public async reconnect(): Promise<void> {\r\n    if (!this.initialized || this.initError) {\r\n      this.initError = null;\r\n      this.initialized = false;\r\n      this.initializationPromise = this.initialize();\r\n    }\r\n    return this.initializationPromise;\r\n  }\r\n}\r\n\r\n// Skapa och exportera en singleton-instans\r\nconst firebaseClient = FirebaseClient.getInstance();\r\n\r\n// Exportera service-instanser\r\nexport const auth = firebaseClient.auth;\r\nexport const db = firebaseClient.db;\r\nexport const storage = firebaseClient.storage;\r\n\r\n// Exportera hjälpfunktioner\r\nexport const ensureFirebaseInitialized = () => firebaseClient.waitForInitialization();\r\nexport const reconnectFirebase = () => firebaseClient.reconnect();\r\n\r\nexport default firebaseClient;","// Main exports\r\n\r\n// Character ID Mappings\r\nexport const characterMappings = {\r\n  'triple_zero': 'triplezero',\r\n  'fifty_rt': '50rt',\r\n  'arc_trooper': 'trooperclone_arc',\r\n  'aayla_secura': 'aaylasecura',\r\n  'admiral_ackbar': 'ackbaradmiral',\r\n  'admiral_piett': 'piett',\r\n  'admiral_raddus': 'admiralraddus',\r\n  'admiral_trench': 'admiraltrench',\r\n  'ahsoka_fulcrum': 'ahsokaadult',\r\n  'ahsoka_snips': 'ahsoka',\r\n  'amilyn_holdo': 'holdo',\r\n  'asajj_ventress': 'ventress',\r\n  'aurra_sing': 'aurrasing',\r\n  'b1_battle_droid': 'b1',\r\n  'b2_super_battle_droid': 'b2',\r\n  'bb_8': 'bb8',\r\n  'battle_droid_1': 'bt1',\r\n  'barriss_offee': 'barriss_light',\r\n  'bastila_shan': 'bastilashan',\r\n  'bastila_fallen': 'bastilashan_dark',\r\n  'baylan_skoll': 'baylanskoll',\r\n  'baze_malbus': 'bazemalbus',\r\n  'ben_solo': 'bensolo',\r\n  'biggs': 'rebelpilot_biggs',\r\n  'bistan': 'bistan',\r\n  'bo_katan_mandalore': 'mandalorbokatan',\r\n  'bo_katan_kryze': 'bokatan',\r\n  'boba_fett': 'bobafett',\r\n  'boba_fett_scion': 'bobafettold',\r\n  'bodhi_rook': 'bodhi',\r\n  'boss_nass': 'bossnass',\r\n  'bossk': 'bossk',\r\n  'boushh_leia': 'boushh',\r\n  'c3po': 'c3po',\r\n  'cc_2224_cody': 'trooperclone_cody',\r\n  'ct_21_0408_echo': 'trooperclone_echo',\r\n  'ct_5555_fives': 'trooperclone_fives',\r\n  'ct_7567_rex': 'trooperclone_rex',\r\n  'cad_bane': 'cadbane',\r\n  'cal_kestis': 'calkestis',\r\n  'canderous_ordo': 'canderous',\r\n  'captain_drogan': 'captaindrogan',\r\n  'captain_enoch': 'captainenoch',\r\n  'captain_han_solo': 'hoth_han',\r\n  'captain_phasma': 'phasma',\r\n  'captain_rex': 'captainrex',\r\n  'captain_tarpals': 'captaintarpals',\r\n  'cara_dune': 'caradune',\r\n  'carth_onasi': 'carth',\r\n  'cassian_andor': 'cassian',\r\n  'cera_junda': 'cerejunda',\r\n  'chewbacca_ot': 'chewbacca_ot',\r\n  'chief_chirpa': 'ewok_chirpa',\r\n  'chief_nebit': 'jawa_nebit',\r\n  'chirrut_imwe': 'chirrut',\r\n  'chopper': 'chopper',\r\n  'clone_sergeant': 'trooperclonegreen',\r\n  'clone_chewbacca': 'chewbacca',\r\n  'colonel_stark': 'colonel_stark',\r\n  'commander_ahsoka': 'commanderahsokatano',\r\n  'lukebespin': 'lukebespin',\r\n  'coruscant_police': 'coruscantpolice',\r\n  'count_dooku': 'dooku',\r\n  'old_daka': 'daka',\r\n  'dark_trooper': 'darktrooper',\r\n  'dark_trooper_moff': 'moffgideons3',\r\n  'darth_bane': 'darthbane',\r\n  'darth_malak': 'darthmalak',\r\n  'darth_malgus': 'darthmalgus',\r\n  'darth_maul': 'maul',\r\n  'darth_nihilus': 'nihilus',\r\n  'darth_revan': 'sithrevan',\r\n  'darth_sidious': 'sidious',\r\n  'darth_sion': 'sion',\r\n  'darth_talon': 'darthtalon',\r\n  'darth_traya': 'traya',\r\n  'darth_vader': 'vader',\r\n  'dash_rendar': 'dashrendar',\r\n  'dathcha': 'jawa_dathcha',\r\n  'death_trooper_peridea': 'deathtrooperperidea',\r\n  'death_trooper': 'trooperdeath',\r\n  'dengar': 'dengar',\r\n  'director_krennic': 'krennic',\r\n  'doctor_aphra': 'doctoraphra',\r\n  'droideka': 'droideka',\r\n  'echo': 'bb_echo',\r\n  'eeth_koth': 'eethkoth',\r\n  'eighth_brother': 'eighthbrother',\r\n  'embo': 'embo',\r\n  'emperor_palpatine': 'palpatineemperor',\r\n  'enfy_nest': 'enfys',\r\n  'ewok_elder': 'ewok_chief',\r\n  'ewok_scout': 'ewok_scout',\r\n  'ezra_bridger': 'ezra_s3',\r\n  'ezra_exile': 'ezraexile',\r\n  'fennec_shand': 'fennec',\r\n  'fifth_brother': 'fifthbrother',\r\n  'finn': 'finnjakku',\r\n  'fo_executioner': 'firstorder_executioner',\r\n  'fo_officer': 'firstorderofficer',\r\n  'fo_sf_tie_pilot': 'firstorder_pilot',\r\n  'fo_stormtrooper': 'firstordertrooper',\r\n  'fo_tie_pilot': 'firstordertiepilot',\r\n  'gamorrean_guard': 'gamorreanguard',\r\n  'gar_saxon': 'gar_saxon',\r\n  'garazeb_zeb': 'zeb_s3',\r\n  'general_grievous': 'grievous',\r\n  'general_hux': 'generalhux',\r\n  'general_kenobi': 'obiwangeneral',\r\n  'general_skywalker': 'generalanakin',\r\n  'general_veers': 'veers',\r\n  'geonosian_brood_alpha': 'geonosian_broodalpha',\r\n  'geonosian_soldier': 'geonosian_soldier',\r\n  'geonosian_spy': 'geonosian_spy',\r\n  'grand_admiral_thrawn': 'thrawn',\r\n  'grand_inquisitor': 'grandinquisitor',\r\n  'grand_master_yoda': 'yodagrandmaster',\r\n  'grand_moff_tarkin': 'tarkinadmiral',\r\n  'great_mothers': 'greatmothers',\r\n  'greef_karga': 'greefkarga',\r\n  'greedo': 'greedo',\r\n  'gungan_bombardier': 'gunganboomadier',\r\n  'gungan_phalanx': 'gunganphalanx',\r\n  'hk_47': 'hk47',\r\n  'han': 'han',\r\n  'hera_syndulla': 'hera_s3',\r\n  'hermit_yoda': 'yodahermit',\r\n  'hondo_ohnaka': 'hondoohnaka',\r\n  'hoth_rebel_scout': 'rebelhothscout',\r\n  'hoth_rebel_soldier': 'rebelhoth',\r\n  'hunter': 'bb_hunter',\r\n  'ig_100_magnaguard': 'magnaguard',\r\n  'ig_11': 'ig11_nurse',\r\n  'ig_12_grogu': 'ig12',\r\n  'ig_86': 'ig86',\r\n  'ig_88': 'ig88',\r\n  'iden_versio': 'idenversioempire',\r\n  'ima_gun_di': 'imagundi',\r\n  'imperial_probe_droid': 'probedroid',\r\n  'imperial_super_commando': 'imperial_super_commando',\r\n  'jabba_the_hutt': 'jabbathehutt',\r\n  'jango_fett': 'jangofett',\r\n  'jar_jar_binks': 'jarjarbinks',\r\n  'jawa': 'jawa_jawa',\r\n  'jawa_engineer': 'jawa_engineer',\r\n  'jawa_scavenger': 'jawa_scavenger',\r\n  'jedi_consular': 'jedi_consular_03',\r\n  'jedi_knight_anakin': 'anakinjedi',\r\n  'jedi_knight_guardian': 'jedi_guardian_01',\r\n  'jedi_knight_cal_kestis': 'jediknightcal',\r\n  'jedi_knight_luke': 'luke_jediknight',\r\n  'jedi_knight_revan': 'jedirevan',\r\n  'jedi_master_kenobi': 'globiwan',\r\n  'jedi_master_luke': 'luke_jml',\r\n  'jolee_bindo': 'joleebindo',\r\n  'juhani': 'juhani',\r\n  'jyn_erso': 'jyn',\r\n  'k_2so': 'k2so',\r\n  'kanan_jarrus': 'kanan_s3',\r\n  'kelleran_beq': 'kelleranbeq',\r\n  'ki_adi_mundi': 'kiadimundi',\r\n  'kit_fisto': 'kitfisto',\r\n  'krrsantan': 'krrsantan',\r\n  'kuiil': 'kuiil',\r\n  'kyle_katarn': 'kylekatarn',\r\n  'kylo_ren': 'kyloren',\r\n  'kylo_ren_unmasked': 'kylo_unmasked',\r\n  'l3_37': 'l337',\r\n  'lando_calrissian': 'landobespin',\r\n  'leia_organa': 'leiaendor',\r\n  'lobot': 'lobot',\r\n  'logray': 'ewok_logray',\r\n  'lord_vader': 'lordvader',\r\n  'luke_farmboy': 'luke_ep4',\r\n  'luminara_unduli': 'luminara',\r\n  'luthen_rael': 'luthenrael',\r\n  'mace_windu': 'macewindu',\r\n  'magmatrooper': 'trooperstorm_magma',\r\n  'mara_jade': 'marajade',\r\n  'marrok': 'marrok',\r\n  'master_qui_gon': 'masterquigon',\r\n  'maul': 'maul_cyborg',\r\n  'merrin': 'merrin',\r\n  'mission_vao': 'mission',\r\n  'mob_enforcer': 'mob_enforcer',\r\n  'moff_gideon': 'moffgideon',\r\n  'mon_mothma': 'monmothma',\r\n  'morgan_elsbeth': 'morganelsbeth',\r\n  'mother_talzin': 'nightsisters_talzin',\r\n  'night_trooper': 'nighttrooper_a',\r\n  'nightsister_acolyte': 'nightsister_acolyte',\r\n  'nightsister_initiate': 'nightsister_initiate',\r\n  'nightsister_spirit': 'nightsisters_wraith',\r\n  'nightsister_zombie': 'nightsisters_zombie',\r\n  'ninth_sister': 'ninthsister',\r\n  'nute_gunray': 'nutegunray',\r\n  'obi_wan_old_ben': 'obiwanep4',\r\n  'omega': 'badbatchomega',\r\n  'padawan_obiwan': 'padawanobiwan',\r\n  'padawan_sabine': 'padawansabine',\r\n  'padme_amidala': 'padme_geonosis',\r\n  'pao': 'pao',\r\n  'paploo': 'ewok_paploo',\r\n  'paz_vizsla': 'pazvizsla',\r\n  'plo_koon': 'plokoon',\r\n  'poe_dameron': 'poe',\r\n  'poggle_the_lesser': 'geonosian_poggle',\r\n  'princess_kneesaa': 'princesskneesaa',\r\n  'princess_leia': 'leia_princess',\r\n  'qira': 'qira',\r\n  'queen_amidala': 'queenamidala',\r\n  'qui_gon_jinn': 'quigon',\r\n  'r2_d2': 'r2d2',\r\n  'range_trooper': 'trooperranger',\r\n  'rebel_officer_leia': 'leiahoth',\r\n  'resistance_hero_finn': 'finn',\r\n  'resistance_hero_poe': 'poe_tros',\r\n  'resistance_pilot': 'resistancepilot',\r\n  'resistance_trooper': 'resistancetrooper',\r\n  'rey_gl': 'reyjakku',\r\n  'rey_jedi_training': 'rey_tlj',\r\n  'rey_scavenger': 'rey_tros',\r\n  'rose_tico': 'rose',\r\n  'royal_guard': 'royalguard',\r\n  'sabine_wren': 'sabine_s3',\r\n  'sana_starros': 'sanastarros',\r\n  'savage_opress': 'savageopress',\r\n  'saw_gerrera': 'sawgerrera',\r\n  'scarif_rebel_pathfinder': 'rebel_scarif',\r\n  'scout_trooper': 'trooperscout',\r\n  'second_sister': 'secondsister',\r\n  'seventh_sister': 'seventhsister',\r\n  'shaak_ti': 'shaakti',\r\n  'shin_hati': 'shinhati',\r\n  'shoretrooper': 'troopershore',\r\n  'sith_assassin': 'sithassassin',\r\n  'sith_empire_trooper': 'sithtrooper',\r\n  'sith_eternal_emperor': 'espalpatine_pre',\r\n  'sith_marauder': 'sithmarauder',\r\n  'sith_trooper': 'firstorder_sithtrooper',\r\n  'skiff_guard_lando': 'undercoverlando',\r\n  'snowtrooper': 'troopersnow',\r\n  'stap' : 'stap',\r\n  'starkiller': 'starkiller',\r\n  'stormtrooper': 'trooperstorm',\r\n  'stormtrooper_han': 'trooperstorm_han',\r\n  'sun_fac': 'geonosian_sunfac',\r\n  'supreme_leader_kylo': 'kyloren_tros',\r\n  't3_m4': 't3m4',\r\n  'talia': 'talia',\r\n  'tarfful': 'tarfful',\r\n  'taron_malicos': 'taronmalicos',\r\n  'tech': 'bb_tech',\r\n  'teebo': 'ewok_teebo',\r\n  'the_armorer': 'armorer',\r\n  'the_mandalorian': 'mandalorian',\r\n  'the_mandalorian_beskar': 'mandobeskar',\r\n  'third_sister': 'thirdsister',\r\n  'chewbacca_c3po': 'chewbacca_c3po',\r\n  'tusken_chieftain': 'tuskenchieftain',\r\n  'tusken_raider': 'tuskenraider',\r\n  'tusken_shaman': 'tuskenshaman',\r\n  'tusken_warrior': 'tuskenhuntress',\r\n  'urorrurrr': 'urorrurrr',\r\n  'ugnaught': 'ugnaught',\r\n  'vandor_chewbacca': 'chewbacca_vandor',\r\n  'veteran_smuggler_han': 'tfa_han',\r\n  'visas_marr': 'visas',\r\n  'wampa': 'wampa',\r\n  'wat_tambor': 'wattambor',\r\n  'wedge_antilles': 'rebelpilot_wedge',\r\n  'wicket': 'ewok_wicket',\r\n  'wrecker': 'bb_wrecker',\r\n  'young_han_solo': 'han_young',\r\n  'young_lando': 'younglando',\r\n  'zaalbar': 'zaalbar',\r\n  'zam_wesell': 'zamwesell',\r\n  'zorii_bliss': 'zoriibliss'\r\n} as const;\r\n\r\nexport const shipMappings = {\r\n  // Capital Ships\r\n  'chimaera': 'chimaera', \r\n  'endurance': 'venator', \r\n  'executor': 'executor',\r\n  'executrix': 'stardestroyer',\r\n  'finalizer': 'finalizer',\r\n  'home_one': 'moncalamarilibertycruiser',\r\n  'profundity': 'profundity',\r\n  'leviathan': 'leviathan',\r\n  'negotiator': 'negotiator',\r\n  'malevolence': 'malevolence',\r\n  'furyclassinterceptor': 'furyclassinterceptor',\r\n\r\n  // Regular Ships\r\n  'ahsoka_tanos_jedi_starfighter': 'jedi_fighter_ahsoka',\r\n  'anakins_eta2': 'jedi_fighter_anakin',\r\n  'b28': 'b28extinctionclassbomber',\r\n  'btl_b_y_wing': 'ywing_btlb',\r\n  'biggs_darklighter_x_wing': 'xwing_red3',    \r\n  'bistan_u_wing': 'uwing',\r\n  'cassians_u_wing': 'uwing_hero',\r\n  'clone_sergeants_arc_170': 'arc170',\r\n  'comeuppance': 'comeuppance', \r\n  'ebon_hawk': 'ebonhawk',\r\n  'emperors_shuttle': 'imperialshuttle',\r\n  'first_order_sf_tie_fighter': 'fosf_tie_fighter',\r\n  'first_order_tie_fighter': 'firstorder_tiefighter',\r\n  'fury_class_interceptor': 'furyclassinterceptor',\r\n  'fives_umbaran_starfighter': 'umbaran_star_fighter',\r\n  'gauntlet_starfighter': 'gauntlet',\r\n  'geonosian_soldier_starfighter': 'geonosis_fighter_soldier',\r\n  'geonosian_spy_starfighter': 'geonosis_fighter_spy',\r\n  'ghost': 'ghost',\r\n  'hans_millennium_falcon': 'mfalcon',\r\n  'hounds_tooth': 'houndstooth',\r\n  'hyena_bomber': 'hyenabomber',\r\n  'ig2000': 'ig2000',\r\n  'imperial_tie_bomber': 'tiebomber',\r\n  'imperial_tie_fighter': 'tiefighter',\r\n  'jedi_consulars_starfighter': 'jedi_fighter',\r\n  'kylo_ren_command_shuttle': 'upsilon_shuttle_kylo',    \r\n  'lando_millennium_falcon': 'mil_fal_pristine',    \r\n  'mg_100_starfortress': 'mg100',    \r\n  'marauder': 'marauder',    \r\n  'mark_v1_interceptor': 'sithsupremacyclass',    \r\n  'outrider': 'outrider', \r\n  'phantom' : 'phantom2',    \r\n  'plo_koons_jedi_starfighter': 'jedi_fighter_bladeofdorin',\r\n  'razor_crest': 'razorcrest',\r\n  'rexs_arc_170': 'arc170_02',\r\n  'scimitar': 'sithinfiltrator',\r\n  'sithsupremacyclass': 'sithsupremacyclass',\r\n  'slave_1': 'slave1',\r\n  'sun_facs_geonosian_starfighter': 'geonosis_fighter_sunfac',\r\n  'tie_advanced_x1': 'tieadvanced',\r\n  'tie_interceptor': 'tie_interceptor_prototype',\r\n  'umbaran_starfighter': 'umbaran_star_fighter',\r\n  'vulture_droid': 'vulturedroid',\r\n  'xanadu_blood': 'xanadublood',\r\n  'rebel_y_wing': 'ywing'\r\n} as const;\r\n\r\n// Debug mode för loggning\r\nconst DEBUG = true;\r\n\r\nconst logDebug = (message: string, ...args: any[]) => {\r\n  if (DEBUG) {\r\n    console.debug(`[ImageMapping] ${message}`, ...args);\r\n  }\r\n};\r\n\r\n// Funktion för att normalisera ID\r\nexport const normalizeId = (name: string): string => {\r\n  if (!name) return '';\r\n  \r\n  return name\r\n    .toLowerCase()\r\n    .replace(/[']/g, '') // Ta bort apostrofer\r\n    .replace(/[^a-z0-9_\\s-]/g, '') // Behåll bara bokstäver, siffror, _, mellanslag och -\r\n    .trim()\r\n    .replace(/[\\s-]+/g, '_'); // Ersätt mellanslag och - med _\r\n};\r\n\r\n// Funktion för att hämta filnamn\r\nexport function getImageFileName(id: string, type: string): string {\r\n  if (!id) {\r\n    logDebug('No ID provided for image');\r\n    return '';\r\n  }\r\n  \r\n  const normalizedId = normalizeId(id);\r\n  logDebug(`Normalized ID: ${normalizedId} from ${id}`);\r\n  \r\n  // Välj rätt mappning\r\n  const mappings = type.includes('ship') ? shipMappings : characterMappings;\r\n  \r\n  // Hämta filnamn från mappning\r\n  const fileName = mappings[normalizedId as keyof typeof mappings];\r\n  \r\n  if (!fileName) {\r\n    logDebug(`No mapping found for ID: ${id}, normalized: ${normalizedId}, type: ${type}`);\r\n    logDebug('Available mappings:', Object.keys(mappings));\r\n    return normalizedId; // Fallback till normaliserat ID\r\n  }\r\n  \r\n  return fileName;\r\n}","import { storage } from '../lib/firebase';\r\nimport { ref, getDownloadURL } from 'firebase/storage';\r\nimport { getImageFileName } from './imageMapping';\r\n\r\nexport type ImageType = 'character' | 'squad-leader' | 'squad-member' | 'ship' | 'capital-ship';\r\nexport type ImageSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';\r\n\r\ninterface ImageDimensions {\r\n  width: number;\r\n  height: number;\r\n  containerClass: string;\r\n}\r\n\r\n// Constants\r\nconst ASSETS_BASE_PATH = '/assets';\r\nconst DEFAULT_PLACEHOLDER = '/placeholder.png';\r\nconst IMAGE_CACHE = new Map<string, string>();\r\nconst LOADING_CACHE = new Map<string, Promise<string>>();\r\n\r\nconst IMAGE_SIZES: Record<ImageSize, ImageDimensions> = {\r\n  xs: { width: 32, height: 32, containerClass: 'w-8 h-8' },\r\n  sm: { width: 40, height: 40, containerClass: 'w-10 h-10' },\r\n  md: { width: 48, height: 48, containerClass: 'w-12 h-12' },\r\n  lg: { width: 64, height: 64, containerClass: 'w-16 h-16' },\r\n  xl: { width: 80, height: 80, containerClass: 'w-20 h-20' }\r\n};\r\n\r\nconst DEBUG = process.env.NODE_ENV === 'development';\r\n\r\nconst logDebug = (message: string, ...args: any[]) => {\r\n  if (DEBUG) {\r\n    console.debug(`[ImageUtils] ${message}`, ...args);\r\n  }\r\n};\r\n\r\nexport const getImageDimensions = (size: ImageSize): ImageDimensions => {\r\n  return IMAGE_SIZES[size];\r\n};\r\n\r\nexport const getPlaceholderDataUrl = (size: ImageSize): string => {\r\n  const { width, height } = IMAGE_SIZES[size];\r\n  return `data:image/svg+xml;charset=utf-8,<svg xmlns='http://www.w3.org/2000/svg' width='${width}' height='${height}' viewBox='0 0 ${width} ${height}'><rect width='100%' height='100%' fill='%231a1e27'/></svg>`;\r\n};\r\n\r\nexport const getImageStateClass = (\r\n  isLoading: boolean,\r\n  hasError: boolean,\r\n  size: ImageSize,\r\n  baseClasses: string = \"\"\r\n): string => {\r\n  const { containerClass } = IMAGE_SIZES[size];\r\n  return `${containerClass} ${baseClasses} ${isLoading ? 'opacity-0' : 'opacity-100'} ${\r\n    hasError ? 'grayscale opacity-50' : ''\r\n  } object-cover rounded-full transition-all duration-300`;\r\n};\r\n\r\nexport const getUnitImage = async (id: string | undefined, type: ImageType): Promise<string> => {\r\n  if (!id) {\r\n    logDebug('No ID provided for image');\r\n    return DEFAULT_PLACEHOLDER;\r\n  }\r\n\r\n  const cacheKey = `${id}-${type}`;\r\n  \r\n  // Check memory cache first\r\n  if (IMAGE_CACHE.has(cacheKey)) {\r\n    return IMAGE_CACHE.get(cacheKey)!;\r\n  }\r\n\r\n  // Check if this image is already being loaded\r\n  if (LOADING_CACHE.has(cacheKey)) {\r\n    return LOADING_CACHE.get(cacheKey)!;\r\n  }\r\n\r\n  // Create new loading promise\r\n  const loadingPromise = (async () => {\r\n    try {\r\n      const fileName = getImageFileName(id, type);\r\n      if (!fileName) {\r\n        logDebug(`No mapping found for ${id} (${type})`);\r\n        return DEFAULT_PLACEHOLDER;\r\n      }\r\n\r\n      const folder = type.includes('ship') ? 'ships' : 'characters';\r\n      const imagePath = `${folder}/${fileName}.webp`;\r\n      \r\n      try {\r\n        const imageRef = ref(storage, imagePath);\r\n        const url = await getDownloadURL(imageRef);\r\n        IMAGE_CACHE.set(cacheKey, url);\r\n        logDebug(`Successfully loaded Firebase image for ${id}`);\r\n        return url;\r\n      } catch (firebaseError) {\r\n        const localPath = `${ASSETS_BASE_PATH}/${imagePath}`;\r\n        IMAGE_CACHE.set(cacheKey, localPath);\r\n        logDebug(`Using local path: ${localPath}`);\r\n        return localPath;\r\n      }\r\n    } catch (error) {\r\n      console.error(`Failed to load image for ${id}:`, error);\r\n      return DEFAULT_PLACEHOLDER;\r\n    } finally {\r\n      LOADING_CACHE.delete(cacheKey);\r\n    }\r\n  })();\r\n\r\n  LOADING_CACHE.set(cacheKey, loadingPromise);\r\n  return loadingPromise;\r\n};\r\n\r\nexport const clearImageCache = () => {\r\n  IMAGE_CACHE.clear();\r\n};\r\n\r\nexport const handleImageError = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {\r\n  const img = e.target as HTMLImageElement;\r\n  console.error(`Image failed to load: ${img.src}`);\r\n  img.src = DEFAULT_PLACEHOLDER;\r\n  img.classList.add('error-image');\r\n};","import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}","import { useState, useEffect, memo, useMemo } from 'react';\r\nimport { getUnitImage, getPlaceholderDataUrl } from '@/lib/imageUtils';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport type ImageType = 'character' | 'squad-leader' | 'squad-member' | 'ship' | 'capital-ship';\r\n\r\n// Behåll image cache\r\nconst imageCache: Record<string, string> = {};\r\n\r\ninterface UnitImageProps {\r\n  id: string;\r\n  name: string;\r\n  type: ImageType;\r\n  size: 'sm' | 'md' | 'lg';\r\n  className?: string;\r\n  withTooltip?: boolean;\r\n  isLeader?: boolean;\r\n  isCapital?: boolean;\r\n  onLoad?: () => void;\r\n}\r\n\r\nconst SIZE_CLASSES = {\r\n  sm: 'w-8 h-8',   // 32x32px\r\n  md: 'w-12 h-12', // 48x48px\r\n  lg: 'w-16 h-16'  // 64x64px\r\n};\r\n\r\nexport const UnitImage = memo<UnitImageProps>(({\r\n  id,\r\n  name,\r\n  type,\r\n  size = 'md',\r\n  className = '',\r\n  withTooltip = true,\r\n  isLeader = false,\r\n  isCapital = false,\r\n  onLoad\r\n}) => {\r\n  const [imageUrl, setImageUrl] = useState<string>(() => \r\n    imageCache[id] || getPlaceholderDataUrl(size)\r\n  );\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [hasError, setHasError] = useState(false);\r\n\r\n  // Memoize SIZE_CLASSES to avoid recalculating on every render\r\n  const sizeClasses = useMemo(() => SIZE_CLASSES[size], [size]);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    \r\n    const loadImage = async () => {\r\n      // Return cached image if available\r\n      if (imageCache[id]) {\r\n        setImageUrl(imageCache[id]);\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const url = await getUnitImage(id, type);\r\n        if (isMounted) {\r\n          imageCache[id] = url; // Cache the image URL\r\n          setImageUrl(url);\r\n          setHasError(false);\r\n        }\r\n      } catch (error) {\r\n        if (isMounted) {\r\n          console.error(`Error loading image for ${id}:`, error);\r\n          setHasError(true);\r\n        }\r\n      } finally {\r\n        if (isMounted) {\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    loadImage();\r\n    return () => { isMounted = false; };\r\n  }, [id, type]);\r\n\r\n  // Skapa sizes string baserat på komponentens storlek\r\n\r\n  return (\r\n    <div className={cn(\r\n      'relative',\r\n      'transition-all duration-300 ease-out',\r\n      sizeClasses,\r\n      className\r\n    )}>\r\n      <img\r\n        src={imageUrl}\r\n        alt={name}\r\n        className={cn(\r\n          'w-full h-full',\r\n          'object-cover rounded-full',\r\n          'transition-opacity duration-300',\r\n          isLoading ? 'opacity-0 blur-md' : 'opacity-100',\r\n          hasError ? 'grayscale opacity-50' : ''\r\n        )}\r\n        loading=\"lazy\"\r\n        onLoad={onLoad}\r\n        onError={() => {\r\n          setHasError(true);\r\n          setImageUrl(getPlaceholderDataUrl(size));\r\n        }}\r\n      />\r\n      {(isLeader || isCapital) && (\r\n        <div \r\n          className=\"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full \r\n                   flex items-center justify-center text-white text-xs font-bold\r\n                   shadow-md\"\r\n        >\r\n          {isLeader ? 'L' : 'C'}\r\n        </div>\r\n      )}\r\n      {withTooltip && (\r\n        <div className=\"absolute -bottom-6 left-1/2 transform -translate-x-1/2 \r\n                     bg-black/90 px-2 py-1 rounded text-xs text-white whitespace-nowrap \r\n                     opacity-0 group-hover:opacity-100 transition-opacity z-10\">\r\n          {name}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n\r\nUnitImage.displayName = 'UnitImage';","import React from 'react';\r\nimport { Video } from 'lucide-react';  // Ändra från Youtube till Video\r\n\r\ninterface VideoIndicatorProps {\r\n  videoUrl: string;\r\n}\r\n\r\nexport const VideoIndicator: React.FC<VideoIndicatorProps> = ({ videoUrl }) => {\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    window.open(videoUrl, '_blank');\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={handleClick}\r\n      className=\"flex items-center gap-2 px-2 py-1 rounded-full bg-red-500/20 text-red-400 \r\n                 hover:bg-red-500/30 transition-colors text-sm\"\r\n    >\r\n      <Video className=\"w-4 h-4\" />  {/* Använder Video istället för Youtube */}\r\n      <span>Watch Guide</span>\r\n    </button>\r\n  );\r\n};","import { memo, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Users, Trash2 } from 'lucide-react';\r\nimport { Squad, Counter } from '@/types';\r\nimport { GlassCard } from './ui/GlassCard';\r\nimport { UnitImage } from './ui/UnitImage';\r\nimport { VideoIndicator } from './ui/VideoIndicator';\r\nimport { ErrorBoundary } from 'react-error-boundary';\r\n\r\ninterface SquadCardProps {\r\n  squad: Squad;\r\n  isSelected: boolean;\r\n  onSelect: () => void;\r\n  counters: Counter[];\r\n  isAdmin?: boolean;\r\n  onDeleteCounter?: (id: string) => void;\r\n  onViewDetails?: () => void;\r\n  isFiltered?: boolean;\r\n}\r\n\r\nexport const SquadCard = memo<SquadCardProps>(({\r\n  squad,\r\n  isSelected,\r\n  onSelect,\r\n  counters,\r\n  isAdmin,\r\n  onDeleteCounter,\r\n  isFiltered = false\r\n}) => {\r\n  const [] = useState(false);\r\n  // Log data to console\r\n  console.log('Full squad data:', squad);\r\n\r\n  // Validate required props\r\n  if (!squad || !squad.characters || !Array.isArray(squad.characters)) {\r\n    console.error('Invalid squad data:', squad);\r\n    return null;\r\n  }\r\n\r\n  // Safely handle counters\r\n  const safeCounters = Array.isArray(counters) ? counters : [];\r\n\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={\r\n        <GlassCard variant=\"dark\" className=\"p-4\">\r\n          <div className=\"text-red-400\">Error loading squad card</div>\r\n        </GlassCard>\r\n      }\r\n    >\r\n      <div onClick={() => onSelect()}>\r\n        <GlassCard\r\n          variant=\"dark\"\r\n          glowColor={squad.alignment === 'light' ? 'blue' : 'red'}\r\n          isSelected={isSelected}\r\n          className={`transition-all duration-300 ease-out hover:scale-[1.01] ${\r\n            isFiltered ? 'opacity-100' : 'opacity-50'\r\n          }`}\r\n        >\r\n          <div className=\"p-4\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"text-xl font-orbitron text-white flex items-center gap-2\">\r\n                  <Users className=\"w-5 h-5 text-blue-400\" />\r\n                  {squad.name}\r\n                </h3>\r\n                {/* Badges */}\r\n                <div className=\"flex items-center gap-2 mt-2\">\r\n                  <span className={`px-2 py-1 rounded-full text-xs\r\n                    ${squad.alignment === 'light'\r\n                      ? 'bg-blue-500/20 text-blue-400'\r\n                      : 'bg-red-500/20 text-red-400'\r\n                    }`}\r\n                  >\r\n                    {squad.alignment === 'light' ? 'Light Side' : 'Dark Side'}\r\n                  </span>\r\n                  {squad.twOmicronRequired && (\r\n                    <span className=\"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400\">\r\n                      TW Omicron\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </div>   \r\n              {/* Visa metadata i Icon Tooltip */}\r\n              {/* \r\n              <div className=\"flex items-center gap-2\">\r\n                {onViewDetails && (\r\n                  <>\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setShowMetadata(true);\r\n                      }}\r\n                      className=\"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg\"\r\n                    >\r\n                      <Info className=\"w-4 h-4\" />\r\n                    </button>\r\n                    <MetadataView \r\n                      isOpen={showMetadata}\r\n                      onClose={() => setShowMetadata(false)}\r\n                      data={squad}\r\n                    />\r\n                  </>\r\n                )}\r\n                <button\r\n                  className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n                >\r\n                  {isSelected ? (\r\n                    <ChevronUp className=\"w-4 h-4\" />\r\n                  ) : (\r\n                    <ChevronDown className=\"w-4 h-4\" />\r\n                  )}\r\n                </button>\r\n              </div> */}\r\n            </div>\r\n\r\n            {/* Squad Members */}\r\n            <div className=\"flex flex-wrap items-center gap-2 mt-4\">\r\n              {/* Leader */}\r\n              {squad.leader && (\r\n                <div className=\"relative group\">\r\n                  <UnitImage\r\n                    id={squad.leader.id}\r\n                    name={squad.leader.name}\r\n                    type=\"squad-leader\"\r\n                    size=\"md\"\r\n                    className=\"rounded-full border-2 border-blue-400\"\r\n                    withTooltip={true}\r\n                    isLeader={true}\r\n                  />\r\n                </div>\r\n              )}\r\n              \r\n              {/* Squad Members */}\r\n              {squad.characters.map((char) => (\r\n                <div key={char.id} className=\"relative group\">\r\n                  <UnitImage\r\n                    id={char.id}\r\n                    name={char.name}\r\n                    type=\"squad-member\"\r\n                    size=\"md\"\r\n                    className=\"rounded-full border-2 border-white/20\"\r\n                    withTooltip={true}\r\n                  />\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Counters Section */}\r\n            <AnimatePresence>\r\n              {isSelected && safeCounters.length > 0 && (\r\n                <motion.div\r\n                  initial={{ height: 0, opacity: 0 }}\r\n                  animate={{ height: 'auto', opacity: 1 }}\r\n                  exit={{ height: 0, opacity: 0 }}\r\n                  transition={{ duration: 0.3 }}\r\n                  className=\"mt-6 space-y-4 overflow-hidden\"\r\n                >\r\n                  <h4 className=\"text-lg font-medium text-white\">Counters</h4>\r\n                  {safeCounters.map((counter) => {\r\n                    // Validate counter data\r\n                    if (!counter || !counter.counterSquad) return null;\r\n\r\n                    return (\r\n                      <div\r\n                        key={counter.id}\r\n                        className=\"p-4 bg-white/5 rounded-lg space-y-4\"\r\n                      >\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className={`px-2 py-1 rounded-full text-xs\r\n                              ${counter.counterType === 'hard'\r\n                                ? 'bg-green-500/20 text-green-400'\r\n                                : counter.counterType === 'soft'\r\n                                ? 'bg-yellow-500/20 text-yellow-400'\r\n                                : 'bg-red-500/20 text-red-400'\r\n                              }`}\r\n                            >\r\n                              {counter.counterType.charAt(0).toUpperCase() + counter.counterType.slice(1)}\r\n                            </span>\r\n                            \r\n                            {counter.twOmicronRequired && (\r\n                              <span className=\"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400\">\r\n                                TW Omni\r\n                              </span>\r\n                            )}\r\n                            \r\n                            {counter.video_url && <VideoIndicator videoUrl={counter.video_url} />}\r\n                          </div>\r\n                          {isAdmin && onDeleteCounter && (\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                onDeleteCounter(counter.id);\r\n                              }}\r\n                              className=\"p-2 text-red-400 hover:bg-red-400/10 rounded-lg\"\r\n                            >\r\n                              <Trash2 className=\"w-4 h-4\" />\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n\r\n                        <p className=\"mt-2 text-white/70\">{counter.description}</p>\r\n\r\n                        {/* Counter Squad Preview */}\r\n                        {'characters' in counter.counterSquad && (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {counter.counterSquad.leader && (\r\n                              <UnitImage\r\n                                id={counter.counterSquad.leader.id}\r\n                                name={counter.counterSquad.leader.name}\r\n                                type=\"squad-leader\"\r\n                                size=\"sm\"\r\n                                className=\"border-2 border-blue-400\"\r\n                              />\r\n                            )}\r\n                            {counter.counterSquad.characters.map((char) => (\r\n                              <UnitImage\r\n                                key={char.id}\r\n                                id={char.id}\r\n                                name={char.name}\r\n                                type=\"squad-member\"\r\n                                size=\"sm\"\r\n                                className=\"border-2 border-white/20\"\r\n                              />\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </div>\r\n        </GlassCard>\r\n      </div>\r\n    </ErrorBoundary>\r\n  );\r\n});\r\n\r\nSquadCard.displayName = 'SquadCard';","import React from 'react';\r\nimport { AlertTriangle, RefreshCw } from 'lucide-react';\r\n\r\ninterface ErrorBoundaryProps {\r\n  children: React.ReactNode;\r\n  fallback?: React.ReactNode;\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n}\r\n\r\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n  constructor(props: ErrorBoundaryProps) {\r\n    super(props);\r\n    this.state = { \r\n      hasError: false,\r\n      error: null\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\r\n    return { \r\n      hasError: true,\r\n      error \r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({ \r\n      hasError: false,\r\n      error: null \r\n    });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"min-h-[200px] flex items-center justify-center\">\r\n          <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <AlertTriangle className=\"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5\" />\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"text-lg font-medium text-red-400 mb-2\">\r\n                  Something went wrong\r\n                </h3>\r\n                <p className=\"text-sm text-red-400/80 mb-4\">\r\n                  {this.state.error?.message || 'An unexpected error occurred'}\r\n                </p>\r\n                <button\r\n                  onClick={this.handleReset}\r\n                  className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                           bg-red-500/20 text-red-400 hover:bg-red-500/30 \r\n                           transition-colors\"\r\n                >\r\n                  <RefreshCw className=\"w-4 h-4\" />\r\n                  Try Again\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;","import React, { useMemo } from 'react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { Users, RefreshCw } from 'lucide-react';\r\nimport { Squad, Counter } from '@/types';\r\nimport { SquadCard } from './SquadCard';\r\nimport ErrorBoundary from './ErrorBoundary';\r\n\r\ninterface SquadListProps {\r\n  squads: Squad[];\r\n  filteredSquads: Squad[];\r\n  selectedSquadId: string | null;\r\n  onSelectSquad: (id: string | null) => void;\r\n  getCounters: (id: string) => Counter[];\r\n  isAdmin?: boolean;\r\n  onDeleteCounter?: (id: string) => void;\r\n  onViewDetails?: () => void;\r\n}\r\n\r\nexport const SquadList: React.FC<SquadListProps> = ({\r\n  squads,\r\n  filteredSquads,\r\n  selectedSquadId,\r\n  onSelectSquad,\r\n  getCounters,\r\n  isAdmin,\r\n  onDeleteCounter,\r\n  onViewDetails\r\n}) => {\r\n  const handleSquadSelect = (squadId: string) => {\r\n    if (selectedSquadId === squadId) {\r\n      onSelectSquad(null);\r\n    } else {\r\n      onSelectSquad(squadId);\r\n    }\r\n  };\r\n\r\n  const renderedSquads = useMemo(() => \r\n    filteredSquads.map((squad) => (\r\n      <motion.div\r\n        key={squad.id}\r\n        layout\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        exit={{ opacity: 0, y: -20 }}\r\n        transition={{ duration: 0.3 }}\r\n      >\r\n        <SquadCard\r\n          squad={squad}\r\n          isSelected={selectedSquadId === squad.id}\r\n          onSelect={() => handleSquadSelect(squad.id)}\r\n          counters={getCounters(squad.id)}\r\n          isFiltered={true}\r\n          isAdmin={isAdmin}\r\n          onDeleteCounter={onDeleteCounter}\r\n          onViewDetails={onViewDetails}\r\n        />\r\n      </motion.div>\r\n    )),\r\n    [filteredSquads, selectedSquadId, getCounters, isAdmin, onDeleteCounter, onViewDetails]\r\n  );\r\n\r\n  if (!squads || squads.length === 0) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12 text-white/60\">\r\n        <Users className=\"w-12 h-12 mb-4 animate-float\" />\r\n        <p className=\"text-lg\">No squads found</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={\r\n        <div className=\"flex flex-col items-center justify-center p-8\">\r\n          <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full\">\r\n            <h3 className=\"text-lg font-medium text-red-400 mb-2\">\r\n              Failed to load squads\r\n            </h3>\r\n            <p className=\"text-sm text-red-400/80 mb-4\">\r\n              Please try refreshing the page\r\n            </p>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                       bg-red-500/20 text-red-400 hover:bg-red-500/30\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4\" />\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n      }\r\n    >\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n        <AnimatePresence mode=\"popLayout\">\r\n          {renderedSquads}\r\n        </AnimatePresence>\r\n      </div>\r\n    </ErrorBoundary>\r\n  );\r\n};","import { memo, useState, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Ship, Trash2, Plus } from 'lucide-react';\r\nimport { Fleet, Counter } from '@/types';\r\nimport { GlassCard } from './ui/GlassCard';\r\nimport { UnitImage } from './ui/UnitImage';\r\nimport { VideoIndicator } from './ui/VideoIndicator';\r\nimport { ErrorBoundary } from 'react-error-boundary';\r\n\r\ninterface FleetCardProps {\r\n  fleet: Fleet;\r\n  isSelected: boolean;\r\n  onSelect: () => void;\r\n  counters: Counter[];\r\n  isAdmin?: boolean;\r\n  onDeleteCounter?: (id: string) => void;\r\n  onViewDetails?: () => void;\r\n  isFiltered?: boolean;\r\n  onAddCounter?: (fleet: Fleet) => void;\r\n}\r\n\r\nexport const FleetCard = memo<FleetCardProps>(({\r\n  fleet,\r\n  isSelected,\r\n  onSelect,\r\n  counters,\r\n  isAdmin,\r\n  onDeleteCounter,\r\n  isFiltered = false,\r\n  onAddCounter\r\n}) => {\r\n  const [] = useState(false);\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n// Log data to console\r\nconsole.log('Full fleet data:', fleet);\r\n\r\n  // Filtrera counters för denna fleet\r\n  const fleetCounters = counters.filter(counter => {\r\n    const isTargetFleet = counter.targetSquad.id === fleet.id;\r\n    const isCounterFleet = counter.counterSquad.id === fleet.id;\r\n    const isTargetCapitalShip = 'capitalShip' in counter.targetSquad && \r\n      counter.targetSquad.capitalShip?.id === fleet.id;\r\n    \r\n    return isTargetFleet || isCounterFleet || isTargetCapitalShip;\r\n  });\r\n\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={\r\n        <GlassCard variant=\"dark\" className=\"p-4\">\r\n          <div className=\"text-red-400\">Error loading fleet card</div>\r\n        </GlassCard>\r\n      }\r\n    >\r\n      <GlassCard\r\n        variant=\"dark\"\r\n        glowColor={fleet.alignment === 'light' ? 'blue' : 'red'}\r\n        isInteractive\r\n        isSelected={isSelected}\r\n        onClick={() => {\r\n          // Explicit call to toggle state\r\n          if (isSelected) {\r\n            onSelect();\r\n          } else {\r\n            onSelect();\r\n          }\r\n        }}\r\n        className={`transition-all duration-300 ease-out hover:scale-[1.01] ${\r\n          isFiltered ? 'opacity-100' : 'opacity-50'\r\n        }`}\r\n      >\r\n        <div className=\"p-4\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-xl font-orbitron text-white flex items-center gap-2\">\r\n                <Ship className=\"w-5 h-5 text-blue-400\" />\r\n                {fleet.name}\r\n              </h3>\r\n              {/* Badges */}\r\n              <div className=\"flex items-center gap-2 mt-2\">\r\n                <span className={`px-2 py-1 rounded-full text-xs\r\n                  ${fleet.alignment === 'light'\r\n                    ? 'bg-blue-500/20 text-blue-400'\r\n                    : 'bg-red-500/20 text-red-400'\r\n                  }`}\r\n                >\r\n                  {fleet.alignment === 'light' ? 'Light Side' : 'Dark Side'}\r\n                </span>\r\n              </div>\r\n            </div>\r\n              {/* Visa metadata i Icon Tooltip*/}\r\n              {/*\r\n            <div className=\"flex items-center gap-2\">\r\n              {onViewDetails && (\r\n                <>\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setShowMetadata(true);\r\n                    }}\r\n                    className=\"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg\"\r\n                  >\r\n                    <Info className=\"w-4 h-4\" />\r\n                  </button>\r\n                  <MetadataView \r\n                    isOpen={showMetadata}\r\n                    onClose={() => setShowMetadata(false)}\r\n                    data={fleet}\r\n                  />\r\n                </>\r\n              )}\r\n              <button\r\n                onClick={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  onSelect();\r\n                }}\r\n                className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n              >\r\n                {isSelected ? (\r\n                  <ChevronUp className=\"w-4 h-4\" />\r\n                ) : (\r\n                  <ChevronDown className=\"w-4 h-4\" />\r\n                )}\r\n              </button>\r\n            </div>  */}\r\n          </div>\r\n\r\n          {/* Fleet Formation */}\r\n          <div className=\"flex flex-wrap items-center gap-2 mt-4\">\r\n            {/* Capital Ship */}\r\n            {fleet.capitalShip && (\r\n              <UnitImage\r\n                id={fleet.capitalShip.id}\r\n                name={fleet.capitalShip.name}\r\n                type=\"capital-ship\"\r\n                size=\"md\"\r\n                className=\"rounded-full border-2 border-blue-400\"\r\n                withTooltip={true}\r\n                isCapital={true}\r\n              />\r\n            )}\r\n\r\n            {/* Starting Lineup */}\r\n            {fleet.startingLineup.map((ship) => (\r\n              <UnitImage\r\n                key={ship.id}\r\n                id={ship.id}\r\n                name={ship.name}\r\n                type=\"ship\"\r\n                size=\"md\"\r\n                className=\"rounded-full border-2 border-white/20\"\r\n                withTooltip={true}\r\n              />\r\n            ))}\r\n\r\n            {/* Reinforcements */}\r\n            {fleet.reinforcements.map((ship) => (\r\n              <div key={ship.id} className=\"relative group opacity-75\">\r\n                <div className=\"relative\">\r\n                  <UnitImage\r\n                    id={ship.id}\r\n                    name={ship.name}\r\n                    type=\"ship\"\r\n                    size=\"md\"\r\n                    className=\"rounded-full border-2 border-white/20\"\r\n                    withTooltip={true}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Fleet Call Order Strategy - Keep this since it's part of Fleet type */}\r\n          {fleet.callOrder && (\r\n            <div className=\"mt-4 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20\">\r\n              <h4 className=\"text-sm font-medium text-blue-400 mb-1\">Call Order</h4>\r\n              <p className=\"text-sm text-white/70\">{fleet.callOrder}</p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Counters Section */}\r\n          <AnimatePresence>\r\n            {isSelected && fleetCounters.length > 0 && (\r\n              <motion.div\r\n                initial={{ height: 0, opacity: 0 }}\r\n                animate={{ height: 'auto', opacity: 1 }}\r\n                exit={{ height: 0, opacity: 0 }}\r\n                transition={{ duration: 0.3 }}\r\n                className=\"mt-6 space-y-4 overflow-hidden\"\r\n                ref={contentRef}\r\n              >\r\n                <h4 className=\"text-lg font-medium text-white\">Counters</h4>\r\n                {fleetCounters.map((counter) => (\r\n                  <div key={counter.id} className=\"p-4 bg-white/5 rounded-lg space-y-4\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className={`px-2 py-1 rounded-full text-xs\r\n                          ${counter.counterType === 'hard'\r\n                            ? 'bg-green-500/20 text-green-400'\r\n                            : counter.counterType === 'soft'\r\n                            ? 'bg-yellow-500/20 text-yellow-400'\r\n                            : 'bg-red-500/20 text-red-400'\r\n                          }`}\r\n                        >\r\n                          {counter.counterType.charAt(0).toUpperCase() + counter.counterType.slice(1)}\r\n                        </span>\r\n                        {counter.video_url && <VideoIndicator videoUrl={counter.video_url} />}\r\n                      </div>\r\n                      {isAdmin && onDeleteCounter && (\r\n                        <button\r\n                          onClick={() => onDeleteCounter(counter.id)}\r\n                          className=\"p-2 text-red-400 hover:bg-red-400/10 rounded-lg\"\r\n                        >\r\n                          <Trash2 className=\"w-4 h-4\" />\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n\r\n                    <p className=\"text-white/70\">{counter.description}</p>\r\n\r\n{/* Counter Fleet Preview */}\r\n{'capitalShip' in counter.counterSquad && (\r\n  <div className=\"mt-4\">\r\n    <div className=\"flex flex-wrap items-center gap-2\">\r\n      {/* Capital Ship */}\r\n      {counter.counterSquad.capitalShip && (\r\n        <div className=\"relative\">\r\n          <UnitImage\r\n            id={counter.counterSquad.capitalShip.id}\r\n            name={counter.counterSquad.capitalShip.name}\r\n            type=\"capital-ship\"\r\n            size=\"sm\"\r\n            className=\"border-2 border-blue-400\"\r\n          />\r\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full \r\n                       flex items-center justify-center text-white text-xs\">\r\n            C\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Starting Lineup */}\r\n      {counter.counterSquad.startingLineup.map((ship) => (\r\n        <UnitImage\r\n          key={ship.id}\r\n          id={ship.id}\r\n          name={ship.name}\r\n          type=\"ship\"\r\n          size=\"sm\"\r\n          className=\"border-2 border-white/20\"\r\n        />\r\n      ))}\r\n\r\n      {/* Reinforcements */}\r\n      {counter.counterSquad.reinforcements.map((ship) => (\r\n        <div key={ship.id} className=\"relative\">\r\n          <UnitImage\r\n            id={ship.id}\r\n            name={ship.name}\r\n            type=\"ship\"\r\n            size=\"sm\"\r\n            className=\"border-2 border-white/20 opacity-75\"\r\n          />\r\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full \r\n                       flex items-center justify-center text-white text-xs\">\r\n            R\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n                    {/* Strategy */}\r\n                    {counter.strategy.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <h4 className=\"text-sm font-medium text-white/80\">Strategy:</h4>\r\n                        <div className=\"space-y-3\">\r\n                          {counter.strategy.map((step, idx) => (\r\n                            <div key={step.key} className=\"flex gap-3\">\r\n                              <span className=\"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 text-blue-400 \r\n                                            flex items-center justify-center text-sm\">\r\n                                {idx + 1}\r\n                              </span>\r\n                              <p className=\"text-sm text-white/70\">{step.description}</p>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {isAdmin && onAddCounter && (\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onAddCounter(fleet);\r\n              }}\r\n              className=\"p-2 text-green-400 hover:bg-green-400/10 rounded-lg\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n      </GlassCard>\r\n    </ErrorBoundary>\r\n  );\r\n});\r\n\r\nFleetCard.displayName = 'FleetCard';","import React from 'react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { RefreshCw, Ship } from 'lucide-react';\r\nimport { Fleet, Counter } from '@/types';\r\nimport { FleetCard } from './FleetCard';\r\nimport ErrorBoundary from './ErrorBoundary';\r\n\r\ninterface FleetListProps {\r\n  fleets: Fleet[];\r\n  filteredFleets: Fleet[];\r\n  selectedFleetId: string | null;\r\n  onSelectFleet: (id: string | null) => void;\r\n  getCounters: (id: string) => Counter[];\r\n  isAdmin?: boolean;\r\n  onDeleteCounter?: (id: string) => void;\r\n  onViewDetails?: () => void;\r\n}\r\n\r\nexport const FleetList: React.FC<FleetListProps> = ({\r\n  fleets,\r\n  filteredFleets,\r\n  selectedFleetId,\r\n  onSelectFleet,\r\n  getCounters,\r\n  isAdmin,\r\n  onDeleteCounter,\r\n  onViewDetails\r\n}) => {\r\n  const handleFleetSelect = (fleetId: string) => {\r\n    if (selectedFleetId === fleetId) {\r\n      onSelectFleet(null);\r\n    } else {\r\n      onSelectFleet(fleetId);\r\n    }\r\n  };\r\n\r\n  if (!fleets || fleets.length === 0) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12 text-white/60\">\r\n        <Ship className=\"w-12 h-12 mb-4 animate-float\" />\r\n        <p className=\"text-lg\">No fleets found</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={\r\n        <div className=\"flex flex-col items-center justify-center p-8\">\r\n          <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full\">\r\n            <h3 className=\"text-lg font-medium text-red-400 mb-2\">\r\n              Failed to load fleets\r\n            </h3>\r\n            <p className=\"text-sm text-red-400/80 mb-4\">\r\n              Please try refreshing the page\r\n            </p>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                       bg-red-500/20 text-red-400 hover:bg-red-500/30\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4\" />\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n      }\r\n    >\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        <AnimatePresence mode=\"popLayout\">\r\n          {filteredFleets.map((fleet) => (\r\n            <motion.div\r\n              key={fleet.id}\r\n              layout\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -20 }}\r\n              transition={{ duration: 0.3 }}\r\n            >\r\n              <FleetCard\r\n                fleet={fleet}\r\n                isSelected={selectedFleetId === fleet.id}\r\n                onSelect={() => handleFleetSelect(fleet.id)}\r\n                counters={getCounters(fleet.id)}\r\n                isFiltered={true}\r\n                isAdmin={isAdmin}\r\n                onDeleteCounter={onDeleteCounter}\r\n                onViewDetails={onViewDetails}\r\n              />\r\n            </motion.div>\r\n          ))}\r\n        </AnimatePresence>\r\n      </div>\r\n    </ErrorBoundary>\r\n  );\r\n};","import React, { useMemo, useRef, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Filter, X, SunMedium, Moon, Shield, Swords, RefreshCw } from 'lucide-react';\r\nimport { Filters, FilterKey } from '@/types';\r\nimport { createFocusTrap } from 'focus-trap';\r\n\r\ninterface FiltersMenuProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  filters: Filters;\r\n  onFilterChange: (key: FilterKey, value: Filters[FilterKey]) => void;\r\n}\r\n\r\nexport const FiltersMenu: React.FC<FiltersMenuProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  filters,\r\n  onFilterChange\r\n}) => {\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n\r\n  const hasActiveFilters = Object.entries(filters).some(([key, value]) => {\r\n    if (key === 'searchTerm') return false;\r\n    if (typeof value === 'boolean') return value;\r\n    return value !== null;\r\n  });\r\n\r\n  // Filter categories with their options\r\n  const filterCategories = useMemo(() => [\r\n    {\r\n      title: 'Battle Type',\r\n      options: [\r\n        { \r\n          key: 'battleType' as FilterKey,\r\n          value: 'team',\r\n          label: 'Squads',\r\n          icon: <Swords className=\"w-4 h-4\" />\r\n        },\r\n        {\r\n          key: 'battleType' as FilterKey,\r\n          value: 'fleet',\r\n          label: 'Fleets',\r\n          icon: <Shield className=\"w-4 h-4\" />\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      title: 'Alignment',\r\n      options: [\r\n        {\r\n          key: 'alignment' as FilterKey,\r\n          value: 'light',\r\n          label: 'Light Side',\r\n          icon: <SunMedium className=\"w-4 h-4\" />\r\n        },\r\n        {\r\n          key: 'alignment' as FilterKey,\r\n          value: 'dark',\r\n          label: 'Dark Side',\r\n          icon: <Moon className=\"w-4 h-4\" />\r\n        }\r\n      ]\r\n    }\r\n  ], []);\r\n\r\n  const toggleOptions = [\r\n    {\r\n      key: 'showTWOmicronOnly' as FilterKey,\r\n      label: 'TW Omicron Only',\r\n      description: 'Show only teams with Territory Wars Omicron abilities'\r\n    },\r\n    {\r\n      key: 'showHardCounters' as FilterKey,\r\n      label: 'Hard Counters Only',\r\n      description: 'Show only teams with reliable counter options'\r\n    },\r\n    {\r\n      key: 'excludeGL' as FilterKey,\r\n      label: 'Exclude Galactic Legends',\r\n      description: 'Hide teams with Galactic Legend characters'\r\n    }\r\n  ];\r\n\r\n  // Add focus trap\r\n  useEffect(() => {\r\n    if (isOpen && menuRef.current) {\r\n      const trap = createFocusTrap(menuRef.current, {\r\n        escapeDeactivates: true,\r\n        allowOutsideClick: true\r\n      });\r\n      trap.activate();\r\n      return () => {\r\n        trap.deactivate();\r\n      };\r\n    }\r\n    return;\r\n  }, [isOpen]);\r\n\r\n  const resetFilters = () => {\r\n    onFilterChange('battleType', null);\r\n    onFilterChange('alignment', null);\r\n    onFilterChange('showTWOmicronOnly', false);\r\n    onFilterChange('showHardCounters', false);\r\n    onFilterChange('excludeGL', false);\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: isOpen ? 1 : 0 }}\r\n      exit={{ opacity: 0 }}\r\n      transition={{ duration: 0.2 }}\r\n      className={`fixed inset-0 bg-black/50 backdrop-blur-sm z-50 ${!isOpen && 'pointer-events-none'}`}\r\n      onClick={onClose}\r\n    >\r\n      <motion.div\r\n        ref={menuRef}\r\n        initial={{ x: '100%' }}\r\n        animate={{ x: isOpen ? 0 : '100%' }}\r\n        transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\r\n        className=\"fixed inset-y-0 right-0 w-full max-w-md flex flex-col bg-gradient-to-br \r\n                 from-space-darker/90 to-space-dark/90 backdrop-blur-xl border-l \r\n                 border-white/10 shadow-2xl rounded-l-2xl overflow-hidden z-50\"\r\n        onClick={e => e.stopPropagation()}\r\n      >\r\n        {/* Header Section */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-white/10\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Filter className={`w-5 h-5 ${hasActiveFilters ? 'text-blue-400' : 'text-white/60'}`} />\r\n            <h2 className=\"text-xl font-orbitron text-white\">Filters</h2>\r\n          </div>\r\n          <motion.button\r\n            whileHover={{ scale: 1.1 }}\r\n            whileTap={{ scale: 0.9 }}\r\n            onClick={onClose}\r\n            className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg \r\n                     transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </motion.button>\r\n        </div>\r\n\r\n        {/* Scrollable Content */}\r\n        <div ref={contentRef} className=\"flex-1 overflow-y-auto custom-scrollbar\">\r\n          <div className=\"p-6 space-y-8\">\r\n            {/* Filter Categories */}\r\n            {filterCategories.map((category) => (\r\n              <motion.div\r\n                key={category.title}\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"space-y-4\"\r\n              >\r\n                <h3 className=\"text-sm font-medium text-white/60\">{category.title}</h3>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  {category.options.map((option) => (\r\n                    <motion.button\r\n                      key={option.value}\r\n                      whileHover={{ scale: 1.02 }}\r\n                      whileTap={{ scale: 0.98 }}\r\n                      onClick={() => onFilterChange(\r\n                        option.key,\r\n                        filters[option.key] === option.value ? null : option.value\r\n                      )}\r\n                      className={`flex items-center justify-center gap-2 p-3 rounded-lg border \r\n                              transition-all ${\r\n                                filters[option.key] === option.value\r\n                                  ? 'bg-blue-500/20 border-blue-400 text-white shadow-neon-blue'\r\n                                  : 'border-white/10 text-white/60 hover:bg-white/5'\r\n                              }`}\r\n                    >\r\n                      {option.icon}\r\n                      {option.label}\r\n                    </motion.button>\r\n                  ))}\r\n                </div>\r\n              </motion.div>\r\n            ))}\r\n\r\n            {/* Toggle Options */}\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <h3 className=\"text-sm font-medium text-white/60\">Additional Options</h3>\r\n              {toggleOptions.map((option) => (\r\n                <motion.label\r\n                  key={option.key}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg border border-white/10 \r\n                           hover:bg-white/5 cursor-pointer group\"\r\n                >\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={filters[option.key] as boolean}\r\n                    onChange={(e) => onFilterChange(option.key, e.target.checked)}\r\n                    className=\"mt-1 w-4 h-4 rounded border-white/20 bg-white/5 checked:bg-blue-500 \r\n                             checked:border-blue-500 transition-colors\"\r\n                  />\r\n                  <div className=\"space-y-1\">\r\n                    <div className=\"text-white group-hover:text-blue-400 transition-colors\">\r\n                      {option.label}\r\n                    </div>\r\n                    <div className=\"text-sm text-white/40\">\r\n                      {option.description}\r\n                    </div>\r\n                  </div>\r\n                </motion.label>\r\n              ))}\r\n            </motion.div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer Section - Fixed at Bottom */}\r\n        <div className=\"p-6 border-t border-white/10 bg-space-darker/90 backdrop-blur-xl\">\r\n          <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={resetFilters}\r\n            disabled={!hasActiveFilters}\r\n            className=\"flex items-center justify-center gap-2 w-full p-3 rounded-lg \r\n                     bg-white/5 text-white hover:bg-white/10 disabled:opacity-50 \r\n                     disabled:cursor-not-allowed transition-colors\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4\" />\r\n            Reset All Filters\r\n          </motion.button>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};","import * as React from \"react\";\r\nimport { cn } from \"../../lib/utils\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nconst alertVariants = cva(\r\n  \"relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50\",\r\n        destructive:\r\n          \"border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n);\r\n\r\nconst Alert = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\r\n>(({ className, variant, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    role=\"alert\"\r\n    className={cn(alertVariants({ variant }), className)}\r\n    {...props}\r\n  />\r\n));\r\nAlert.displayName = \"Alert\";\r\n\r\nconst AlertTitle = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n  <h5\r\n    ref={ref}\r\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\r\n    {...props}\r\n  />\r\n));\r\nAlertTitle.displayName = \"AlertTitle\";\r\n\r\nconst AlertDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\r\n    {...props}\r\n  />\r\n));\r\nAlertDescription.displayName = \"AlertDescription\";\r\n\r\nexport { Alert, AlertTitle, AlertDescription };","import { useState, useCallback, useMemo, useEffect } from 'react';\r\nimport { Search, X } from 'lucide-react';\r\nimport { Character, Ship } from '@/types';\r\nimport { UnitImage } from './ui/UnitImage';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nexport type SelectionType = \r\n  | 'leader' \r\n  | 'member' \r\n  | 'capital' \r\n  | 'starting'\r\n  | 'reinforcement';\r\n\r\nexport interface UnitSelectorProps<T extends Ship | Character> {\r\n  type: T extends Ship ? 'ship' : 'character';\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSelect: (unit: T) => void;\r\n  availableUnits: T[];\r\n  alignment: 'light' | 'dark';\r\n  selectionType: SelectionType;\r\n  title?: string;\r\n  isCounterContext?: boolean;\r\n}\r\n\r\nexport function UnitSelector<T extends Ship | Character>({\r\n  type,\r\n  isOpen,\r\n  onClose,\r\n  onSelect,\r\n  availableUnits,\r\n  alignment,\r\n  selectionType,\r\n  title = 'Select Unit',\r\n  isCounterContext\r\n}: UnitSelectorProps<T>) {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  const filteredUnits = useMemo(() => {\r\n    if (!availableUnits?.length) {\r\n      return [];\r\n    }\r\n\r\n    return availableUnits.filter(unit => {\r\n      const matchesSearch = !searchTerm || unit.name.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n      // Ship-specific filtering\r\n      if (type === 'ship') {\r\n        const ship = unit as Ship;\r\n        \r\n        // Om det är counter context, inkludera capital ships\r\n        if (isCounterContext) {\r\n          return matchesSearch && ship.isCapital; // Allow all ships, including capital ships\r\n        }\r\n\r\n        // Om selectionType är 'capital', inkludera kapitalfartyg\r\n        if (selectionType === 'capital') {\r\n          return matchesSearch && ship.isCapital;\r\n        }\r\n      }\r\n      return matchesSearch;\r\n  });\r\n}, [availableUnits, searchTerm, alignment, type, selectionType, isCounterContext]);\r\n\r\n  useEffect(() => {\r\n    console.log('UnitSelector mounted/updated:', {\r\n      type,\r\n      alignment,\r\n      availableUnitsCount: availableUnits.length,\r\n      selectionType,\r\n      firstUnitName: availableUnits[0]?.name,\r\n      filteredCount: filteredUnits.length\r\n    });\r\n  }, [type, alignment, availableUnits, selectionType, filteredUnits]);\r\n\r\n  useEffect(() => {\r\n    console.log('Available Units:', availableUnits);\r\n  }, [availableUnits]);\r\n\r\n// I UnitSelector.tsx\r\nconst handleSelect = useCallback((unit: T) => {\r\n  onSelect(unit);\r\n  // Låt parent komponenten hantera stängning\r\n}, [onSelect]);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[70] flex items-center justify-center\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.9, opacity: 0 }}\r\n            animate={{ scale: 1, opacity: 1 }}\r\n            exit={{ scale: 0.9, opacity: 0 }}\r\n            className=\"w-full max-w-md bg-space-darker rounded-lg border border-white/10\"\r\n            onClick={e => e.stopPropagation()}\r\n          >\r\n            <div className=\"p-4 border-b border-white/10 flex justify-between items-center\">\r\n              <h3 className=\"text-lg font-medium text-white\">\r\n                {title}\r\n              </h3>\r\n              <button \r\n                onClick={onClose}\r\n                className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n              <div className=\"relative mb-4\">\r\n                <Search className=\"absolute left-3 top-2.5 w-4 h-4 text-white/40\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={e => setSearchTerm(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg \r\n                         text-white placeholder-white/40\"\r\n                  placeholder={`Search ${type}s...`}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n\r\n              <div className=\"max-h-[60vh] overflow-y-auto\">\r\n                <div className=\"space-y-2\">\r\n                  {filteredUnits.length > 0 ? (\r\n                    filteredUnits.map(unit => (\r\n                      <motion.button\r\n                        key={unit.id}\r\n                        onClick={() => handleSelect(unit)}\r\n                        className=\"w-full flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg \r\n                               text-left transition-colors\"\r\n                        whileHover={{ x: 4 }}\r\n                      >\r\n                        <UnitImage\r\n                          id={unit.id}\r\n                          name={unit.name}\r\n                          type={type === 'character' \r\n                            ? (selectionType === 'leader' ? 'squad-leader' : 'squad-member')\r\n                            : (selectionType === 'capital' ? 'capital-ship' : 'ship')\r\n                          }\r\n                          size=\"sm\"\r\n                          className=\"rounded-full border-2 border-blue-500/50\"\r\n                          isLeader={selectionType === 'leader'}\r\n                          isCapital={selectionType === 'capital'}\r\n                        />\r\n                        <div>\r\n                          <div className=\"text-white\">{unit.name}</div>\r\n                          {'role' in unit && (\r\n                            <div className=\"text-sm text-white/60\">{(unit as Character).role}</div>\r\n                          )}\r\n                          {'isCapital' in unit && unit.isCapital && (\r\n                            <div className=\"text-sm text-blue-400\">Capital Ship</div>\r\n                          )}\r\n                        </div>\r\n                      </motion.button>\r\n                    ))\r\n                  ) : (\r\n                    <div className=\"text-center text-white/60 py-4\">\r\n                      {searchTerm.trim() \r\n                        ? `No ${type}s found matching \"${searchTerm}\"`\r\n                        : `No ${type}s available`\r\n                      }\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Play, Maximize2, X } from 'lucide-react';\r\n\r\ninterface VideoGuideProps {\r\n  videoUrl: string;\r\n  title?: string;\r\n  autoplay?: boolean;\r\n}\r\n\r\nexport const VideoGuide: React.FC<VideoGuideProps> = ({\r\n  videoUrl,\r\n  title,\r\n  autoplay = false\r\n}) => {\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isPlaying, setIsPlaying] = useState(autoplay);\r\n\r\n  // Extract YouTube video ID from URL\r\n  const getYouTubeId = (url: string) => {\r\n    const match = url.match(/(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))([^&?\\s]+)/);\r\n    return match ? match[1] : null;\r\n  };\r\n\r\n  const videoId = getYouTubeId(videoUrl);\r\n\r\n  if (!videoId) return null;\r\n\r\n  const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;\r\n\r\n  const handlePlay = () => {\r\n    setIsPlaying(true);\r\n  };\r\n\r\n  return (\r\n    <div className={`relative ${isExpanded ? 'fixed inset-0 z-50 bg-black/90' : ''}`}>\r\n      <div className={`relative ${\r\n        isExpanded \r\n          ? 'w-full h-full flex items-center justify-center p-4'\r\n          : 'w-full aspect-video'\r\n      }`}>\r\n        {!isPlaying ? (\r\n          <div className=\"relative w-full aspect-video rounded-lg overflow-hidden group\">\r\n            <img\r\n              src={thumbnailUrl}\r\n              alt={title || \"Video thumbnail\"}\r\n              className=\"w-full h-full object-cover\"\r\n            />\r\n            <div className=\"absolute inset-0 bg-black/40 flex items-center justify-center\r\n                         group-hover:bg-black/60 transition-colors\">\r\n              <button\r\n                onClick={handlePlay}\r\n                className=\"bg-red-600 text-white rounded-full p-4 transform\r\n                         transition-transform group-hover:scale-110\"\r\n              >\r\n                <Play className=\"w-8 h-8\" />\r\n              </button>\r\n            </div>\r\n            {title && (\r\n              <div className=\"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80\">\r\n                <h3 className=\"text-white font-medium\">{title}</h3>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <iframe\r\n            src={`https://www.youtube.com/embed/${videoId}?autoplay=1`}\r\n            title={title || 'Strategy Guide'}\r\n            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n            allowFullScreen\r\n            className={`rounded-lg ${\r\n              isExpanded ? 'w-full max-w-6xl aspect-video' : 'w-full h-full'\r\n            }`}\r\n          />\r\n        )}\r\n        \r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"absolute top-2 right-2 p-2 rounded-lg bg-black/50 text-white hover:bg-black/70\r\n                   transition-colors\"\r\n        >\r\n          {isExpanded ? (\r\n            <X className=\"w-5 h-5\" />\r\n          ) : (\r\n            <Maximize2 className=\"w-5 h-5\" />\r\n          )}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};","// src/components/counter/CounterEditor.tsx\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { X, AlertTriangle, RefreshCw } from 'lucide-react';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { Counter, Squad, Fleet, Character, Ship } from '@/types';\r\nimport { UnitSelector } from '../UnitSelector';\r\nimport { UnitImage } from '../ui/UnitImage';\r\nimport { VideoGuide } from '../VideoGuide';\r\nimport ErrorBoundary from '../ErrorBoundary';\r\n\r\ninterface CounterEditorProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  targetDefense: Squad | Fleet;\r\n  onSave: (counter: Counter) => Promise<void>;\r\n  onDelete?: (counterId: string) => Promise<void>;\r\n  availableUnits: (Character | Ship)[];\r\n  existingCounter?: Counter | null;\r\n  isFleet: boolean;\r\n}\r\n\r\ninterface ModRequirement {\r\n  character: string;\r\n  description: string;\r\n}\r\n\r\ninterface TWOmicronData {\r\n  required: boolean;\r\n  comment: string;\r\n}\r\n\r\nexport const CounterEditor: React.FC<CounterEditorProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  targetDefense,\r\n  onSave,\r\n  onDelete,\r\n  availableUnits,\r\n  existingCounter,\r\n  isFleet\r\n}) => {\r\n  const [selectedUnits, setSelectedUnits] = useState<(Character | Ship)[]>(() => {\r\n    if (!existingCounter) return [];\r\n    \r\n    if (!isFleet) {\r\n      const squad = existingCounter.counterSquad as Squad;\r\n      // Ensure squad.characters is defined and iterable\r\n      return [squad.leader, ...(squad.characters || [])].filter((unit): unit is Character => unit !== null);\r\n    } else {\r\n      const fleet = existingCounter.counterSquad as Fleet;\r\n      return [\r\n        fleet.capitalShip,\r\n        ...fleet.startingLineup,\r\n        ...fleet.reinforcements\r\n      ].filter((unit): unit is Ship => unit !== null);\r\n    }\r\n  });\r\n\r\n  const [counterType, setCounterType] = useState<'hard' | 'soft' | 'risky'>(\r\n    existingCounter?.counterType || 'hard'\r\n  );\r\n  const [description, setDescription] = useState(existingCounter?.description || '');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showSelector, setShowSelector] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [twOmicron, setTwOmicron] = useState<TWOmicronData>({\r\n    required: existingCounter?.twOmicronRequired || false,\r\n    comment: existingCounter?.twOmicronComment || ''\r\n  });\r\n  const [videoUrl, setVideoUrl] = useState(existingCounter?.video_url || '');\r\n  const [datacronRequired, setDatacronRequired] = useState(existingCounter?.datacronRequired || null);\r\n  const [modRequirements, setModRequirements] = useState<ModRequirement[]>(\r\n    existingCounter?.requirements\r\n      ?.filter(req => req.type === 'mods')\r\n      .map(req => {\r\n        const [character, ...descParts] = req.description.split(':');\r\n        return {\r\n          character: character.trim(),\r\n          description: descParts.join(':').trim()\r\n        };\r\n      }) || []\r\n  );\r\n\r\n  // Add logging when props change\r\n  useEffect(() => {\r\n    console.log('CounterEditor received props:', {\r\n      targetDefenseType: targetDefense.type,\r\n      targetDefenseName: targetDefense.name,\r\n      availableUnitsCount: availableUnits.length,\r\n      hasExistingCounter: !!existingCounter,\r\n      isFleet\r\n    });\r\n  }, [targetDefense, availableUnits, existingCounter, isFleet]);\r\n\r\n  useEffect(() => {\r\n    if (existingCounter) {\r\n      setCounterType(existingCounter.counterType);\r\n      setDescription(existingCounter.description);\r\n      // Reset selected units based on existing counter\r\n      if (existingCounter.counterSquad.type === 'squad') {\r\n        const squad = existingCounter.counterSquad as Squad;\r\n        setSelectedUnits([squad.leader, ...squad.characters].filter((unit): unit is Character => unit !== null));\r\n      } else {\r\n        const fleet = existingCounter.counterSquad as Fleet;\r\n        setSelectedUnits([\r\n          fleet.capitalShip,\r\n          ...fleet.startingLineup,\r\n          ...fleet.reinforcements\r\n        ].filter((unit): unit is Ship => unit !== null));\r\n      }\r\n    }\r\n  }, [existingCounter]);\r\n\r\n  const handleSave = async () => {\r\n    if (!navigator.onLine) {\r\n      setError('Cannot save while offline');\r\n      return;\r\n    }\r\n  \r\n    try {\r\n      setSaving(true);\r\n      \r\n      if (selectedUnits.length === 0) {\r\n        setError('Please select counter units');\r\n        return;\r\n      }\r\n  \r\n      let counterData: Counter;  // Deklarera variabeln här\r\n      \r\n      const baseCounter = {\r\n        id: existingCounter?.id || `counter-${Date.now()}`,\r\n        counterType,\r\n        description: description.trim(),\r\n        video_url: videoUrl || undefined,\r\n        strategy: existingCounter?.strategy || []\r\n      };\r\n  \r\n      if (isFleet) {\r\n        const fleetUnits = selectedUnits as Ship[];\r\n        \r\n        // Use the validateFleetUnits function\r\n        const validationError = validateFleetUnits(fleetUnits);\r\n        if (validationError) {\r\n          setError(validationError);\r\n          return;\r\n        }\r\n  \r\n        counterData = {\r\n          ...baseCounter,\r\n          targetSquad: targetDefense as Fleet,\r\n          counterSquad: {\r\n            id: `fleet-${Date.now()}`,\r\n            type: 'fleet',\r\n            name: `Counter for ${targetDefense.name}`,\r\n            alignment: targetDefense.alignment,\r\n            capitalShip: fleetUnits[0],\r\n            startingLineup: fleetUnits.slice(1, 4),\r\n            reinforcements: fleetUnits.slice(4),\r\n          } as Fleet,\r\n          requirements: []\r\n        };\r\n      } else {\r\n        // Squad counter logik\r\n        counterData = {\r\n          ...baseCounter,\r\n          targetSquad: targetDefense as Squad,\r\n          counterSquad: {\r\n            id: `squad-${Date.now()}`,\r\n            type: 'squad',\r\n            name: `Counter for ${targetDefense.name}`,\r\n            alignment: targetDefense.alignment,\r\n            leader: selectedUnits[0] as Character,\r\n            characters: selectedUnits.slice(1) as Character[],\r\n          } as Squad,\r\n          twOmicronRequired: twOmicron.required,\r\n          twOmicronComment: twOmicron.comment,\r\n          datacronRequired: datacronRequired?.level ? datacronRequired : undefined,\r\n          requirements: modRequirements.map(mod => ({\r\n            type: 'mods' as const,\r\n            description: `${mod.character}: ${mod.description}`,\r\n            priority: 'required' as const\r\n          }))\r\n        };\r\n      }\r\n  \r\n      await onSave(counterData);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error saving counter:', error);\r\n      setError(error instanceof Error ? error.message : 'Failed to save counter');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!existingCounter || !onDelete) return;\r\n    \r\n    if (!navigator.onLine) {\r\n      setError('Cannot delete while offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      await onDelete(existingCounter.id);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error deleting counter:', error);\r\n      setError(error instanceof Error ? error.message : 'Failed to delete counter');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Add the getShipRole function\r\n  const getShipRole = (index: number): string => {\r\n    if (index === 0) return 'Capital Ship';\r\n    if (index >= 1 && index <= 3) return `Starting Ship ${index}`;\r\n    return `Reinforcement ${index - 3}`;\r\n  };\r\n\r\n  // Add validation for fleet-specific rules\r\n  const validateFleetUnits = (units: Ship[]) => {\r\n    if (units.length === 0) return 'At least one ship is required';\r\n    if (!units[0].isCapital) return 'First ship must be a capital ship';\r\n    if (units.length > 7) return 'Maximum of 7 ships allowed';\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={\r\n        <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20\">\r\n          <h3 className=\"text-lg font-medium text-red-400 mb-2\">\r\n            Counter Editor Error\r\n          </h3>\r\n          <p className=\"text-sm text-red-400/80 mb-4\">\r\n            An error occurred while editing the counter.\r\n          </p>\r\n          <div className=\"flex gap-3\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded-lg bg-white/10 text-white \r\n                       hover:bg-white/20\"\r\n            >\r\n              Close\r\n            </button>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                       bg-red-500/20 text-red-400 hover:bg-red-500/30\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4\" />\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n      }\r\n    >\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: isOpen ? 1 : 0 }}\r\n        exit={{ opacity: 0 }}\r\n        className={`fixed inset-0 z-50 overflow-y-auto ${!isOpen && 'pointer-events-none'}`}\r\n      >\r\n        <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onClick={onClose} />\r\n        <div className=\"min-h-screen flex items-start justify-center py-8\">\r\n          <motion.div\r\n            initial={{ scale: 0.95, opacity: 0 }}\r\n            animate={{ scale: 1, opacity: 1 }}\r\n            exit={{ scale: 0.95, opacity: 0 }}\r\n            className=\"relative w-full max-w-2xl mx-4 bg-space-darker rounded-lg border border-white/10\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Sticky Header */}\r\n            <div className=\"sticky top-0 z-10 bg-space-darker border-b border-white/10 p-4\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <h2 className=\"text-xl font-medium text-white\">\r\n                  {existingCounter ? 'Edit Counter' : 'Add Counter'}\r\n                </h2>\r\n                <button onClick={onClose} className=\"p-2 text-white/60 hover:text-white\">\r\n                  <X className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Scrollable Content */}\r\n            <div className=\"max-h-[calc(100vh-theme(spacing.32))] overflow-y-auto custom-scrollbar\">\r\n              <div className=\"p-6 space-y-6\">\r\n                {error && (\r\n                  <Alert variant=\"destructive\">\r\n                    <AlertTriangle className=\"w-4 h-4\" />\r\n                    <AlertTitle>Error</AlertTitle>\r\n                    <AlertDescription>{error}</AlertDescription>\r\n                  </Alert>\r\n                )}\r\n\r\n                {/* Counter Type Selection */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"text-sm font-medium text-white\">Counter Type</label>\r\n                  <div className=\"flex gap-3\">\r\n                    {(['hard', 'soft', 'risky'] as const).map((type) => (\r\n                      <button\r\n                        key={type}\r\n                        onClick={() => setCounterType(type)}\r\n                        className={`px-4 py-2 rounded-lg capitalize ${\r\n                          counterType === type\r\n                            ? type === 'hard'\r\n                              ? 'bg-green-500/20 text-green-400'\r\n                              : type === 'soft'\r\n                              ? 'bg-yellow-500/20 text-yellow-400'\r\n                              : 'bg-red-500/20 text-red-400'\r\n                            : 'bg-white/5 text-white/60'\r\n                        }`}\r\n                      >\r\n                        {type}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Counter Units */}\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <label className=\"text-sm font-medium text-white\">Counter Units</label>\r\n                    <button\r\n                      onClick={() => setShowSelector(true)}\r\n                      className=\"text-sm text-blue-400 hover:text-blue-300\"\r\n                    >\r\n                      + Add Unit\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"flex flex-wrap gap-4\">\r\n  {selectedUnits.filter(unit => unit && unit.id).map((unit, index) => (\r\n    <div key={unit.id} className=\"relative\">\r\n      <UnitImage\r\n        id={unit.id}\r\n        name={unit.name}\r\n        type={targetDefense.type === 'squad' ? 'squad-member' : 'ship'}\r\n        size=\"md\"\r\n        className={`${index === 0 && isFleet ? 'border-2 border-blue-400' : ''}`}\r\n      />\r\n      {isFleet && (\r\n        <div className=\"absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-black/90 px-2 py-1 rounded text-xs text-white whitespace-nowrap\">\r\n          {getShipRole(index)}\r\n        </div>\r\n      )}\r\n      <button\r\n        onClick={() => setSelectedUnits(units => units.filter((_, i) => i !== index))}\r\n        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n      >\r\n        <X className=\"w-3 h-3 text-white\" />\r\n      </button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"text-sm font-medium text-white\">Description</label>\r\n                  <textarea\r\n                    value={description}\r\n                    onChange={(e) => setDescription(e.target.value)}\r\n                    className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                    rows={3}\r\n                    placeholder=\"Describe how this counter works...\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Rendera endast om det inte är en fleet */}\r\n                {!isFleet && (\r\n                  <>\r\n                    {/* Datacron Requirement */}\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <h3 className=\"text-sm font-medium text-white mb-2\">\r\n                          Datacron Requirement (Optional)\r\n                        </h3>\r\n                        <div className=\"flex gap-4\">\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            max=\"9\"\r\n                            placeholder=\"Level\"\r\n                            value={datacronRequired?.level || ''}\r\n                            onChange={(e) => setDatacronRequired({\r\n                              level: parseInt(e.target.value),\r\n                              description: datacronRequired?.description || ''\r\n                            })}\r\n                            className=\"w-24 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                          />\r\n                          <input\r\n                            type=\"text\"\r\n                            placeholder=\"Description\"\r\n                            value={datacronRequired?.description || ''}\r\n                            onChange={(e) => setDatacronRequired({\r\n                              level: datacronRequired?.level || 1,\r\n                              description: e.target.value\r\n                            })}\r\n                            className=\"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Mod Requirements */}\r\n                      <div>\r\n                        <h3 className=\"text-sm font-medium text-white mb-2\">\r\n                          Mod Requirements (Optional)\r\n                        </h3>\r\n                        <div className=\"flex gap-4\">\r\n                          <input\r\n                            type=\"text\"\r\n                            placeholder=\"Character\"\r\n                            value={modRequirements[0]?.character || ''}\r\n                            onChange={(e) => setModRequirements([{\r\n                              character: e.target.value,\r\n                              description: modRequirements[0]?.description || ''\r\n                            }])}\r\n                            className=\"w-1/3 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                          />\r\n                          <input\r\n                            type=\"text\"\r\n                            placeholder=\"Description\"\r\n                            value={modRequirements[0]?.description || ''}\r\n                            onChange={(e) => setModRequirements([{\r\n                              character: modRequirements[0]?.character || '',\r\n                              description: e.target.value\r\n                            }])}\r\n                            className=\"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* TW Omicron Toggle */}\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"twOmicron\"\r\n                          checked={twOmicron.required}\r\n                          onChange={(e) => setTwOmicron({\r\n                            ...twOmicron,\r\n                            required: e.target.checked\r\n                          })}\r\n                          className=\"w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500\"\r\n                        />\r\n                        <label htmlFor=\"twOmicron\" className=\"text-sm text-white\">\r\n                          Requires Territory Wars Omicron\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {/* Video URL */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"text-sm font-medium text-white\">\r\n                    Video Guide URL (Optional)\r\n                  </label>\r\n                  <input\r\n                    type=\"url\"\r\n                    value={videoUrl}\r\n                    onChange={(e) => setVideoUrl(e.target.value)}\r\n                    placeholder=\"YouTube URL...\"\r\n                    className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                  />\r\n                  {videoUrl && (\r\n                    <div className=\"mt-2\">\r\n                      <VideoGuide videoUrl={videoUrl} />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex justify-between gap-3 pt-4\">\r\n                  <div>\r\n                    {existingCounter && onDelete && (\r\n                      <button\r\n                        onClick={handleDelete}\r\n                        disabled={saving}\r\n                        className=\"px-4 py-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 disabled:opacity-50\"\r\n                      >\r\n                        Delete Counter\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={onClose}\r\n                      disabled={saving}\r\n                      className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50\"\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                    <button\r\n                      onClick={handleSave}\r\n                      disabled={saving}\r\n                      className=\"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50\"\r\n                    >\r\n                      {saving ? 'Saving...' : existingCounter ? 'Update Counter' : 'Save Counter'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Unit Selector */}\r\n            {showSelector && (\r\n              <UnitSelector\r\n                type={targetDefense.type === 'squad' ? 'character' : 'ship'}\r\n                isOpen={showSelector}\r\n                onClose={() => setShowSelector(false)}\r\n                onSelect={(unit) => {\r\n                  if (isFleet) {\r\n                    const ship = unit as Ship;\r\n                    setSelectedUnits(prev => {\r\n                      const prevShips = prev as Ship[];\r\n                      // Om det är första skeppet, måste det vara ett capital ship\r\n                      if (prevShips.length === 0) {\r\n                        if (!ship.isCapital) {\r\n                          setError('First ship must be a capital ship');\r\n                          return prevShips;\r\n                        }\r\n                        return [ship];\r\n                      }\r\n                      // Max 3 skepp i starting lineup (position 1-3)\r\n                      if (prevShips.length <= 3) {\r\n                        return [...prevShips, ship];\r\n                      }\r\n                      // Max 3 skepp i reinforcements (position 4-6)\r\n                      if (prevShips.length <= 6) {\r\n                        return [...prevShips, ship];\r\n                      }\r\n                      return prevShips;\r\n                    });\r\n                  } else {\r\n                    setSelectedUnits(prev => [...prev, unit]);\r\n                  }\r\n                  setShowSelector(false);\r\n                }}\r\n                availableUnits={availableUnits}\r\n                alignment={targetDefense.alignment}\r\n                selectionType=\"member\"\r\n              />\r\n            )}\r\n          </motion.div>\r\n        </div>\r\n      </motion.div>\r\n    </ErrorBoundary>\r\n  );\r\n};","import { Squad, Fleet, Character, Ship } from '@/types';\r\n\r\nexport const squadValidators = {\r\n  validateSquadStructure: (squad: Squad): boolean => {\r\n    return Boolean(\r\n      squad.id &&\r\n      squad.name &&\r\n      squad.alignment &&\r\n      Array.isArray(squad.characters)\r\n    );\r\n  },\r\n\r\n  validateCharacters: (characters: Character[]): boolean => {\r\n    return characters.every(char => \r\n      Boolean(char.id && char.name && char.alignment)\r\n    );\r\n  },\r\n\r\n  validateLeader: (leader: Character | null): boolean => {\r\n    if (!leader) return true;\r\n    return Boolean(leader.id && leader.name && leader.alignment);\r\n  },\r\n\r\n  validateCompleteSquad: (squad: Squad): { isValid: boolean; error: string | null } => {\r\n    console.log('Validating squad:', {\r\n      name: squad.name,\r\n      hasLeader: Boolean(squad.leader),\r\n      leader: squad.leader,\r\n      membersCount: squad.characters?.length,\r\n      members: squad.characters\r\n    });\r\n\r\n    if (!squad.name?.trim()) {\r\n      return { isValid: false, error: 'Squad name is required' };\r\n    }\r\n\r\n    if (!squad.leader) {\r\n      console.log('Leader validation failed:', squad.leader);\r\n      return { isValid: false, error: 'Squad must have a leader' };\r\n    }\r\n\r\n    if (!squad.characters?.length) {\r\n      return { isValid: false, error: 'Squad must have at least one member' };\r\n    }\r\n\r\n    return { isValid: true, error: null };\r\n  }\r\n};\r\n\r\nexport const fleetValidators = {\r\n  validateFleetStructure: (fleet: Fleet): boolean => {\r\n    return Boolean(\r\n      fleet.id &&\r\n      fleet.name &&\r\n      fleet.alignment &&\r\n      Array.isArray(fleet.startingLineup)\r\n    );\r\n  },\r\n\r\n  validateShips: (ships: Ship[]): boolean => {\r\n    return ships.every(ship => \r\n      Boolean(ship.id && ship.name && ship.alignment)\r\n    );\r\n  }\r\n}; ","export class SyncLock {\r\n  private static locks: Map<string, boolean> = new Map();\r\n\r\n  static async withLock<T>(key: string, operation: () => Promise<T>, timeout = 30000): Promise<T> {\r\n    if (this.locks.get(key)) {\r\n      console.log(`Operation ${key} is locked, waiting...`);\r\n      return new Promise((resolve, reject) => {\r\n        const wait = setTimeout(() => {\r\n          this.locks.set(key, false);\r\n          reject(new Error(`Operation ${key} timed out`));\r\n        }, timeout);\r\n        \r\n        const checkLock = setInterval(() => {\r\n          if (!this.locks.get(key)) {\r\n            clearInterval(checkLock);\r\n            clearTimeout(wait);\r\n            this.executeWithLock(key, operation).then(resolve).catch(reject);\r\n          }\r\n        }, 100);\r\n      });\r\n    }\r\n    \r\n    return this.executeWithLock(key, operation);\r\n  }\r\n\r\n  private static async executeWithLock<T>(key: string, operation: () => Promise<T>): Promise<T> {\r\n    try {\r\n      console.log(`Acquiring lock for ${key}`);\r\n      this.locks.set(key, true);\r\n      const result = await operation();\r\n      return result;\r\n    } finally {\r\n      console.log(`Releasing lock for ${key}`);\r\n      this.locks.set(key, false);\r\n    }\r\n  }\r\n\r\n  static isLocked(key: string): boolean {\r\n    return this.locks.get(key) || false;\r\n  }\r\n}\r\n\r\nexport class SyncQueue {\r\n  private static queue: Array<{\r\n    operation: () => Promise<void>;\r\n    key: string;\r\n  }> = [];\r\n  private static isProcessing = false;\r\n\r\n  static async add(key: string, operation: () => Promise<void>): Promise<void> {\r\n    console.log(`Adding operation to queue: ${key}`);\r\n    this.queue.push({ operation, key });\r\n    \r\n    if (!this.isProcessing) {\r\n      await this.processQueue();\r\n    }\r\n  }\r\n\r\n  private static async processQueue(): Promise<void> {\r\n    if (this.isProcessing || this.queue.length === 0) return;\r\n    \r\n    this.isProcessing = true;\r\n    console.log('Starting queue processing');\r\n    \r\n    while (this.queue.length > 0) {\r\n      const item = this.queue.shift();\r\n      if (item) {\r\n        try {\r\n          await SyncLock.withLock(item.key, item.operation);\r\n          console.log(`Successfully processed operation: ${item.key}`);\r\n        } catch (error) {\r\n          console.error(`Error processing operation ${item.key}:`, error);\r\n        }\r\n      }\r\n    }\r\n    \r\n    this.isProcessing = false;\r\n    console.log('Queue processing completed');\r\n  }\r\n}\r\n\r\nexport class DebounceSync {\r\n  private static timers: Map<string, NodeJS.Timeout> = new Map();\r\n  private static defaultDelay = 1000; // 1 second\r\n\r\n  static schedule(key: string, operation: () => Promise<void>, delay = this.defaultDelay): void {\r\n    if (this.timers.has(key)) {\r\n      clearTimeout(this.timers.get(key));\r\n    }\r\n\r\n    const timer = setTimeout(async () => {\r\n      try {\r\n        await SyncQueue.add(key, operation);\r\n        this.timers.delete(key);\r\n      } catch (error) {\r\n        console.error(`Error in debounced operation ${key}:`, error);\r\n      }\r\n    }, delay);\r\n\r\n    this.timers.set(key, timer);\r\n  }\r\n}","import { db, auth } from '@/lib/firebase';\r\nimport { \r\n  collection, \r\n  doc, \r\n  getDocs, \r\n  setDoc, \r\n  query,\r\n  where,\r\n  writeBatch,\r\n  getDoc,\r\n  serverTimestamp,\r\n  Timestamp,\r\n} from 'firebase/firestore';\r\nimport { Squad, Fleet, Counter, ChangeRecord } from '@/types';\r\nimport { squadValidators } from '@/lib/validators';\r\nimport { SyncLock } from '@/components/Utils/SyncUtils';\r\n\r\nexport class FirebaseService {\r\n  private static async checkOnline(): Promise<boolean> {\r\n    return navigator.onLine;\r\n  }\r\n\r\n  private static async handleOperation<T>(\r\n    operation: () => Promise<T>,\r\n    errorMessage: string\r\n  ): Promise<T> {\r\n    const isOnline = await this.checkOnline();\r\n    if (!isOnline) {\r\n      throw new Error('Operation cannot be performed while offline');\r\n    }\r\n\r\n    try {\r\n      return await operation();\r\n    } catch (error) {\r\n      console.error(`${errorMessage}:`, error);\r\n      throw new Error(errorMessage);\r\n    }\r\n  }\r\n\r\n  // Helper för att rensa data innan det sparas till Firestore\r\n  private static cleanDataForFirestore(obj: any): any {\r\n    console.log('cleanDataForFirestore called with:', {\r\n      type: typeof obj,\r\n      isArray: Array.isArray(obj),\r\n      value: obj\r\n    });\r\n\r\n    if (obj === null || obj === undefined) {\r\n      return null;\r\n    }\r\n\r\n    // Specialhantering för arrays - behåll dem även om de är tomma\r\n    if (Array.isArray(obj)) {\r\n      console.log('Processing array with length:', obj.length);\r\n      return obj.map(item => this.cleanDataForFirestore(item));\r\n    }\r\n\r\n    // Hantering av objekt\r\n    if (typeof obj === 'object') {\r\n      console.log('Processing object with keys:', Object.keys(obj));\r\n      const cleanedObj: any = {};\r\n      \r\n      for (const [key, value] of Object.entries(obj)) {\r\n        console.log(`Processing key \"${key}\":`, {\r\n          type: typeof value,\r\n          isArray: Array.isArray(value),\r\n          hasValue: value !== null && value !== undefined\r\n        });\r\n\r\n        const cleanedValue = this.cleanDataForFirestore(value);\r\n        \r\n        // Behåll viktiga fält även om de är tomma\r\n        const isImportantField = [\r\n          'characters',\r\n          'leader',\r\n          'startingLineup',\r\n          'reinforcements',\r\n          'capitalShip'\r\n        ].includes(key);\r\n\r\n        if (cleanedValue !== null || isImportantField) {\r\n          cleanedObj[key] = cleanedValue;\r\n          console.log(`Saved value for \"${key}\":`, cleanedValue);\r\n        }\r\n      }\r\n      \r\n      return cleanedObj;\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  // Loggar ändringar\r\n  private static async logChange(change: Omit<ChangeRecord, 'id' | 'timestamp'> & { userId: string }): Promise<void> {\r\n    try {\r\n      const changeRef = doc(collection(db, 'changes'));\r\n      const changeData = {\r\n        ...change,\r\n        id: changeRef.id,\r\n        timestamp: serverTimestamp(),\r\n        changes: {\r\n          ...change.changes,\r\n          [change.entityType]: {\r\n            old: change.changes[change.entityType]?.old || null,\r\n            new: change.changes[change.entityType]?.new || null\r\n          }\r\n        }\r\n      };\r\n\r\n      await setDoc(changeRef, changeData);\r\n    } catch (error) {\r\n      console.error('Error logging change:', error);\r\n    }\r\n  }\r\n\r\n  static async deleteSquad(squadId: string): Promise<void> {\r\n    try {\r\n      const batch = writeBatch(db);\r\n      const userId = await this.getCurrentUserId();\r\n      \r\n      // Ta bort squad\r\n      const squadRef = doc(db, 'squads', squadId);\r\n      const squadDoc = await getDoc(squadRef);\r\n      if (!squadDoc.exists()) {\r\n        throw new Error('Squad not found');\r\n      }\r\n\r\n      batch.delete(squadRef);\r\n\r\n      // Ta bort relaterade counters\r\n      const countersQuery = query(\r\n        collection(db, 'counters'),\r\n        where('targetSquad.id', '==', squadId)\r\n      );\r\n      const countersSnapshot = await getDocs(countersQuery);\r\n      countersSnapshot.docs.forEach(doc => {\r\n        batch.delete(doc.ref);\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      await this.logChange({\r\n        entityId: squadId,\r\n        entityType: 'squad',\r\n        changeType: 'delete',\r\n        userId,\r\n        changes: {\r\n          squad: { old: squadDoc.data(), new: null }\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting squad:', error);\r\n      throw new Error('Failed to delete squad');\r\n    }\r\n  }\r\n\r\n  static async addOrUpdateSquad(squad: Squad): Promise<void> {\r\n    return SyncLock.withLock('squad-sync', async () => {\r\n      return this.handleOperation(\r\n        async () => {\r\n          const validation = squadValidators.validateCompleteSquad(squad);\r\n          if (!validation.isValid) {\r\n            throw new Error(validation.error || 'Invalid squad data');\r\n          }\r\n  \r\n          const userId = await this.getCurrentUserId();\r\n          const isUpdate = await this.documentExists('squads', squad.id);\r\n          const now = Date.now(); // Använd millisekundstidsstämpel\r\n  \r\n          // Om det är en ny squad, sätt createdAt till nuvarande tid\r\n          const normalizedSquad = {\r\n            ...squad,\r\n            lastUpdated: now, // Använd nuvarande tidpunkt för lastUpdated\r\n            createdAt: isUpdate ? squad.createdAt : now, // Sätt createdAt till nu om det är en ny post\r\n            updatedBy: userId,\r\n            type: 'squad' // Säkerställ att type alltid är satt\r\n          };\r\n  \r\n          // Om createdAt är undefined (vilket skulle kunna hända för en uppdatering), ta bort den från dataobjektet\r\n          if (normalizedSquad.createdAt === undefined) {\r\n            delete normalizedSquad.createdAt;\r\n          }\r\n  \r\n          const docRef = doc(db, 'squads', squad.id);\r\n          // Här kan vi använda merge för att uppdatera dokumentet utan att skriva över hela dokumentet\r\n          await setDoc(docRef, normalizedSquad, { merge: true });\r\n  \r\n          // Logga för att verifiera data\r\n          console.log('Saving squad with timestamps:', normalizedSquad);\r\n        },\r\n        'Failed to save squad'\r\n      );\r\n    });\r\n  }  \r\n  \r\n  private static validateFleetData(fleet: Fleet): boolean {\r\n    const hasValidShips = fleet.startingLineup?.every(ship => \r\n      ship.id && ship.name && ship.alignment\r\n    );\r\n    \r\n    const hasValidCapital = !fleet.capitalShip || (\r\n      fleet.capitalShip.id && \r\n      fleet.capitalShip.name && \r\n      fleet.capitalShip.alignment\r\n    );\r\n\r\n    return Boolean(\r\n      fleet.id &&\r\n      fleet.name &&\r\n      fleet.alignment &&\r\n      hasValidShips &&\r\n      hasValidCapital\r\n    );\r\n  }\r\n\r\n  static async addOrUpdateFleet(fleet: Fleet): Promise<void> {\r\n    return SyncLock.withLock('fleet-sync', async () => {\r\n      return this.handleOperation(\r\n        async () => {\r\n          if (!this.validateFleetData(fleet)) {\r\n            throw new Error('Invalid fleet data structure');\r\n          }\r\n  \r\n          const userId = await this.getCurrentUserId();\r\n          const isUpdate = await this.documentExists('fleets', fleet.id);\r\n          const now = Date.now(); // Använd timestamp i millisekunder\r\n          \r\n          const normalizedFleet = {\r\n            ...fleet,\r\n            lastUpdated: now,\r\n            createdAt: isUpdate ? (fleet.createdAt || now) : now,\r\n            updatedBy: userId,\r\n            type: 'fleet'\r\n          };\r\n  \r\n          const docRef = doc(db, 'fleets', fleet.id);\r\n          await setDoc(docRef, normalizedFleet, { merge: true });\r\n  \r\n          // Logga för att verifiera data\r\n          console.log('Saving fleet with timestamps:', normalizedFleet);\r\n        },\r\n        'Failed to save fleet'\r\n      );\r\n    });\r\n  }\r\n\r\n  static async deleteFleet(fleetId: string): Promise<void> {\r\n    try {\r\n      const batch = writeBatch(db);\r\n      const userId = await this.getCurrentUserId();\r\n      \r\n      // Ta bort fleet\r\n      const fleetRef = doc(db, 'fleets', fleetId);\r\n      const fleetDoc = await getDoc(fleetRef);\r\n      if (!fleetDoc.exists()) {\r\n        throw new Error('Fleet not found');\r\n      }\r\n\r\n      batch.delete(fleetRef);\r\n\r\n      // Ta bort relaterade counters\r\n      const countersQuery = query(\r\n        collection(db, 'counters'),\r\n        where('targetSquad.id', '==', fleetId)\r\n      );\r\n      const countersSnapshot = await getDocs(countersQuery);\r\n      countersSnapshot.docs.forEach(doc => {\r\n        batch.delete(doc.ref);\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      await this.logChange({\r\n        entityId: fleetId,\r\n        entityType: 'fleet',\r\n        changeType: 'delete',\r\n        userId,\r\n        changes: {\r\n          fleet: { old: fleetDoc.data(), new: null }\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting fleet:', error);\r\n      throw new Error('Failed to delete fleet');\r\n    }\r\n  }\r\n\r\n  // Counter operations\r\n  static async addOrUpdateCounter(counter: Counter): Promise<Counter> {\r\n    return SyncLock.withLock('counter-sync', async () => {\r\n      return this.handleOperation(\r\n        async () => {\r\n          const counterId = counter.id || `counter-${Date.now()}`;\r\n          const isUpdate = await this.documentExists('counters', counterId);\r\n          const timestamp = serverTimestamp();\r\n          const userId = await this.getCurrentUserId();\r\n          \r\n          const counterWithId = { \r\n            ...counter, \r\n            id: counterId,\r\n            lastUpdated: timestamp,\r\n            createdAt: isUpdate ? undefined : timestamp,\r\n            updatedBy: userId\r\n          };\r\n          \r\n          const docRef = doc(db, 'counters', counterId);\r\n          await setDoc(docRef, this.cleanDataForFirestore(counterWithId));\r\n\r\n          return counterWithId;\r\n        },\r\n        'Failed to save counter'\r\n      );\r\n    });\r\n  }\r\n\r\n\r\n// In firebaseService.ts - Update deleteCounter method\r\nstatic async deleteCounter(counterId: string): Promise<void> {\r\n  return this.handleOperation(\r\n    async () => {\r\n      console.log('Starting delete operation for counter:', counterId);\r\n      \r\n      // First check if counter exists\r\n      const counterRef = doc(db, 'counters', counterId);\r\n      const counterDoc = await getDoc(counterRef);\r\n      \r\n      if (!counterDoc.exists()) {\r\n        // Instead of throwing error, return success since the end goal (counter not existing) is achieved\r\n        console.log(`Counter ${counterId} already deleted or doesn't exist`);\r\n        return;\r\n      }\r\n\r\n      const counterData = counterDoc.data();\r\n      console.log('Found counter data:', counterData);\r\n\r\n      const batch = writeBatch(db);\r\n      \r\n      // Delete counter\r\n      batch.delete(counterRef);\r\n\r\n      // Create change log\r\n      const changeRef = doc(collection(db, 'changes'));\r\n      const userId = await this.getCurrentUserId();\r\n      \r\n      batch.set(changeRef, {\r\n        id: changeRef.id,\r\n        entityId: counterId,\r\n        entityType: 'counter',\r\n        changeType: 'delete',\r\n        userId,\r\n        timestamp: serverTimestamp(),\r\n        changes: {\r\n          counter: {\r\n            old: counterData,\r\n            new: null\r\n          }\r\n        }\r\n      });\r\n\r\n      // Commit batch\r\n      await batch.commit();\r\n      console.log('Successfully deleted counter and created change log');\r\n    },\r\n    'Failed to delete counter'\r\n  );\r\n}\r\n\r\n  // Fetch operations\r\n  static async getFleets(): Promise<Fleet[]> {\r\n    try {\r\n      const querySnapshot = await getDocs(collection(db, 'fleets'));\r\n      return querySnapshot.docs.map(doc => {\r\n        const data = doc.data();\r\n        console.log('Raw fleet data before processing:', data);\r\n        \r\n        // Säker hantering av timestamps\r\n        let processedData: Partial<Fleet> = {\r\n          ...data,\r\n          id: doc.id,\r\n        };\r\n  \r\n        // Försök konvertera timestamps om de finns\r\n        try {\r\n          if (data.createdAt) {\r\n            if (data.createdAt instanceof Timestamp) { // Om det är ett Firestore Timestamp\r\n              processedData.createdAt = data.createdAt.toDate().toISOString();\r\n            } else if (typeof data.createdAt === 'number') { // Om det är en millisekundstidsstämpel\r\n              processedData.createdAt = new Date(data.createdAt).toISOString();\r\n            }\r\n          }\r\n  \r\n          if (data.lastUpdated) {\r\n            if (data.lastUpdated instanceof Timestamp) { // Om det är ett Firestore Timestamp\r\n              processedData.lastUpdated = data.lastUpdated.toDate().toISOString();\r\n            } else if (typeof data.lastUpdated === 'number') { // Om det är en millisekundstidsstämpel\r\n              processedData.lastUpdated = new Date(data.lastUpdated).toISOString();\r\n            }\r\n          }\r\n        } catch (timestampError) {\r\n          console.warn('Error processing timestamps:', timestampError);\r\n        }\r\n  \r\n        console.log('Processed fleet data:', processedData);\r\n        return processedData as Fleet;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error getting fleets:', error);\r\n      throw new Error('Failed to get fleets');\r\n    }\r\n  }\r\n  \r\n  static async getSquads(): Promise<Squad[]> {\r\n    try {\r\n      const querySnapshot = await getDocs(collection(db, 'squads'));\r\n      if (querySnapshot.empty) {\r\n        console.warn('No squads found');\r\n        return [];\r\n      }\r\n  \r\n      return querySnapshot.docs.map(doc => {\r\n        const data = doc.data();\r\n        console.log('Raw squad data before processing:', data);\r\n  \r\n        // Säker hantering av timestamps\r\n        let processedData: Partial<Squad> = {\r\n          ...data,\r\n          id: doc.id,\r\n        };\r\n  \r\n        // Försök konvertera timestamps om de finns\r\n        try {\r\n          if (data.createdAt) {\r\n            if (data.createdAt instanceof Timestamp) { // Om det är ett Firestore Timestamp\r\n              processedData.createdAt = data.createdAt.toDate().toISOString();\r\n            } else if (typeof data.createdAt === 'number') { // Om det är en millisekundstidsstämpel\r\n              processedData.createdAt = new Date(data.createdAt).toISOString();\r\n            }\r\n          }\r\n  \r\n          if (data.lastUpdated) {\r\n            if (data.lastUpdated instanceof Timestamp) { // Om det är ett Firestore Timestamp\r\n              processedData.lastUpdated = data.lastUpdated.toDate().toISOString();\r\n            } else if (typeof data.lastUpdated === 'number') { // Om det är en millisekundstidsstämpel\r\n              processedData.lastUpdated = new Date(data.lastUpdated).toISOString();\r\n            }\r\n          }\r\n        } catch (timestampError) {\r\n          console.warn('Error processing timestamps:', timestampError);\r\n        }\r\n  \r\n        console.log('Processed squad data:', processedData);\r\n        return processedData as Squad;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error getting squads:', error);\r\n      throw new Error('Failed to get squads');\r\n    }\r\n  }\r\n\r\nstatic async getCounters(): Promise<Counter[]> {\r\n  try {\r\n    const querySnapshot = await getDocs(collection(db, 'counters'));\r\n    return querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    })) as Counter[];\r\n  } catch (error) {\r\n    console.error('Error getting counters:', error);\r\n    throw new Error('Failed to get counters');\r\n  }\r\n}\r\n\r\n  // Helper method för att kolla om dokument existerar\r\n  private static async documentExists(collectionName: string, id: string): Promise<boolean> {\r\n    const docRef = doc(db, collectionName, id);\r\n    const docSnap = await getDoc(docRef);\r\n    return docSnap.exists();\r\n  }\r\n\r\n  // Synkronisera alla data\r\n  static async syncAllData() {\r\n    try {\r\n      const [squads, fleets, counters] = await Promise.all([\r\n        this.getSquads(),\r\n        this.getFleets(),\r\n        this.getCounters()\r\n      ]);\r\n\r\n      return {\r\n        squads,\r\n        fleets,\r\n        counters,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      console.error('Error syncing data:', error);\r\n      throw new Error('Failed to sync data');\r\n    }\r\n  }\r\n\r\n  private static async getCurrentUserId(): Promise<string> {\r\n    const user = auth.currentUser;\r\n    if (!user) {\r\n      throw new Error('No authenticated user');\r\n    }\r\n    return user.uid;\r\n  }\r\n}","// src/components/ui/LoadingIndicator.tsx\r\nimport { motion } from 'framer-motion';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface LoadingIndicatorProps {\r\n  size?: 'sm' | 'md' | 'lg';\r\n  variant?: 'default' | 'light' | 'dark';\r\n  message?: string;\r\n  className?: string;\r\n}\r\n\r\nconst SIZE_CLASSES = {\r\n  sm: 'w-8 h-8',   // 32x32px\r\n  md: 'w-12 h-12', // 48x48px\r\n  lg: 'w-16 h-16'  // 64x64px\r\n};\r\n\r\nexport const LoadingIndicator = ({ \r\n  size = 'md',\r\n  variant = 'default',\r\n  message,\r\n  className = ''\r\n}: LoadingIndicatorProps) => {\r\n  const variants = {\r\n    default: 'border-blue-400',\r\n    light: 'border-white/40',\r\n    dark: 'border-gray-600'\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center\">\r\n      <motion.div\r\n        className={cn(\r\n          'border-2 border-t-transparent rounded-full',\r\n          SIZE_CLASSES[size],\r\n          variants[variant],\r\n          className\r\n        )}\r\n        animate={{ rotate: 360 }}\r\n        transition={{\r\n          duration: 1,\r\n          repeat: Infinity,\r\n          ease: \"linear\"\r\n        }}\r\n      />\r\n      {message && (\r\n        <p className=\"mt-4 text-white/60\">{message}</p>\r\n      )}\r\n    </div>\r\n  );\r\n};","import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { auth, db, storage, ensureFirebaseInitialized } from '@/lib/firebase';\r\nimport { LoadingIndicator } from '@/components/ui/LoadingIndicator';\r\nimport { FirebaseService } from '@/services/firebaseService';\r\nimport { Auth } from 'firebase/auth';\r\nimport { Firestore } from 'firebase/firestore';\r\nimport { FirebaseStorage } from 'firebase/storage'; \r\n\r\ninterface FirebaseContextType {\r\n  isInitialized: boolean;\r\n  isOnline: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  retry: () => Promise<void>;\r\n}\r\n\r\nconst FirebaseContext = createContext<FirebaseContextType | null>(null);\r\n\r\nexport class FirebaseClient {\r\n  private _auth: Auth;\r\n  private _db: Firestore;\r\n  private _storage: FirebaseStorage;\r\n  private static instance: FirebaseClient;\r\n\r\n  private constructor() {\r\n    this._auth = auth;\r\n    this._db = db;\r\n    this._storage = storage;\r\n  }\r\n\r\n  public static getInstance(): FirebaseClient {\r\n    if (!FirebaseClient.instance) {\r\n      FirebaseClient.instance = new FirebaseClient();\r\n    }\r\n    return FirebaseClient.instance;\r\n  }\r\n\r\n  get auth() { return this._auth; }\r\n  get db() { return this._db; }\r\n  get storage() { return this._storage; }\r\n}\r\n\r\n// Create singleton instance\r\nexport const firebaseClient = FirebaseClient.getInstance();\r\n\r\nexport function FirebaseProvider({ children }: { children: React.ReactNode }) {\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [retryCount, setRetryCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        try {\r\n          await ensureFirebaseInitialized();\r\n          \r\n          const firestoreTimeout = new Promise((_, reject) => {\r\n            setTimeout(() => reject(new Error('Firestore connection timeout')), 10000);\r\n          });\r\n          \r\n          await Promise.race([\r\n            FirebaseService.syncAllData(),\r\n            firestoreTimeout\r\n          ]);\r\n          \r\n          setIsInitialized(true);\r\n        } catch (error) {\r\n          console.error('Firebase initialization error:', error);\r\n          setError(error instanceof Error ? error.message : 'Failed to initialize Firebase');\r\n        }\r\n      } catch (err) {\r\n        console.error('Error in initialize:', err);\r\n        setError(err instanceof Error ? err.message : 'Unknown error occurred');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    initialize();\r\n  }, [retryCount]);\r\n\r\n  // Monitor online/offline status\r\n  useEffect(() => {\r\n    const handleOnline = () => {\r\n      setIsOnline(true);\r\n      syncQueuedChanges();\r\n    };\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  const retry = async () => {\r\n    setRetryCount(prev => prev + 1);\r\n  };\r\n\r\n  // Implement the syncQueuedChanges function\r\n  const syncQueuedChanges = () => {\r\n    // Logic to sync changes when back online\r\n  };\r\n\r\n  // If we're not initialized and not in error state, show loading\r\n  if (isLoading && !error) {\r\n    return (\r\n      <div className=\"fixed inset-0 flex items-center justify-center bg-space-darker\">\r\n        <div className=\"text-center\">\r\n          <LoadingIndicator size=\"lg\" className=\"mb-4\" />\r\n          <p className=\"text-white/60\">Initializing...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If we have an error, show error state with retry button\r\n  if (error) {\r\n    return (\r\n      <div className=\"fixed inset-0 flex items-center justify-center bg-space-darker\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-400 text-xl mb-4\">{error}</div>\r\n          <button\r\n            onClick={retry}\r\n            className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <FirebaseContext.Provider\r\n      value={{\r\n        isInitialized,\r\n        isOnline,\r\n        isLoading,\r\n        error,\r\n        retry\r\n      }}\r\n    >\r\n      <div className=\"relative\">\r\n        {!isOnline && (\r\n          <div className=\"sticky top-0 bg-yellow-500/90 text-black py-2 px-4 text-center z-50\">\r\n            You are currently offline. Changes will be synced when you reconnect.\r\n          </div>\r\n        )}\r\n        {children}\r\n      </div>\r\n    </FirebaseContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useFirebase() {\r\n  const context = useContext(FirebaseContext);\r\n  if (!context) {\r\n    throw new Error('useFirebase must be used within a FirebaseProvider');\r\n  }\r\n  return context;\r\n}","import { Squad, Fleet, Counter } from '@/types';\r\nimport { SyncQueue, DebounceSync } from '@/components/Utils/SyncUtils';\r\nimport { FirebaseService } from './firebaseService';\r\n\r\nconst STORAGE_KEYS = {\r\n  SQUADS: 'swgoh-tw-squads',\r\n  FLEETS: 'swgoh-tw-fleets',\r\n  COUNTERS: 'swgoh-tw-counters',\r\n  VERSION: '1.0.0'\r\n} as const;\r\n\r\nclass StorageService {\r\n  private validateData<T>(data: T[]): boolean {\r\n    return Array.isArray(data) && data.every(item => typeof item === 'object' && item !== null);\r\n  }\r\n\r\n  private async saveData<T>(key: string, data: T[]): Promise<void> {\r\n    try {\r\n      console.log(`Saving data to ${key}:`, data);\r\n      \r\n      if (!this.validateData(data)) {\r\n        throw new Error('Invalid data format');\r\n      }\r\n\r\n      const storageData = {\r\n        data,\r\n        version: STORAGE_KEYS.VERSION,\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n\r\n      localStorage.setItem(key, JSON.stringify(storageData));\r\n      console.log(`Data saved successfully to ${key}`);\r\n    } catch (error) {\r\n      console.error(`Error saving ${key}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private getData<T>(key: string, defaultValue: T[] = []): T[] {\r\n    try {\r\n      console.log(`Getting data from ${key}`);\r\n      \r\n      const stored = localStorage.getItem(key);\r\n      if (!stored) {\r\n        console.log(`No data found in ${key}, using default value`);\r\n        return defaultValue;\r\n      }\r\n\r\n      const parsed = JSON.parse(stored);\r\n      \r\n      if (Array.isArray(parsed)) {\r\n        console.log(`Found legacy data format in ${key}`);\r\n        return parsed;\r\n      }\r\n\r\n      if (parsed.data && Array.isArray(parsed.data)) {\r\n        console.log(`Found data in ${key}:`, parsed.data);\r\n        return parsed.data;\r\n      }\r\n\r\n      console.log(`Invalid data format in ${key}, using default value`);\r\n      return defaultValue;\r\n    } catch (error) {\r\n      console.error(`Error getting ${key}:`, error);\r\n      return defaultValue;\r\n    }\r\n  }\r\n\r\n  // Updated Squad methods\r\n  public async saveSquads(squads: Squad[]): Promise<void> {\r\n    DebounceSync.schedule('save-squads', async () => {\r\n      await this.saveData(STORAGE_KEYS.SQUADS, squads);\r\n      await FirebaseService.addOrUpdateSquad(squads[squads.length - 1]);\r\n    });\r\n  }\r\n\r\n  public getSquads(): Squad[] {\r\n    return this.getData<Squad>(STORAGE_KEYS.SQUADS, []);\r\n  }\r\n\r\n  // Updated Fleet methods\r\n  public async saveFleets(fleets: Fleet[]): Promise<void> {\r\n    DebounceSync.schedule('save-fleets', async () => {\r\n      await this.saveData(STORAGE_KEYS.FLEETS, fleets);\r\n      await FirebaseService.addOrUpdateFleet(fleets[fleets.length - 1]);\r\n    });\r\n  }\r\n\r\n  public getFleets(): Fleet[] {\r\n    return this.getData<Fleet>(STORAGE_KEYS.FLEETS, []);\r\n  }\r\n\r\n  // Updated Counter methods\r\n  public async saveCounters(counters: Counter[]): Promise<void> {\r\n    DebounceSync.schedule('save-counters', async () => {\r\n      await this.saveData(STORAGE_KEYS.COUNTERS, counters);\r\n      if (counters.length > 0) {\r\n        await FirebaseService.addOrUpdateCounter(counters[counters.length - 1]);\r\n      }\r\n    });\r\n  }\r\n\r\n  public getCounters(): Counter[] {\r\n    return this.getData<Counter>(STORAGE_KEYS.COUNTERS, []);\r\n  }\r\n\r\n  // Updated clearAllData method\r\n  public async clearAllData(): Promise<void> {\r\n    await SyncQueue.add('clear-all', async () => {\r\n      try {\r\n        console.log('Clearing all data');\r\n        localStorage.removeItem(STORAGE_KEYS.SQUADS);\r\n        localStorage.removeItem(STORAGE_KEYS.FLEETS);\r\n        localStorage.removeItem(STORAGE_KEYS.COUNTERS);\r\n        console.log('All data cleared successfully');\r\n      } catch (error) {\r\n        console.error('Error clearing data:', error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n// Create and export a single instance\r\nexport const storage = new StorageService();\r\n\r\n// Export the class for type usage\r\nexport type { StorageService };","import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { \r\n  signInWithEmailAndPassword,\r\n  signOut,\r\n  onAuthStateChanged,\r\n  User,\r\n  AuthError\r\n} from 'firebase/auth';\r\nimport { auth, db } from '@/lib/firebase';\r\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\r\nimport { storage } from '@/services/storage';\r\n\r\ninterface AuthContextType {\r\n  currentUser: User | null;\r\n  isAdmin: boolean;\r\n  isMasterAdmin: boolean;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  logout: () => Promise<void>;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | null>(null);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\r\n  const [isAdmin, setIsAdmin] = useState(false);\r\n  const [isMasterAdmin, setIsMasterAdmin] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n      try {\r\n        if (user) {\r\n          const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n          const userData = userDoc.data();\r\n          setIsAdmin(userData?.isAdmin || false);\r\n          setIsMasterAdmin(userData?.isMasterAdmin || false);\r\n          setCurrentUser(user);\r\n        } else {\r\n          setCurrentUser(null);\r\n          setIsAdmin(false);\r\n          setIsMasterAdmin(false);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error checking admin status:', error);\r\n        setError('Failed to verify admin status');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  // Lägg till online/offline monitoring\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  const login = async (email: string, password: string) => {\r\n    if (!isOnline) {\r\n      throw new Error('Cannot login while offline');\r\n    }\r\n\r\n    try {\r\n      setError(null);\r\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n      \r\n      // Skapa eller uppdatera användardokumentet\r\n      const userRef = doc(db, 'users', userCredential.user.uid);\r\n      const userDoc = await getDoc(userRef);\r\n      \r\n      if (!userDoc.exists()) {\r\n        // Skapa nytt användardokument för första inloggningen\r\n        await setDoc(userRef, {\r\n          email: userCredential.user.email,\r\n          isAdmin: false,\r\n          isMasterAdmin: false,\r\n          createdAt: new Date().toISOString(),\r\n          lastLogin: new Date().toISOString()\r\n        });\r\n      } else {\r\n        // Uppdatera senaste inloggning\r\n        await setDoc(userRef, {\r\n          lastLogin: new Date().toISOString()\r\n        }, { merge: true });\r\n      }\r\n\r\n      // Verifiera admin-status\r\n      const updatedDoc = await getDoc(userRef);\r\n      const userData = updatedDoc.data();\r\n      \r\n      if (!userData?.isAdmin && !userData?.isMasterAdmin) {\r\n        await signOut(auth);\r\n        throw new Error('Unauthorized access - not an admin user');\r\n      }\r\n    } catch (error) {\r\n      const authError = error as AuthError;\r\n      console.error('Login error:', authError);\r\n      \r\n      let errorMessage = 'Failed to login. Please try again.';\r\n      if (authError.code === 'auth/user-not-found' || authError.code === 'auth/wrong-password') {\r\n        errorMessage = 'Invalid email or password';\r\n      } else if (authError.code === 'auth/too-many-requests') {\r\n        errorMessage = 'Too many failed attempts. Please try again later.';\r\n      }\r\n      \r\n      setError(errorMessage);\r\n      throw new Error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    if (!isOnline) {\r\n      throw new Error('Cannot logout while offline');\r\n    }\r\n\r\n    try {\r\n      await signOut(auth);\r\n      setCurrentUser(null);\r\n      setIsAdmin(false);\r\n      setIsMasterAdmin(false);\r\n      \r\n      // Rensa localStorage vid utloggning\r\n      storage.clearAllData();\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n      setError('Failed to logout');\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    currentUser,\r\n    isAdmin,\r\n    isMasterAdmin,\r\n    login,\r\n    logout,\r\n    loading,\r\n    error\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}","// Först skapar vi en återanvändbar AlignmentDropdown-komponent\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface AlignmentDropdownProps {\r\n  value: 'light' | 'dark';\r\n  onChange: (value: 'light' | 'dark') => void;\r\n  label?: boolean;\r\n}\r\n\r\nexport const AlignmentDropdown: React.FC<AlignmentDropdownProps> = ({\r\n  value,\r\n  onChange,\r\n  label = true\r\n}) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  const handleClick = () => {\r\n    setIsOpen(!isOpen);\r\n  };\r\n\r\n  const handleSelect = (newValue: 'light' | 'dark') => {\r\n    onChange(newValue);\r\n    setIsOpen(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {label && (\r\n        <label className=\"block text-sm font-medium text-white mb-2\">\r\n          Alignment\r\n        </label>\r\n      )}\r\n      <button\r\n        type=\"button\"\r\n        onClick={handleClick}\r\n        className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-left flex justify-between items-center\"\r\n      >\r\n        <span>{value === 'light' ? 'Light Side' : 'Dark Side'}</span>\r\n        <svg\r\n          className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n        </svg>\r\n      </button>\r\n      \r\n      {isOpen && (\r\n        <div className=\"absolute left-0 right-0 mt-1 bg-space-darker border border-white/10 rounded-lg shadow-lg z-[60]\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => handleSelect('light')}\r\n            className=\"w-full px-3 py-2 text-white hover:bg-white/5 text-left first:rounded-t-lg\"\r\n          >\r\n            Light Side\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => handleSelect('dark')}\r\n            className=\"w-full px-3 py-2 text-white hover:bg-white/5 text-left last:rounded-b-lg\"\r\n          >\r\n            Dark Side\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};","import React, { useState, useMemo, useCallback } from 'react';\r\nimport { Search, X, Shield } from 'lucide-react';\r\nimport { Character } from '@/types';\r\nimport { UnitImage } from '../ui/UnitImage';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface CharacterSelectorProps {\r\n  leader: Character | null;\r\n  members: Character[];\r\n  onAddUnit: (unit: Character, isLeader: boolean) => void;\r\n  onRemoveUnit: (unitId: string, isLeader: boolean) => void;\r\n  alignment: 'light' | 'dark';\r\n  showLeaderSelection?: boolean;\r\n  availableUnits: Character[];\r\n}\r\n\r\nexport const CharacterSelector: React.FC<CharacterSelectorProps> = ({\r\n  leader,\r\n  members,\r\n  onAddUnit,\r\n  onRemoveUnit,\r\n  alignment,\r\n  showLeaderSelection = true,\r\n  availableUnits\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showSearch, setShowSearch] = useState(false);\r\n\r\n  const handleSelectCharacter = useCallback((\r\n    e: React.MouseEvent,\r\n    character: Character, \r\n    isLeader: boolean\r\n  ) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    const normalizedCharacter = {\r\n      id: character.id,\r\n      name: character.name,\r\n      role: character.role || '',\r\n      alignment: character.alignment,\r\n      isGalacticLegend: character.isGalacticLegend || false\r\n    };\r\n  \r\n    onAddUnit(normalizedCharacter, isLeader);\r\n    setShowSearch(false);\r\n  }, [onAddUnit]);\r\n\r\n  const handleSearchClick = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setShowSearch(true);\r\n  };\r\n\r\n  const filteredCharacters = useMemo(() => {\r\n    const searchLower = searchTerm.toLowerCase();\r\n    const selectedIds = new Set([leader?.id, ...members.map(m => m.id)]);\r\n\r\n    return availableUnits.filter(char => {\r\n      const matchesSearch = !searchTerm || char.name.toLowerCase().includes(searchLower);\r\n      const isNotSelected = !selectedIds.has(char.id);\r\n      const matchesAlignment = char.alignment === alignment;\r\n      \r\n      return matchesSearch && isNotSelected && matchesAlignment;\r\n    });\r\n  }, [searchTerm, availableUnits, leader, members, alignment]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\" onClick={(e) => e.stopPropagation()}>\r\n      {/* Search Bar */}\r\n      <div className=\"relative\">\r\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40\" />\r\n        <input\r\n          type=\"text\"\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setShowSearch(true);\r\n          }}\r\n          className=\"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg \r\n                   text-white placeholder-white/40\"\r\n          placeholder=\"Search characters...\"\r\n        />\r\n\r\n        {showSearch && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"absolute z-50 w-full mt-2 bg-gray-900 border border-white/10 \r\n                     rounded-lg shadow-lg max-h-64 overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex justify-between items-center p-2 border-b border-white/10\">\r\n              <span className=\"text-sm text-white/60\">Select Character</span>\r\n              <button\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setShowSearch(false);\r\n                }}\r\n                className=\"p-1 hover:bg-white/10 rounded\"\r\n              >\r\n                <X className=\"w-4 h-4 text-white/60\" />\r\n              </button>\r\n            </div>\r\n            \r\n            {filteredCharacters.length > 0 ? (\r\n              filteredCharacters.map((char) => (\r\n                <div\r\n                  key={char.id}\r\n                  className=\"p-3 hover:bg-white/5 transition-colors\"\r\n                  onClick={(e) => e.stopPropagation()}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <UnitImage\r\n                        id={char.id}\r\n                        name={char.name}\r\n                        type={!leader && showLeaderSelection ? 'squad-leader' : 'squad-member'}\r\n                        size=\"sm\"\r\n                        className=\"rounded-full border-2 border-white/20\"\r\n                      />\r\n                      <div>\r\n                        <div className=\"text-white\">{char.name}</div>\r\n                        <div className=\"text-sm text-white/60\">{char.role}</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      {showLeaderSelection && !leader && (\r\n                        <button\r\n                          onClick={(e) => handleSelectCharacter(e, char, true)}\r\n                          className=\"px-3 py-1 text-sm rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30\"\r\n                        >\r\n                          Set as Leader\r\n                        </button>\r\n                      )}\r\n                      {members.length < 4 && (\r\n                        <button\r\n                          onClick={(e) => handleSelectCharacter(e, char, false)}\r\n                          className=\"px-3 py-1 text-sm rounded-md bg-white/10 text-white hover:bg-white/20\"\r\n                        >\r\n                          Add Member\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <div className=\"p-3 text-white/60 text-center\">\r\n                No matching characters found\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Selected Characters Display */}\r\n      <div className=\"space-y-4\">\r\n        {/* Leader */}\r\n        <div>\r\n          <h3 className=\"text-sm font-medium text-white/60 mb-2 flex items-center gap-2\">\r\n            <Shield className=\"w-4 h-4\" />\r\n            Leader\r\n          </h3>\r\n          <div className=\"relative group inline-block\">\r\n            {leader ? (\r\n              <div className=\"relative\">\r\n                <UnitImage\r\n                  id={leader.id}\r\n                  name={leader.name}\r\n                  type=\"squad-leader\"\r\n                  size=\"md\"\r\n                  className=\"rounded-full border-2 border-blue-400\"\r\n                />\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    onRemoveUnit(leader.id, true);\r\n                  }}\r\n                  className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full \r\n                           flex items-center justify-center opacity-0 group-hover:opacity-100 \r\n                           transition-opacity\"\r\n                >\r\n                  <X className=\"w-3 h-3 text-white\" />\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <button\r\n                onClick={handleSearchClick}\r\n                className=\"w-12 h-12 rounded-full border-2 border-dashed border-blue-400/40 \r\n                         flex items-center justify-center hover:border-blue-400/60 \r\n                         transition-colors\"\r\n              >\r\n                <span className=\"text-blue-400/60\">+</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Squad Members */}\r\n        <div>\r\n          <h3 className=\"text-sm font-medium text-white/60 mb-2\">Squad Members</h3>\r\n          <div className=\"flex flex-wrap gap-4\">\r\n            {members.map((member) => (\r\n              <div key={member.id} className=\"relative group\">\r\n                <UnitImage\r\n                  id={member.id}\r\n                  name={member.name}\r\n                  type=\"squad-member\"\r\n                  size=\"md\"\r\n                  className=\"rounded-full border-2 border-white/20\"\r\n                />\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    onRemoveUnit(member.id, false);\r\n                  }}\r\n                  className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full \r\n                           flex items-center justify-center opacity-0 group-hover:opacity-100 \r\n                           transition-opacity\"\r\n                >\r\n                  <X className=\"w-3 h-3 text-white\" />\r\n                </button>\r\n              </div>\r\n            ))}\r\n            {members.length < 4 && (\r\n              <button\r\n                onClick={handleSearchClick}\r\n                className=\"w-12 h-12 rounded-full border-2 border-dashed border-white/20 \r\n                         flex items-center justify-center hover:border-white/40 \r\n                         transition-colors\"\r\n              >\r\n                <span className=\"text-white/40\">+</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React, { useState } from 'react';\r\nimport { Squad, Character } from '@/types';\r\nimport { AlignmentDropdown } from './AlignmentDropdown';\r\nimport { CharacterSelector } from './CharacterSelector';\r\nimport { normalizeId } from '@/lib/imageMapping';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { AlertTriangle } from 'lucide-react';\r\n\r\ninterface NewSquadFormProps {\r\n  onSave: (squad: Squad) => void;\r\n  onCancel: () => void;\r\n  availableUnits: Character[];\r\n}\r\n\r\nexport const NewSquadForm: React.FC<NewSquadFormProps> = ({ \r\n  onSave, \r\n  onCancel,\r\n  availableUnits \r\n}) => {\r\n  const [name, setName] = useState('');\r\n  const [alignment, setAlignment] = useState<'light' | 'dark'>('light');\r\n  const [leader, setLeader] = useState<Character | null>(null);\r\n  const [members, setMembers] = useState<Character[]>([]);\r\n  const [twOmicronRequired, setTwOmicronRequired] = useState(false);\r\n  const [description, setDescription] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // VIKTIGT: handleSubmit körs ENDAST när användaren klickar på Save\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(null); // Clear previous errors\r\n\r\n    // Validera endast vid explicit Save\r\n    if (!name.trim()) {\r\n      setError('Squad name is required');\r\n      return;\r\n    }\r\n\r\n    if (!leader) {\r\n      setError('Squad must have a leader');\r\n      return;\r\n    }\r\n\r\n    if (members.length === 0) {\r\n      setError('Squad must have at least one member');\r\n      return;\r\n    }\r\n\r\n    // Skapa squad objektet endast när användaren är klar\r\n    const squad: Squad = {\r\n      id: normalizeId(name),\r\n      name: name.trim(),\r\n      type: 'squad',\r\n      alignment,\r\n      leader,\r\n      characters: members,\r\n      description: description.trim() || undefined,\r\n      twOmicronRequired\r\n    };\r\n  \r\n    // Anropa save ENDAST när användaren klickar på Save\r\n    onSave(squad);\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      {error && (\r\n        <Alert variant=\"destructive\">\r\n          <AlertTriangle className=\"w-4 h-4\" />\r\n          <AlertTitle>Error</AlertTitle>\r\n          <AlertDescription>{error}</AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-white mb-2\">\r\n            Squad Name\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n            placeholder=\"Enter squad name\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <AlignmentDropdown\r\n            value={alignment}\r\n            onChange={setAlignment}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <CharacterSelector\r\n        leader={leader}\r\n        members={members}\r\n        onAddUnit={(unit, isLeader) => {\r\n          if (isLeader) setLeader(unit);\r\n          else if (members.length < 4) setMembers(prev => [...prev, unit]); // Limit to 4 members\r\n        }}\r\n        onRemoveUnit={(unitId, isLeader) => {\r\n          if (isLeader) setLeader(null);\r\n          else setMembers(prev => prev.filter(m => m.id !== unitId));\r\n        }}\r\n        alignment={alignment}\r\n        availableUnits={availableUnits}\r\n      />\r\n\r\n      <div className=\"flex items-center\">\r\n        <input\r\n          type=\"checkbox\"\r\n          id=\"twOmicron\"\r\n          checked={twOmicronRequired}\r\n          onChange={(e) => setTwOmicronRequired(e.target.checked)}\r\n          className=\"w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500\"\r\n        />\r\n        <label htmlFor=\"twOmicron\" className=\"ml-2 text-sm text-white\">\r\n          Requires Territory Wars Omicron\r\n        </label>\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-white mb-2\">\r\n          Description (Optional)\r\n        </label>\r\n        <textarea\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none\"\r\n          rows={3}\r\n          placeholder=\"Add any notes or description...\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex justify-end gap-3 pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onCancel}\r\n          className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600\"\r\n        >\r\n          Save Squad\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};","import React, { useState, useMemo, useCallback } from 'react';\r\nimport { Search, X, Anchor } from 'lucide-react';\r\nimport { Ship } from '@/types';\r\nimport { UnitImage } from '../ui/UnitImage';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface ShipSelectorProps {\r\n  capitalShip: Ship | null;\r\n  startingLineup: Ship[];\r\n  reinforcements: Ship[];\r\n  onAddUnit: (ship: Ship, position: 'capital' | 'starting' | 'reinforcement') => void;\r\n  onRemoveUnit: (shipId: string, position: 'capital' | 'starting' | 'reinforcement') => void;\r\n  alignment: 'light' | 'dark';\r\n  availableUnits: Ship[];\r\n  isCounterSelector?: boolean; \r\n}\r\n\r\nexport const ShipSelector: React.FC<ShipSelectorProps> = ({\r\n  capitalShip,\r\n  startingLineup,\r\n  reinforcements,\r\n  onAddUnit,\r\n  onRemoveUnit,\r\n  alignment,\r\n  availableUnits,\r\n  isCounterSelector = false  // Lägg till denna med default värde\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showSearch, setShowSearch] = useState(false);\r\n  const [selectionMode, setSelectionMode] = useState<'capital' | 'starting' | 'reinforcement'>('capital');\r\n\r\n  const handleSelectShip = useCallback((\r\n    e: React.MouseEvent,\r\n    ship: Ship, \r\n    position: 'capital' | 'starting' | 'reinforcement'\r\n  ) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const normalizedShip = {\r\n      id: ship.id,\r\n      name: ship.name,\r\n      type: ship.type,\r\n      isCapital: ship.isCapital,\r\n      alignment: ship.alignment\r\n    };\r\n\r\n    onAddUnit(normalizedShip, position);\r\n    setShowSearch(false);\r\n  }, [onAddUnit]);\r\n\r\n  const handleSearchClick = (e: React.MouseEvent, mode: 'capital' | 'starting' | 'reinforcement') => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setSelectionMode(mode);\r\n    setShowSearch(true);\r\n  };\r\n\r\n  const filteredShips = useMemo(() => {\r\n    const searchLower = searchTerm.toLowerCase();\r\n    const selectedIds = new Set([\r\n        capitalShip?.id,\r\n        ...startingLineup.map(s => s.id),\r\n        ...reinforcements.map(s => s.id)\r\n    ]);\r\n\r\n    return availableUnits.filter(ship => {\r\n        const matchesSearch = !searchTerm || ship.name.toLowerCase().includes(searchLower);\r\n        const isNotSelected = !selectedIds.has(ship.id);\r\n        const matchesAlignment = ship.alignment === alignment;\r\n        \r\n        // Om det är counter selector, skip type checking\r\n        if (isCounterSelector) {\r\n            return matchesSearch && isNotSelected && matchesAlignment;\r\n        }\r\n        \r\n        // Annars behåll original logik för Add Defense\r\n        const matchesType = selectionMode === 'capital' ? ship.isCapital : !ship.isCapital;\r\n        return matchesSearch && isNotSelected && matchesAlignment && matchesType;\r\n    });\r\n}, [searchTerm, availableUnits, capitalShip, startingLineup, reinforcements, alignment, isCounterSelector, selectionMode]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\" onClick={(e) => e.stopPropagation()}>\r\n      <div className=\"relative\">\r\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40\" />\r\n        <input\r\n          type=\"text\"\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n          onClick={(e) => e.stopPropagation()}\r\n          className=\"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40\"\r\n          placeholder=\"Search ships...\"\r\n        />\r\n\r\n        {showSearch && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"absolute z-50 w-full mt-2 bg-gray-900 border border-white/10 rounded-lg shadow-lg max-h-64 overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex justify-between items-center p-2 border-b border-white/10\">\r\n              <span className=\"text-sm text-white/60\">\r\n                Select {selectionMode === 'capital' ? 'Capital Ship' : 'Ship'}\r\n              </span>\r\n              <button\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setShowSearch(false);\r\n                }}\r\n                className=\"p-1 hover:bg-white/10 rounded\"\r\n              >\r\n                <X className=\"w-4 h-4 text-white/60\" />\r\n              </button>\r\n            </div>\r\n\r\n            {filteredShips.length > 0 ? (\r\n              filteredShips.map((ship) => (\r\n                <div\r\n                  key={ship.id}\r\n                  className=\"p-3 hover:bg-white/5 transition-colors\"\r\n                  onClick={(e) => e.stopPropagation()}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <UnitImage\r\n                        id={ship.id}\r\n                        name={ship.name}\r\n                        type={ship.isCapital ? 'capital-ship' : 'ship'}\r\n                        size=\"sm\"\r\n                        className=\"rounded-full border-2 border-white/20\"\r\n                      />\r\n                      <div>\r\n                        <div className=\"text-white\">{ship.name}</div>\r\n                        <div className=\"text-sm text-white/60\">\r\n                          {ship.isCapital ? 'Capital Ship' : 'Ship'}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      onClick={(e) => handleSelectShip(e, ship, selectionMode)}\r\n                      className=\"px-3 py-1 text-sm rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30\"\r\n                    >\r\n                      Add {selectionMode === 'reinforcement' ? 'Reinforcement' : ''}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <div className=\"p-3 text-white/60 text-center\">\r\n                No matching ships found\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Capital Ship */}\r\n      <div>\r\n        <h3 className=\"text-sm font-medium text-white/60 mb-2 flex items-center gap-2\">\r\n          <Anchor className=\"w-4 h-4\" />\r\n          Capital Ship\r\n        </h3>\r\n        <div className=\"relative group inline-block\">\r\n          {capitalShip ? (\r\n            <div className=\"relative\">\r\n              <UnitImage\r\n                id={capitalShip.id}\r\n                name={capitalShip.name}\r\n                type=\"capital-ship\"\r\n                size=\"lg\"\r\n                className=\"rounded-full border-2 border-blue-400\"\r\n              />\r\n              <button\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onRemoveUnit(capitalShip.id, 'capital');\r\n                }}\r\n                className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\r\n              >\r\n                <X className=\"w-3 h-3 text-white\" />\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <button\r\n              onClick={(e) => handleSearchClick(e, 'capital')}\r\n              className=\"w-16 h-16 rounded-full border-2 border-dashed border-blue-400/40 flex items-center justify-center hover:border-blue-400/60 transition-colors\"\r\n            >\r\n              <span className=\"text-blue-400/60\">+</span>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Starting Lineup */}\r\n      <div>\r\n        <h3 className=\"text-sm font-medium text-white/60 mb-2\">Starting Lineup</h3>\r\n        <div className=\"flex flex-wrap gap-4\">\r\n          {startingLineup.map((ship) => (\r\n            <div key={ship.id} className=\"relative group\">\r\n              <UnitImage\r\n                id={ship.id}\r\n                name={ship.name}\r\n                type=\"ship\"\r\n                size=\"md\"\r\n                className=\"rounded-full border-2 border-white/20\"\r\n              />\r\n              <button\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onRemoveUnit(ship.id, 'starting');\r\n                }}\r\n                className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\r\n              >\r\n                <X className=\"w-3 h-3 text-white\" />\r\n              </button>\r\n            </div>\r\n          ))}\r\n          {startingLineup.length < 3 && (\r\n            <button\r\n              onClick={(e) => handleSearchClick(e, 'starting')}\r\n              className=\"w-12 h-12 rounded-full border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40 transition-colors\"\r\n            >\r\n              <span className=\"text-white/40\">+</span>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Reinforcements */}\r\n      <div>\r\n        <h3 className=\"text-sm font-medium text-white/60 mb-2\">Reinforcements</h3>\r\n        <div className=\"flex flex-wrap gap-4\">\r\n        {reinforcements.map((ship, index) => (\r\n            <div key={ship.id} className=\"relative group\">\r\n              <div className=\"relative\">\r\n                <UnitImage\r\n                  id={ship.id}\r\n                  name={ship.name}\r\n                  type=\"ship\"\r\n                  size=\"md\"\r\n                  className=\"rounded-full border-2 border-white/20\"\r\n                />\r\n                <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs\">\r\n                  {index + 1}\r\n                </div>\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    onRemoveUnit(ship.id, 'reinforcement');\r\n                  }}\r\n                  className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                >\r\n                  <X className=\"w-3 h-3 text-white\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {reinforcements.length < 3 && (\r\n            <button\r\n              onClick={(e) => handleSearchClick(e, 'reinforcement')}\r\n              className=\"w-12 h-12 rounded-full border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40 transition-colors\"\r\n            >\r\n              <span className=\"text-white/40\">+</span>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React, { useState } from 'react';\r\nimport { Fleet, Ship } from '@/types';\r\nimport { AlignmentDropdown } from './AlignmentDropdown';\r\nimport { ShipSelector } from './ShipSelector';\r\nimport { normalizeId } from '@/lib/imageMapping';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { AlertTriangle } from 'lucide-react';\r\n\r\ninterface NewFleetFormProps {\r\n  onSave: (fleet: Fleet) => void;\r\n  onCancel: () => void;\r\n  availableUnits: Ship[];\r\n}\r\n\r\nexport const NewFleetForm: React.FC<NewFleetFormProps> = ({\r\n  onSave,\r\n  onCancel,\r\n  availableUnits\r\n}) => {\r\n  const [name, setName] = useState('');\r\n  const [alignment, setAlignment] = useState<'light' | 'dark'>('light');\r\n  const [capitalShip, setCapitalShip] = useState<Ship | null>(null);\r\n  const [startingLineup, setStartingLineup] = useState<Ship[]>([]);\r\n  const [reinforcements, setReinforcements] = useState<Ship[]>([]);\r\n  const [description, setDescription] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(null);\r\n\r\n    if (!name.trim()) {\r\n      setError('Fleet name is required');\r\n      return;\r\n    }\r\n\r\n    if (!capitalShip) {\r\n      setError('Fleet must have a capital ship');\r\n      return;\r\n    }\r\n\r\n    if (startingLineup.length === 0) {\r\n      setError('Fleet must have at least one ship in starting lineup');\r\n      return;\r\n    }\r\n\r\n    const fleet: Fleet = {\r\n      id: normalizeId(name),\r\n      name: name.trim(),\r\n      type: 'fleet',\r\n      alignment,\r\n      capitalShip,\r\n      startingLineup,\r\n      reinforcements,\r\n      description: description.trim() || undefined\r\n    };\r\n\r\n    onSave(fleet);\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      {error && (\r\n        <Alert variant=\"destructive\">\r\n          <AlertTriangle className=\"w-4 h-4\" />\r\n          <AlertTitle>Error</AlertTitle>\r\n          <AlertDescription>{error}</AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-white mb-2\">\r\n            Fleet Name\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n            placeholder=\"Enter fleet name\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <AlignmentDropdown\r\n            value={alignment}\r\n            onChange={setAlignment}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <ShipSelector\r\n        capitalShip={capitalShip}\r\n        startingLineup={startingLineup}\r\n        reinforcements={reinforcements}\r\n        onAddUnit={(ship, position) => {\r\n          switch (position) {\r\n            case 'capital':\r\n              setCapitalShip(ship);\r\n              break;\r\n            case 'starting':\r\n              if (startingLineup.length < 3) {\r\n                setStartingLineup(prev => [...prev, ship]);\r\n              }\r\n              break;\r\n            case 'reinforcement':\r\n              if (reinforcements.length < 3) {\r\n                setReinforcements(prev => [...prev, ship]);\r\n              }\r\n              break;\r\n          }\r\n        }}\r\n        onRemoveUnit={(shipId, position) => {\r\n          switch (position) {\r\n            case 'capital':\r\n              setCapitalShip(null);\r\n              break;\r\n            case 'starting':\r\n              setStartingLineup(prev => prev.filter(s => s.id !== shipId));\r\n              break;\r\n            case 'reinforcement':\r\n              setReinforcements(prev => prev.filter(s => s.id !== shipId));\r\n              break;\r\n          }\r\n        }}\r\n        alignment={alignment}\r\n        availableUnits={availableUnits}\r\n      />\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-white mb-2\">\r\n          Description (Optional)\r\n        </label>\r\n        <textarea\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none\"\r\n          rows={3}\r\n          placeholder=\"Add any notes or description...\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex justify-end gap-3 pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onCancel}\r\n          className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600\"\r\n        >\r\n          Create Fleet\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};","// /components/admin/NewDefenseModal.tsx\r\n\r\nimport React, { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { X, Shield, Ship as ShipIcon } from 'lucide-react';\r\nimport { Squad, Fleet, Character, Ship as ShipType } from '@/types';\r\nimport { NewSquadForm } from './NewSquadForm';\r\nimport { NewFleetForm } from './NewFleetForm';\r\n\r\ninterface NewDefenseModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSave: (defense: Squad | Fleet) => Promise<void>;\r\n  initialType: 'squad' | 'fleet';\r\n  availableUnits: Character[] | ShipType[]; \r\n}\r\n\r\nexport const NewDefenseModal: React.FC<NewDefenseModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onSave,\r\n  initialType = 'squad',\r\n  availableUnits,\r\n}) => {\r\n  const [defenseType, setDefenseType] = useState<'squad' | 'fleet'>(initialType);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // Hantera sparande ENDAST när användaren explicit väljer att spara\r\n  const handleSave = async (defense: Squad | Fleet) => {\r\n    try {\r\n      await onSave(defense);\r\n      console.log('Defense saved successfully'); // Logga om sparandet lyckas\r\n      onClose(); // Stäng modalen efter att den har sparats\r\n    } catch (error) {\r\n      console.error('Error saving:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto\">\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        exit={{ opacity: 0, y: 20 }}\r\n        className=\"w-full max-w-2xl mx-4 my-8 bg-space-darker rounded-lg border border-white/10\"\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center p-4 border-b border-white/10\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={() => setDefenseType('squad')}\r\n              className={`flex items-center gap-2 px-4 py-2 rounded-lg ${\r\n                defenseType === 'squad' ? 'bg-blue-500' : 'bg-white/5'\r\n              }`}\r\n            >\r\n              <Shield className=\"w-4 h-4\" />\r\n              Squad\r\n            </button>\r\n            <button\r\n              onClick={() => setDefenseType('fleet')}\r\n              className={`flex items-center gap-2 px-4 py-2 rounded-lg ${\r\n                defenseType === 'fleet' ? 'bg-blue-500' : 'bg-white/5'\r\n              }`}\r\n            >\r\n              <ShipIcon className=\"w-4 h-4\" />\r\n              Fleet\r\n            </button>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form Content */}\r\n        <div className=\"max-h-[calc(100vh-200px)] overflow-y-auto\">\r\n          <div className=\"p-6\">\r\n            {defenseType === 'squad' ? (\r\n              <NewSquadForm \r\n                onSave={handleSave} \r\n                onCancel={onClose} \r\n                availableUnits={availableUnits as Character[]} \r\n              />\r\n            ) : (\r\n              <NewFleetForm \r\n                onSave={handleSave} \r\n                onCancel={onClose} \r\n                availableUnits={availableUnits as ShipType[]}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};","import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Check, AlertCircle } from 'lucide-react';\r\n\r\ninterface Notification {\r\n  id: string;\r\n  type: 'success' | 'error';\r\n  message: string;\r\n}\r\n\r\ninterface NotificationManagerProps {\r\n  notifications: Notification[];\r\n  onDismiss: (id: string) => void;\r\n}\r\n\r\nexport const NotificationManager: React.FC<NotificationManagerProps> = ({\r\n  notifications,\r\n  onDismiss\r\n}) => {\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-50 space-y-2\">\r\n      <AnimatePresence>\r\n        {notifications.map(notification => (\r\n          <motion.div\r\n            key={notification.id}\r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm\r\n              ${notification.type === 'success' \r\n                ? 'bg-green-500/10 text-green-400 border border-green-400/20' \r\n                : 'bg-red-500/10 text-red-400 border border-red-400/20'\r\n              }`}\r\n            onClick={() => onDismiss(notification.id)}\r\n          >\r\n            {notification.type === 'success' ? (\r\n              <Check className=\"w-3.5 h-3.5\" />\r\n            ) : (\r\n              <AlertCircle className=\"w-3.5 h-3.5\" />\r\n            )}\r\n            {notification.message}\r\n          </motion.div>\r\n        ))}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface SettingsPanelProps {\r\n  onClose: () => void;\r\n  onSave: (settings: { users: any[] }) => void; // Uppdaterad typ\r\n}\r\n\r\nexport const SettingsPanel: React.FC<SettingsPanelProps> = ({ onClose }) => {\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center\"\r\n    >\r\n      <motion.div\r\n        initial={{ scale: 0.95, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        exit={{ scale: 0.95, opacity: 0 }}\r\n        className=\"bg-space-darker w-full max-w-2xl rounded-lg border border-white/10\"\r\n      >\r\n        <div className=\"flex justify-between items-center p-4 border-b border-white/10\">\r\n          <h2 className=\"text-xl font-bold text-white\">Admin Settings</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 text-green-500 hover:text-green-100 hover:bg-green-500 rounded-lg\"\r\n            >\r\n            Tillbaka\r\n          </button>\r\n        </div>\r\n        <div className=\"p-6\">\r\n          <p className=\"text-white/60\">Här var det tom. Funktionen är för närvarande inaktiverad men kan användas i framtiden.</p>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};\r\n","// src/services/firebaseSync.ts\r\n\r\nimport { db } from '@/lib/firebase';\r\nimport { \r\n  collection, \r\n  doc, \r\n  setDoc, \r\n  writeBatch,\r\n  getDocs,\r\n  QueryDocumentSnapshot\r\n} from 'firebase/firestore';\r\n\r\nexport class FirebaseSync {\r\n  // Add new helper function\r\n  private static cleanDataForFirestore(obj: any): any {\r\n    if (obj === null || obj === undefined) {\r\n      return null;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.map(item => this.cleanDataForFirestore(item)).filter(item => item != null);\r\n    }\r\n\r\n    if (typeof obj === 'object') {\r\n      const cleanedObj: any = {};\r\n      for (const [key, value] of Object.entries(obj)) {\r\n        const cleanedValue = this.cleanDataForFirestore(value);\r\n        if (cleanedValue != null) {\r\n          cleanedObj[key] = cleanedValue;\r\n        }\r\n      }\r\n      return cleanedObj;\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n\r\n  // Skapa admin användare\r\n  static async createAdminUser(email: string) {\r\n    try {\r\n      console.log('Creating admin user...');\r\n      const userRef = doc(db, 'users', 'admin');\r\n      await setDoc(userRef, {\r\n        email,\r\n        isAdmin: true,\r\n        isMasterAdmin: true,\r\n        createdAt: new Date().toISOString(),\r\n        lastLogin: new Date().toISOString()\r\n      });\r\n      console.log('Admin user created successfully');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error creating admin user:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  \r\n\r\n  // Synka all data\r\n  static async syncAll() {\r\n    try {\r\n      console.log('Starting full data sync...');\r\n      \r\n      await Promise.all([\r\n\r\n        this.createAdminUser('admin@example.com') // Ändra till din admin email\r\n      ]);\r\n\r\n      console.log('All data synced successfully');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error during full sync:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Rensa all data (Var försiktig med denna!)\r\n  static async clearAllData() {\r\n    try {\r\n      console.log('Starting data clear...');\r\n      \r\n      const collections = ['squads', 'fleets', 'counters'];\r\n      const batch = writeBatch(db);\r\n\r\n      for (const collectionName of collections) {\r\n        const querySnapshot = await getDocs(collection(db, collectionName));\r\n        querySnapshot.forEach((document: QueryDocumentSnapshot) => {\r\n          batch.delete(document.ref);\r\n        });\r\n      }\r\n\r\n      await batch.commit();\r\n      console.log('All data cleared successfully');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error clearing data:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { FirebaseSync } from '@/services/firebaseSync';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { RefreshCw } from 'lucide-react';\r\n\r\nexport const SyncButton: React.FC = () => {\r\n  const [isSyncing, setIsSyncing] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState(false);\r\n  const [showFeedback, setShowFeedback] = useState(false);\r\n\r\n  // Reset knappens utseende efter feedback\r\n  useEffect(() => {\r\n    let feedbackTimer: NodeJS.Timeout;\r\n    if (showFeedback) {\r\n      feedbackTimer = setTimeout(() => {\r\n        setShowFeedback(false);\r\n      }, 4000);\r\n    }\r\n    return () => {\r\n      if (feedbackTimer) clearTimeout(feedbackTimer);\r\n    };\r\n  }, [showFeedback]);\r\n\r\n  const handleSync = async () => {\r\n    setIsSyncing(true);\r\n    setError(null);\r\n    setSuccess(false);\r\n    setShowFeedback(false);\r\n  \r\n    try {\r\n      // Kör båda promises samtidigt utan att spara resultatet\r\n      await Promise.all([\r\n        FirebaseSync.syncAll(),\r\n        new Promise(resolve => setTimeout(resolve, 2000)) // Garanterad minimisynktid\r\n      ]);\r\n  \r\n      setSuccess(true);\r\n      // Visa success-feedback i 4 sekunder\r\n      setTimeout(() => {\r\n        setShowFeedback(true);\r\n        setSuccess(true);\r\n        // Återställ efter 4 sekunder\r\n        setTimeout(() => {\r\n          setSuccess(false);\r\n          setShowFeedback(false);\r\n        }, 4000);\r\n      }, 100); // Kort delay för att säkerställa att animationen syns\r\n  \r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Ett fel uppstod vid synkronisering');\r\n      // Visa error-feedback i 4 sekunder\r\n      setTimeout(() => {\r\n        setShowFeedback(true);\r\n        // Återställ efter 4 sekunder\r\n        setTimeout(() => {\r\n          setError(null);\r\n          setShowFeedback(false);\r\n        }, 4000);\r\n      }, 100);\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n  // Funktion för att bestämma knappens styling\r\n  const getButtonStyles = () => {\r\n    if (isSyncing) return 'bg-gray-500 cursor-not-allowed';\r\n    if (showFeedback) {\r\n      if (success) return 'bg-green-500 hover:bg-green-600';\r\n      if (error) return 'bg-red-500 hover:bg-red-600';\r\n    }\r\n    return 'bg-blue-500 hover:bg-blue-600';\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        onClick={handleSync}\r\n        disabled={isSyncing}\r\n        className={`flex items-center gap-2 px-4 py-2 rounded-lg ${getButtonStyles()} \r\n                   text-white transition-all duration-300`}\r\n        animate={{\r\n          scale: isSyncing ? 0.98 : 1,\r\n        }}\r\n      >\r\n        <RefreshCw \r\n          className={`w-4 h-4 transition-transform ${isSyncing ? 'animate-spin' : ''}`}\r\n        />\r\n        {isSyncing ? 'Syncing...' : 'Sync Data'}\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {(error || success) && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: 10 }}\r\n            className=\"absolute top-full mt-2 right-0 min-w-[200px]\"\r\n          >\r\n            {error && (\r\n              <Alert variant=\"destructive\">\r\n                <AlertTitle>Error</AlertTitle>\r\n                <AlertDescription>{error}</AlertDescription>\r\n              </Alert>\r\n            )}\r\n            {success && (\r\n              <Alert className=\"bg-green-500/10 border-green-500/20 text-green-400\">\r\n                <AlertTitle>Success</AlertTitle>\r\n                <AlertDescription>Data synced successfully!</AlertDescription>\r\n              </Alert>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};","import { useState, useEffect, useRef, memo, useMemo } from 'react';\r\nimport { Search, X } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { getUnitImage } from '@/lib/imageUtils';\r\nimport { Squad, Fleet } from '@/types';\r\n\r\ninterface SearchBarProps {\r\n  value: string;\r\n  onChange: (value: string) => void;\r\n  onClear: () => void;\r\n  suggestions?: (Squad | Fleet)[];\r\n  onSelectSuggestion?: (item: Squad | Fleet) => void;\r\n  placeholder?: string;\r\n}\r\n\r\nexport const SearchBar = memo<SearchBarProps>(({\r\n  value,\r\n  onChange,\r\n  onClear,\r\n  suggestions = [],\r\n  onSelectSuggestion,\r\n  placeholder = \"Search teams or ships...\"\r\n}) => {\r\n  const filteredSuggestions = useMemo(() => \r\n    suggestions.slice(0, 10), // Begränsa antal förslag för bättre prestanda\r\n    [suggestions]\r\n  );\r\n\r\n  const [isFocused, setIsFocused] = useState(false);\r\n  const [imageUrls, setImageUrls] = useState<Record<string, string>>({});\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    const loadImages = async () => {\r\n      const urls: Record<string, string> = {};\r\n      for (const item of filteredSuggestions) {\r\n        try {\r\n          if ('leader' in item && item.leader) {\r\n            urls[item.leader.id] = await getUnitImage(item.leader.id, 'character');\r\n          } else if ('capitalShip' in item && item.capitalShip) {\r\n            urls[item.capitalShip.id] = await getUnitImage(item.capitalShip.id, 'ship');\r\n          }\r\n        } catch (error) {\r\n          console.error(`Failed to load image for suggestion:`, error);\r\n          urls[item.id] = '/placeholder.png';\r\n        }\r\n      }\r\n      setImageUrls(urls);\r\n    };\r\n\r\n    if (filteredSuggestions.length > 0) {\r\n      loadImages();\r\n    }\r\n  }, [filteredSuggestions]);\r\n\r\n  return (\r\n    <div className=\"relative w-full\">\r\n      <div className=\"relative\">\r\n        <input\r\n          ref={inputRef}\r\n          type=\"text\"\r\n          value={value}\r\n          onChange={(e) => onChange(e.target.value)}\r\n          onFocus={() => setIsFocused(true)}\r\n          onBlur={() => setTimeout(() => setIsFocused(false), 200)}\r\n          className=\"w-full bg-white/5 border border-white/10 rounded-lg pl-10 pr-10 py-2 \r\n                   text-white placeholder-white/40 focus:outline-none focus:ring-2 \r\n                   focus:ring-blue-400/50 focus:border-transparent\"\r\n          placeholder={placeholder}\r\n        />\r\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40\" />\r\n        {value && (\r\n          <button\r\n            onClick={() => {\r\n              onClear();\r\n              inputRef.current?.focus();\r\n            }}\r\n            className=\"absolute right-3 top-1/2 transform -translate-y-1/2 \r\n                     text-white/40 hover:text-white\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      <AnimatePresence>\r\n        {isFocused && filteredSuggestions.length > 0 && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"absolute z-50 w-full mt-2 bg-space-dark border border-white/10 \r\n                     rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto\"\r\n          >\r\n            {filteredSuggestions.map((item) => (\r\n              <button\r\n                key={item.id}\r\n                onClick={() => onSelectSuggestion?.(item)}\r\n                className=\"w-full px-4 py-3 flex items-center gap-3 hover:bg-white/5 \r\n                         transition-colors text-left\"\r\n              >\r\n                {'leader' in item && item.leader ? (\r\n                  <img\r\n                    src={imageUrls[item.leader.id] || '/placeholder.png'}\r\n                    alt={item.leader.name}\r\n                    className=\"w-8 h-8 rounded-full object-cover\"\r\n                    loading=\"lazy\" // Implementera lazy loading\r\n                  />\r\n                ) : 'capitalShip' in item && item.capitalShip ? (\r\n                  <img\r\n                    src={imageUrls[item.capitalShip.id] || '/placeholder.png'}\r\n                    alt={item.capitalShip.name}\r\n                    className=\"w-8 h-8 rounded-full object-cover\"\r\n                    loading=\"lazy\" // Implementera lazy loading\r\n                  />\r\n                ) : null}\r\n                <div>\r\n                  <div className=\"text-white\">{item.name}</div>\r\n                  <div className=\"text-sm text-white/40\">\r\n                    {'leader' in item ? 'Squad' : 'Fleet'}\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            ))}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n});\r\n\r\nSearchBar.displayName = 'SearchBar';","// src/components/admin/CounterList.tsx\r\n\r\nimport React from 'react';\r\nimport { Squad, Fleet, Counter, Character, Ship } from '@/types';\r\nimport { UnitImage } from '@/components/ui/UnitImage';\r\nimport { Edit, Trash2, Video } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface CounterListProps {\r\n  counters: Counter[];\r\n  targetDefense: Squad | Fleet;\r\n  onEdit?: (counter: Counter) => void;\r\n  onDelete?: (id: string) => void;\r\n}\r\n\r\n// Type guard för att kontrollera om det är en Squad\r\n\r\n// Type guard för att kontrollera om det är en Squad Counter\r\nconst isSquadCounter = (counter: Counter): counter is Counter & { counterSquad: Squad } => {\r\n  return 'leader' in counter.counterSquad;\r\n};\r\n\r\nexport const CounterList: React.FC<CounterListProps> = ({\r\n  counters,\r\n  targetDefense,\r\n  onEdit,\r\n  onDelete\r\n}) => {\r\n  // Säkerställ att counter har all nödvändig data\r\n  const isValidCounter = (counter: Counter | undefined): counter is Counter => {\r\n    return Boolean(\r\n      counter &&\r\n      counter.id &&\r\n      counter.targetSquad &&\r\n      counter.counterSquad\r\n    );\r\n  };\r\n\r\n  // Generera unika nycklar för list items\r\n  const getUniqueKey = (counter: Counter, index: number, unitId: string): string => {\r\n    return `${counter.id}-${index}-${unitId}`;\r\n  };\r\n\r\n  // Validera input data\r\n  if (!Array.isArray(counters) || counters.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  // Filtrera relevanta counters och validera dem\r\n  const relevantCounters = counters.filter(counter => \r\n    isValidCounter(counter) && counter.targetSquad.id === targetDefense.id\r\n  );\r\n\r\n  if (relevantCounters.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 max-h-[60vh] overflow-y-auto\">\r\n      <h4 className=\"text-sm font-medium text-white/60\">\r\n        Counters for {targetDefense.name}\r\n      </h4>\r\n      \r\n      <div className=\"space-y-3\">\r\n        <AnimatePresence>\r\n          {relevantCounters.map((counter, index) => (\r\n            <motion.div\r\n              key={counter.id}\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -20 }}\r\n              className=\"p-4 bg-white/5 rounded-lg space-y-4\"\r\n            >\r\n              {/* Counter Type and Actions */}\r\n              <div className=\"flex justify-between items-start\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`px-2 py-1 rounded-full text-xs ${\r\n                    counter.counterType === 'hard'\r\n                      ? 'bg-green-500/20 text-green-400'\r\n                      : counter.counterType === 'soft'\r\n                      ? 'bg-yellow-500/20 text-yellow-400'\r\n                      : 'bg-red-500/20 text-red-400'\r\n                  }`}>\r\n                    {counter.counterType.charAt(0).toUpperCase() + counter.counterType.slice(1)}\r\n                  </span>\r\n\r\n                  {counter.twOmicronRequired && (\r\n                    <span className=\"px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400\">\r\n                      TW Omicron\r\n                    </span>\r\n                  )}\r\n\r\n                  {counter.video_url && (\r\n                    <span className=\"flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-red-500/20 text-red-400\">\r\n                      <Video className=\"w-3 h-3\" />\r\n                      Video\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex gap-2\">\r\n                  {onEdit && (\r\n                    <button\r\n                      onClick={() => onEdit(counter)}\r\n                      className=\"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg\"\r\n                    >\r\n                      <Edit className=\"w-4 h-4\" />\r\n                    </button>\r\n                  )}\r\n                  {onDelete && (\r\n                    <button\r\n                      onClick={() => onDelete(counter.id)}\r\n                      className=\"p-2 text-red-400 hover:bg-red-400/10 rounded-lg\"\r\n                    >\r\n                      <Trash2 className=\"w-4 h-4\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Description */}\r\n              {counter.description && (\r\n                <p className=\"text-white/70\">{counter.description}</p>\r\n              )}\r\n\r\n              {/* Counter Squad/Fleet Preview */}\r\n              {counter.counterSquad && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  {isSquadCounter(counter) ? (\r\n                    // Squad Counter\r\n                    <>\r\n                      {counter.counterSquad.leader && (\r\n                        <UnitImage\r\n                          key={getUniqueKey(counter, index, counter.counterSquad.leader.id)}\r\n                          id={counter.counterSquad.leader.id}\r\n                          name={counter.counterSquad.leader.name}\r\n                          type=\"squad-leader\"\r\n                          size=\"sm\"\r\n                          className=\"border-2 border-blue-400\"\r\n                        />\r\n                      )}\r\n                      {counter.counterSquad.characters.map((char: Character) => (\r\n                        <UnitImage\r\n                          key={getUniqueKey(counter, index, char.id)}\r\n                          id={char.id}\r\n                          name={char.name}\r\n                          type=\"squad-member\"\r\n                          size=\"sm\"\r\n                          className=\"border-2 border-white/20\"\r\n                        />\r\n                      ))}\r\n                    </>\r\n                  ) : (\r\n                    // Fleet Counter\r\n                    <>\r\n                      {'capitalShip' in counter.counterSquad && counter.counterSquad.capitalShip && (\r\n                        <UnitImage\r\n                          key={getUniqueKey(counter, index, counter.counterSquad.capitalShip.id)}\r\n                          id={counter.counterSquad.capitalShip.id}\r\n                          name={counter.counterSquad.capitalShip.name}\r\n                          type=\"capital-ship\"\r\n                          size=\"sm\"\r\n                          className=\"border-2 border-blue-400\"\r\n                        />\r\n                      )}\r\n                      {'startingLineup' in counter.counterSquad && \r\n                        counter.counterSquad.startingLineup?.map((ship: Ship) => (\r\n                          <UnitImage\r\n                            key={getUniqueKey(counter, index, ship.id)}\r\n                            id={ship.id}\r\n                            name={ship.name}\r\n                            type=\"ship\"\r\n                            size=\"sm\"\r\n                            className=\"border-2 border-white/20\"\r\n                          />\r\n                        ))\r\n                      }\r\n                    </>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Requirements Section */}\r\n              {counter.requirements && counter.requirements.length > 0 && (\r\n                <div className=\"mt-3 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20\">\r\n                  <h4 className=\"text-sm font-medium text-blue-400 mb-2\">Requirements</h4>\r\n                  {counter.requirements.map((req, reqIndex) => (\r\n                    <div \r\n                      key={`${counter.id}-req-${reqIndex}`}\r\n                      className=\"text-sm text-white/70\"\r\n                    >\r\n                      {req.description}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </motion.div>\r\n          ))}\r\n        </AnimatePresence>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CounterList;","import React from 'react';\r\nimport { Plus } from 'lucide-react';\r\nimport { Squad, Fleet } from '@/types';\r\n\r\ninterface CounterButtonProps {\r\n  defense: Squad | Fleet;\r\n  onAddCounter: (defense: Squad | Fleet) => void;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport const CounterButton: React.FC<CounterButtonProps> = ({\r\n  defense,\r\n  onAddCounter,\r\n  disabled = false\r\n}) => {\r\n  return (\r\n    <button\r\n      onClick={() => onAddCounter(defense)}\r\n      disabled={disabled}\r\n      className={`flex items-center gap-2 px-4 py-2 rounded-lg \r\n                ${disabled \r\n                  ? 'bg-gray-500/20 text-gray-400 cursor-not-allowed' \r\n                  : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'} \r\n                transition-colors`}\r\n    >\r\n      <Plus className=\"w-4 h-4\" />\r\n      Add Counter\r\n    </button>\r\n  );\r\n};","import React, { useState } from 'react';\r\nimport { Squad, Counter, Character } from '@/types';\r\nimport { Settings, Plus, Trash2, X } from 'lucide-react';\r\nimport { CounterList } from './CounterList';\r\nimport { UnitImage } from '../ui/UnitImage';\r\nimport { CounterButton } from './CounterButton';\r\nimport { AlignmentDropdown } from './AlignmentDropdown';\r\nimport { normalizeId } from '@/lib/imageMapping';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { UnitSelector } from '../UnitSelector';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { AlertTriangle } from 'lucide-react';\r\nimport { useFirebase } from '@/contexts/FirebaseContext';\r\nimport { LoadingIndicator } from '@/components/ui/LoadingIndicator';\r\n\r\ninterface EditModalProps {\r\n  squad: Squad;\r\n  counters: Counter[];\r\n  availableUnits: Character[];\r\n  onClose: () => void;\r\n  onUpdate: (squad: Squad) => void;\r\n  onDelete: (id: string) => void;\r\n  onUpdateCounter: (counter: Counter) => void;\r\n  onDeleteCounter: (counterId: string) => void;\r\n  onAddCounter: (squad: Squad) => void;\r\n  isOnline: boolean;\r\n  saving: boolean;\r\n}\r\n\r\ninterface SquadEditorProps {\r\n  squads: Squad[];\r\n  counters: Counter[];\r\n  availableUnits: Character[];\r\n  onUpdate: (squad: Squad) => void;\r\n  onDelete: (id: string) => void;\r\n  onAddCounter: (squad: Squad) => void;\r\n  onEditCounter: (counter: Counter) => void;\r\n  onDeleteCounter: (counterId: string) => void;\r\n}\r\n\r\nconst EditModal: React.FC<EditModalProps> = ({\r\n  squad,\r\n  counters,\r\n  availableUnits,\r\n  onClose,\r\n  onUpdate,\r\n  onDelete,\r\n  onUpdateCounter,\r\n  onDeleteCounter,\r\n  onAddCounter,\r\n  isOnline,\r\n  saving = false\r\n}) => {\r\n  const [name, setName] = useState(squad.name);\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n  const [alignment, setAlignment] = useState<'light' | 'dark'>(squad.alignment);\r\n  const [description, setDescription] = useState(squad.description || '');\r\n  const [twOmicronRequired, setTwOmicronRequired] = useState(squad.twOmicronRequired || false);\r\n  const [showSelector, setShowSelector] = useState(false);\r\n  const [selectorMode, setSelectorMode] = useState<'leader' | 'member'>('leader');\r\n\r\n  const handleSave = async () => {\r\n    if (!isOnline) {\r\n      return; // Prevent saving while offline\r\n    }\r\n\r\n    try {\r\n      const updatedSquad: Squad = {\r\n        ...squad,\r\n        name,\r\n        alignment,\r\n        id: normalizeId(name),\r\n        description: description.trim() || undefined,\r\n        twOmicronRequired\r\n      };\r\n      await onUpdate(updatedSquad);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error saving squad:', error);\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    onDelete(squad.id);\r\n    onClose();\r\n  };\r\n\r\n// Uppdatera handleRemoveCharacter\r\nconst handleRemoveCharacter = (characterId: string, isLeader: boolean) => {\r\n  const updatedSquad = { ...squad };\r\n  \r\n  if (isLeader) {\r\n    updatedSquad.leader = null;\r\n  } else {\r\n    updatedSquad.characters = updatedSquad.characters.filter(c => c.id !== characterId);\r\n  }\r\n\r\n  onUpdate(updatedSquad);\r\n};\r\n\r\n// Uppdatera handleAddCharacter\r\nconst handleAddCharacter = (character: Character, isLeader: boolean) => {\r\n  const normalizedCharacter = {\r\n    ...character,\r\n    id: normalizeId(character.name)\r\n  };\r\n\r\n  const updatedSquad = { ...squad };\r\n\r\n  if (isLeader) {\r\n    updatedSquad.leader = normalizedCharacter;\r\n  } else {\r\n    if (updatedSquad.characters.length < 4) {\r\n      updatedSquad.characters = [...updatedSquad.characters, normalizedCharacter];\r\n    }\r\n  }\r\n\r\n  onUpdate(updatedSquad);\r\n};\r\n\r\n  const squadCounters = counters.filter(c => c.targetSquad.id === squad.id);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto\">\r\n      <div className=\"min-h-full w-full flex items-start justify-center py-8\">\r\n        <div className=\"relative w-full max-w-4xl mx-4 bg-space-darker rounded-lg border border-white/10\">\r\n          {/* Header */}\r\n          <div className=\"sticky top-0 z-10 flex justify-between items-center p-4 border-b border-white/10 bg-space-darker\">\r\n            <h2 className=\"text-xl font-bold text-white\">Edit Squad</h2>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setShowDeleteConfirm(true)}\r\n                className=\"p-2 text-red-400 hover:bg-red-400/10 rounded-lg\"\r\n              >\r\n                <Trash2 className=\"w-5 h-5\" />\r\n              </button>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-6 space-y-6\">\r\n            {/* Basic Info */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-white mb-2\">\r\n                  Squad Name\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={name}\r\n                  onChange={(e) => setName(e.target.value)}\r\n                  className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <AlignmentDropdown \r\n                  value={alignment}\r\n                  onChange={setAlignment}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Squad Formation */}\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-white mb-4\">Squad Formation</h3>\r\n\r\n              {/* Leader */}\r\n              <div className=\"mb-6\">\r\n                <h4 className=\"text-sm font-medium text-white/60 mb-2\">Leader</h4>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  {squad.leader && (\r\n                    <div className=\"relative\">\r\n                      <UnitImage\r\n                        id={squad.leader.id}\r\n                        name={squad.leader.name}\r\n                        type=\"squad-leader\"\r\n                        size=\"lg\"\r\n                        className=\"border-2 border-blue-400\"\r\n                      />\r\n                      <button\r\n                        onClick={() => handleRemoveCharacter(squad.leader!.id, true)}\r\n                        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n                      >\r\n                        <X className=\"w-3 h-3 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                  {!squad.leader && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectorMode('leader');\r\n                        setShowSelector(true);\r\n                      }}\r\n                      className=\"w-20 h-20 rounded-lg border-2 border-dashed border-blue-500/50 flex items-center justify-center hover:border-blue-500\"\r\n                    >\r\n                      <Plus className=\"w-6 h-6 text-blue-500/50\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Squad Members */}\r\n              <div>\r\n                <h4 className=\"text-sm font-medium text-white/60 mb-2\">Squad Members</h4>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  {squad.characters.map((char) => (\r\n                    <div key={char.id} className=\"relative\">\r\n                      <UnitImage\r\n                        id={char.id}\r\n                        name={char.name}\r\n                        type=\"squad-member\"\r\n                        size=\"md\"\r\n                        className=\"border-2 border-white/20\"\r\n                      />\r\n                      <button\r\n                        onClick={() => handleRemoveCharacter(char.id, false)}\r\n                        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n                      >\r\n                        <X className=\"w-3 h-3 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                  {squad.characters.length < 4 && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectorMode('member');\r\n                        setShowSelector(true);\r\n                      }}\r\n                      className=\"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40\"\r\n                    >\r\n                      <Plus className=\"w-4 h-4 text-white/40\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Additional Options */}\r\n            <div className=\"space-y-4\">\r\n              {/* Description */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-white mb-2\">\r\n                  Description (Optional)\r\n                </label>\r\n                <textarea\r\n                  value={description}\r\n                  onChange={(e) => setDescription(e.target.value)}\r\n                  className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none\"\r\n                  rows={2}\r\n                  placeholder=\"Add any additional notes about this squad...\"\r\n                />\r\n              </div>\r\n\r\n              {/* TW Omicron Toggle */}\r\n              <div className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"twOmicron\"\r\n                  checked={twOmicronRequired}\r\n                  onChange={(e) => setTwOmicronRequired(e.target.checked)}\r\n                  className=\"w-4 h-4 rounded border-white/10 bg-white/5 text-blue-500 \r\n                           focus:ring-blue-500 focus:ring-offset-space-darker\"\r\n                />\r\n                <label htmlFor=\"twOmicron\" className=\"ml-2 text-sm text-white\">\r\n                  Requires Territory Wars Omicron\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Counters */}\r\n            <div>\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"text-lg font-medium text-white\">Counters</h3>\r\n                <CounterButton\r\n                  defense={squad}\r\n                  onAddCounter={() => onAddCounter(squad)}\r\n                />\r\n              </div>\r\n\r\n              <CounterList\r\n                counters={squadCounters}\r\n                targetDefense={squad}\r\n                onEdit={onUpdateCounter}\r\n                onDelete={onDeleteCounter}\r\n              />\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"flex justify-end gap-3 pt-4\">\r\n              <button\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n                disabled={saving}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleSave}\r\n                disabled={!isOnline || saving}\r\n                className={`px-4 py-2 rounded-lg ${\r\n                  !isOnline || saving\r\n                    ? 'bg-gray-500 cursor-not-allowed' \r\n                    : 'bg-blue-500 hover:bg-blue-600'\r\n                } text-white`}\r\n              >\r\n                {saving ? 'Saving...' : 'Save Changes'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <AnimatePresence>\r\n        {showDeleteConfirm && (\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center\"\r\n          >\r\n            <motion.div\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              className=\"bg-space-darker p-6 rounded-lg max-w-md w-full mx-4 border border-white/10\"\r\n            >\r\n              <h3 className=\"text-xl font-bold text-white mb-4\">Delete Squad</h3>\r\n              <p className=\"text-white/70 mb-6\">\r\n                Are you sure you want to delete this squad? This action cannot be undone.\r\n              </p>\r\n              <div className=\"flex justify-end gap-3\">\r\n                <button\r\n                  onClick={() => setShowDeleteConfirm(false)}\r\n                  className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={handleDelete}\r\n                  className=\"px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600\"\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Loading Overlay */}\r\n      {saving && (\r\n        <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\r\n          <LoadingIndicator size=\"lg\" />\r\n        </div>\r\n      )}\r\n\r\n      {showSelector && (\r\n        <UnitSelector<Character>\r\n          type=\"character\"\r\n          isOpen={showSelector}\r\n          onClose={() => setShowSelector(false)}\r\n          onSelect={(character) => {\r\n            handleAddCharacter(character, selectorMode === 'leader'); // Lägg till isLeader parameter\r\n            setShowSelector(false);\r\n          }}\r\n          availableUnits={availableUnits}\r\n          alignment={squad.alignment}\r\n          selectionType={selectorMode}\r\n          title={`Select ${selectorMode === 'leader' ? 'Leader' : 'Member'}`}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const SquadEditor: React.FC<SquadEditorProps> = ({\r\n  squads,\r\n  counters,\r\n  availableUnits,\r\n  onUpdate,\r\n  onDelete,\r\n  onAddCounter,\r\n  onEditCounter,\r\n  onDeleteCounter\r\n}) => {\r\n  const { isOnline, isLoading } = useFirebase();\r\n  const [saving, setSaving] = useState(false);\r\n  const [editingSquad, setEditingSquad] = useState<Squad | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleUpdateSquad = async (squad: Squad) => {\r\n    if (!isOnline) {\r\n      setError('Cannot save while offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      await onUpdate(squad);\r\n      setError(null);\r\n    } catch (error) {\r\n      console.error('Error updating squad:', error);\r\n      setError('Failed to update squad');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteSquad = async (id: string) => {\r\n    try {\r\n      await onDelete(id);\r\n      setError(null);\r\n    } catch (error) {\r\n      console.error('Error deleting squad:', error);\r\n      setError('Failed to delete squad');\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center p-8\">\r\n        <LoadingIndicator size=\"lg\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {!isOnline && (\r\n        <Alert>\r\n          <AlertTitle>Offline Mode</AlertTitle>\r\n          <AlertDescription>\r\n            You are currently offline. Changes will be saved when you reconnect.\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {error && (\r\n        <Alert variant=\"destructive\">\r\n          <AlertTriangle className=\"w-4 h-4\" />\r\n          <AlertTitle>Error</AlertTitle>\r\n          <AlertDescription>{error}</AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {squads.map((squad) => (\r\n        <div\r\n          key={squad.id}\r\n          className=\"p-4 rounded-lg bg-space-dark border border-white/10\"\r\n        >\r\n          <div className=\"flex justify-between items-start\">\r\n            {/* Squad Info */}\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                {squad.leader && (\r\n                  <UnitImage\r\n                    id={squad.leader.id}\r\n                    name={squad.leader.name}\r\n                    type=\"squad-leader\"\r\n                    size=\"md\"\r\n                    className=\"border-2 border-blue-400\"\r\n                  />\r\n                )}\r\n                {squad.characters.map((char) => (\r\n                  <UnitImage\r\n                    key={char.id}\r\n                    id={char.id}\r\n                    name={char.name}\r\n                    type=\"squad-member\"\r\n                    size=\"md\"\r\n                    className=\"border-2 border-white/20\"\r\n                  />\r\n                ))}\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-white\">{squad.name}</h3>\r\n                <div className=\"flex items-center gap-2 mt-1\">\r\n                  <span className={`inline-block px-2 py-1 rounded-full text-xs\r\n                    ${squad.alignment === 'light' \r\n                      ? 'bg-blue-500/20 text-blue-400' \r\n                      : 'bg-red-500/20 text-red-400'\r\n                    }`}\r\n                  >\r\n                    {squad.alignment === 'light' ? 'Light Side' : 'Dark Side'}\r\n                  </span>\r\n                  {squad.twOmicronRequired && (\r\n                    <span className=\"inline-block px-2 py-1 rounded-full text-xs bg-purple-500/20 text-purple-400\">\r\n                      TW Omicron\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex gap-2\">\r\n              <CounterButton\r\n                defense={squad}\r\n                onAddCounter={() => onAddCounter(squad)}\r\n                disabled={!isOnline}\r\n              />\r\n              <button\r\n                onClick={() => setEditingSquad(squad)}\r\n                className=\"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg\"\r\n                disabled={!isOnline}\r\n              >\r\n                <Settings className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Squad Description */}\r\n          {squad.description && (\r\n            <div className=\"mt-2 text-sm text-white/60\">\r\n              {squad.description}\r\n            </div>\r\n          )}\r\n\r\n          {/* Counter List */}\r\n          <div className=\"mt-4\">\r\n            <CounterList\r\n              counters={counters.filter(c => c.targetSquad.id === squad.id)}\r\n              targetDefense={squad}\r\n              onEdit={onEditCounter}\r\n              onDelete={onDeleteCounter}\r\n            />\r\n          </div>\r\n        </div>\r\n      ))}\r\n\r\n      {/* Edit Modal */}\r\n      {editingSquad && (\r\n        <EditModal\r\n          squad={editingSquad}\r\n          counters={counters}\r\n          availableUnits={availableUnits}\r\n          onClose={() => {\r\n            setEditingSquad(null);\r\n            setError(null);\r\n          }}\r\n          onUpdate={handleUpdateSquad}\r\n          onDelete={handleDeleteSquad}\r\n          onUpdateCounter={onEditCounter}\r\n          onDeleteCounter={onDeleteCounter}\r\n          onAddCounter={onAddCounter}\r\n          isOnline={isOnline}\r\n          saving={saving}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SquadEditor;","import React, { useState } from 'react';\r\nimport { Fleet, Counter, Ship } from '@/types';\r\nimport { Settings, Plus, Trash2, X } from 'lucide-react';\r\nimport { CounterList } from './CounterList';\r\nimport { UnitImage } from '../ui/UnitImage';\r\nimport { CounterButton } from './CounterButton';\r\nimport { AlignmentDropdown } from './AlignmentDropdown';\r\nimport { normalizeId } from '@/lib/imageMapping';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { UnitSelector } from '../UnitSelector';\r\nimport { useFirebase } from '@/contexts/FirebaseContext';\r\nimport { LoadingIndicator } from '@/components/ui/LoadingIndicator';\r\nimport { Alert, AlertTitle, AlertDescription } from '../ui/alert';\r\n\r\ninterface EditModalProps {\r\n  fleet: Fleet;\r\n  counters: Counter[];\r\n  availableUnits: Ship[];\r\n  onClose: () => void;\r\n  onUpdate: (fleet: Fleet) => void;\r\n  onDelete: (id: string) => void;\r\n  onUpdateCounter: (counter: Counter) => void;\r\n  onDeleteCounter: (counterId: string) => void;\r\n  onSelectForCounter: (defense: Fleet) => void;\r\n}\r\n\r\ninterface FleetEditorProps {\r\n  fleets: Fleet[];\r\n  counters: Counter[];\r\n  availableUnits: Ship[];\r\n  onUpdate: (fleet: Fleet) => void;\r\n  onDelete: (id: string) => void;\r\n  onAddCounter: (fleet: Fleet) => void;\r\n  onEditCounter: (counter: Counter) => void;\r\n  onDeleteCounter: (counterId: string) => void;\r\n}\r\n\r\nconst EditModal: React.FC<EditModalProps> = ({\r\n  fleet,\r\n  counters,\r\n  availableUnits,\r\n  onClose,\r\n  onUpdate,\r\n  onDelete,\r\n  onUpdateCounter,\r\n  onDeleteCounter,\r\n  onSelectForCounter\r\n}) => {\r\n  const [name, setName] = useState(fleet.name);\r\n  const [callOrder, setCallOrder] = useState(fleet.callOrder || '');\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n  const [alignment, setAlignment] = useState<'light' | 'dark'>(fleet.alignment);\r\n  const [showSelector, setShowSelector] = useState(false);\r\n  const [selectorMode, setSelectorMode] = useState<'capital' | 'starting' | 'reinforcement'>('capital');\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const { isOnline } = useFirebase();\r\n\r\n  const handleSave = async () => {\r\n    if (!isOnline) {\r\n      setError('Cannot save while offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      const updatedFleet: Fleet = {\r\n        ...fleet,\r\n        name,\r\n        alignment,\r\n        id: normalizeId(name),\r\n        callOrder: callOrder.trim() || undefined\r\n      };\r\n      await onUpdate(updatedFleet);\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('Error saving fleet:', err);\r\n      setError('Failed to save fleet');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!isOnline) {\r\n      setError('Cannot delete while offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      await onDelete(fleet.id);\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('Error deleting fleet:', err);\r\n      setError('Failed to delete fleet');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleAddShip = (ship: Ship, position: 'capital' | 'starting' | 'reinforcement') => {\r\n    const normalizedShip = {\r\n      ...ship,\r\n      id: normalizeId(ship.name)\r\n    };\r\n\r\n    const updatedFleet = { ...fleet };\r\n\r\n    switch (position) {\r\n      case 'capital':\r\n        updatedFleet.capitalShip = normalizedShip;\r\n        break;\r\n      case 'starting':\r\n        if (updatedFleet.startingLineup.length < 3) {\r\n          updatedFleet.startingLineup = [...updatedFleet.startingLineup, normalizedShip];\r\n        }\r\n        break;\r\n      case 'reinforcement':\r\n        if (updatedFleet.reinforcements.length < 3) {\r\n          updatedFleet.reinforcements = [...updatedFleet.reinforcements, normalizedShip];\r\n        }\r\n        break;\r\n    }\r\n\r\n    onUpdate(updatedFleet);\r\n  };\r\n\r\n  const handleRemoveShip = (shipId: string, position: 'capital' | 'starting' | 'reinforcement') => {\r\n    const updatedFleet = { ...fleet };\r\n\r\n    switch (position) {\r\n      case 'capital':\r\n        updatedFleet.capitalShip = null;\r\n        break;\r\n      case 'starting':\r\n        updatedFleet.startingLineup = updatedFleet.startingLineup.filter(s => s.id !== shipId);\r\n        break;\r\n      case 'reinforcement':\r\n        updatedFleet.reinforcements = updatedFleet.reinforcements.filter(s => s.id !== shipId);\r\n        break;\r\n    }\r\n\r\n    onUpdate(updatedFleet);\r\n  };\r\n\r\n  const fleetCounters = counters.filter(c => c.targetSquad.id === fleet.id);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto\">\r\n      <div className=\"min-h-full w-full flex items-start justify-center py-8\">\r\n        <div className=\"relative w-full max-w-4xl mx-4 bg-space-darker rounded-lg border border-white/10\">\r\n          {/* Header */}\r\n          <div className=\"sticky top-0 z-10 flex justify-between items-center p-4 border-b border-white/10 bg-space-darker\">\r\n            <h2 className=\"text-xl font-bold text-white\">Edit Fleet</h2>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setShowDeleteConfirm(true)}\r\n                className=\"p-2 text-red-400 hover:bg-red-400/10 rounded-lg\"\r\n              >\r\n                <Trash2 className=\"w-5 h-5\" />\r\n              </button>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 text-white/60 hover:text-white hover:bg-white/5 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-6 space-y-6\">\r\n            {/* Basic Info */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-white mb-2\">\r\n                  Fleet Name\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={name}\r\n                  onChange={(e) => setName(e.target.value)}\r\n                  className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <AlignmentDropdown \r\n                  value={alignment}\r\n                  onChange={setAlignment}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Fleet Formation */}\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-white mb-4\">Fleet Formation</h3>\r\n\r\n              {/* Capital Ship */}\r\n              <div className=\"mb-6\">\r\n                <h4 className=\"text-sm font-medium text-white/60 mb-2\">Capital Ship</h4>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  {fleet.capitalShip && (\r\n                    <div className=\"relative\">\r\n                      <UnitImage\r\n                        id={fleet.capitalShip.id}\r\n                        name={fleet.capitalShip.name}\r\n                        type=\"capital-ship\"\r\n                        size=\"lg\"\r\n                        className=\"border-2 border-blue-400\"\r\n                      />\r\n                      <button\r\n                        onClick={() => handleRemoveShip(fleet.capitalShip!.id, 'capital')}\r\n                        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n                      >\r\n                        <X className=\"w-3 h-3 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                  {!fleet.capitalShip && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectorMode('capital');\r\n                        setShowSelector(true);\r\n                      }}\r\n                      className=\"w-20 h-20 rounded-lg border-2 border-dashed border-blue-500/50 flex items-center justify-center hover:border-blue-500\"\r\n                    >\r\n                      <Plus className=\"w-6 h-6 text-blue-500/50\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Starting Lineup */}\r\n              <div className=\"mb-6\">\r\n                <h4 className=\"text-sm font-medium text-white/60 mb-2\">Starting Lineup</h4>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  {fleet.startingLineup.map((ship) => (\r\n                    <div key={ship.id} className=\"relative\">\r\n                      <UnitImage\r\n                        id={ship.id}\r\n                        name={ship.name}\r\n                        type=\"ship\"\r\n                        size=\"md\"\r\n                        className=\"border-2 border-white/20\"\r\n                      />\r\n                      <button\r\n                        onClick={() => handleRemoveShip(ship.id, 'starting')}\r\n                        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n                      >\r\n                        <X className=\"w-3 h-3 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                  {fleet.startingLineup.length < 3 && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectorMode('starting');\r\n                        setShowSelector(true);\r\n                      }}\r\n                      className=\"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40\"\r\n                    >\r\n                      <Plus className=\"w-4 h-4 text-white/40\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Reinforcements */}\r\n              <div>\r\n                <h4 className=\"text-sm font-medium text-white/60 mb-2\">Reinforcements</h4>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  {fleet.reinforcements.map((ship, index) => (\r\n                    <div key={ship.id} className=\"relative\">\r\n                      <UnitImage\r\n                        id={ship.id}\r\n                        name={ship.name}\r\n                        type=\"ship\"\r\n                        size=\"md\"\r\n                        className=\"border-2 border-white/20\"\r\n                      />\r\n                      <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs\">\r\n                        {index + 1}\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handleRemoveShip(ship.id, 'reinforcement')}\r\n                        className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600\"\r\n                      >\r\n                        <X className=\"w-3 h-3 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                  {fleet.reinforcements.length < 3 && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectorMode('reinforcement');\r\n                        setShowSelector(true);\r\n                      }}\r\n                      className=\"w-16 h-16 rounded-lg border-2 border-dashed border-white/20 flex items-center justify-center hover:border-white/40\"\r\n                    >\r\n                      <Plus className=\"w-4 h-4 text-white/40\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Call Order */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white mb-2\">\r\n                Call Order\r\n              </label>\r\n              <textarea\r\n                value={callOrder}\r\n                onChange={(e) => setCallOrder(e.target.value)}\r\n                className=\"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white resize-none\"\r\n                rows={2}\r\n                placeholder=\"Enter reinforcement call order strategy...\"\r\n              />\r\n            </div>\r\n\r\n            {/* Counters */}\r\n            <div>\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"text-lg font-medium text-white\">Counters</h3>\r\n                <CounterButton\r\n                  defense={fleet}\r\n                  onAddCounter={() => onSelectForCounter(fleet)}\r\n                  disabled={!isOnline || saving}\r\n                />\r\n              </div>\r\n\r\n              <CounterList\r\n                counters={fleetCounters}\r\n                targetDefense={fleet}\r\n                onEdit={onUpdateCounter}\r\n                onDelete={onDeleteCounter}\r\n              />\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"flex justify-end gap-3 pt-4\">\r\n              <button\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleSave}\r\n                className=\"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600\"\r\n                disabled={!isOnline || saving}\r\n              >\r\n                Save Changes\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <AnimatePresence>\r\n        {showDeleteConfirm && (\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center\"\r\n          >\r\n            <motion.div\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              className=\"bg-space-darker p-6 rounded-lg max-w-md w-full mx-4 border border-white/10\"\r\n            >\r\n              <h3 className=\"text-xl font-bold text-white mb-4\">Delete Fleet</h3>\r\n              <p className=\"text-white/70 mb-6\">\r\n                Are you sure you want to delete this fleet? This action cannot be undone.\r\n              </p>\r\n              <div className=\"flex justify-end gap-3\">\r\n                <button\r\n                  onClick={() => setShowDeleteConfirm(false)}\r\n                  className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={handleDelete}\r\n                  className=\"px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600\"\r\n                  disabled={!isOnline || saving}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Unit Selector */}\r\n      {showSelector && (\r\n        <UnitSelector<Ship>\r\n          type=\"ship\"\r\n          isOpen={showSelector}\r\n          onClose={() => setShowSelector(false)}\r\n          onSelect={(ship) => {\r\n            handleAddShip(ship, selectorMode);\r\n            setShowSelector(false);\r\n          }}\r\n          availableUnits={availableUnits}\r\n          alignment={fleet.alignment}\r\n          selectionType={selectorMode}\r\n          title={`Select ${\r\n            selectorMode === 'capital' \r\n              ? 'Capital Ship' \r\n              : selectorMode === 'starting' \r\n                ? 'Starting Ship' \r\n                : 'Reinforcement'\r\n          }`}\r\n        />\r\n      )}\r\n\r\n      {saving && (\r\n        <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\r\n          <LoadingIndicator size=\"lg\" />\r\n        </div>\r\n      )}\r\n\r\n      {error && (\r\n        <Alert variant=\"destructive\">\r\n          <AlertTitle>Error</AlertTitle>\r\n          <AlertDescription className=\"flex justify-between items-center\">\r\n            {error}\r\n            <button \r\n              onClick={() => setError(null)}\r\n              className=\"ml-2 text-red-400 hover:text-red-300\"\r\n            >\r\n              <X className=\"w-4 h-4\" />\r\n            </button>\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const FleetEditor: React.FC<FleetEditorProps> = ({\r\n  fleets,\r\n  counters,\r\n  availableUnits,\r\n  onUpdate,\r\n  onDelete,\r\n  onAddCounter,\r\n  onEditCounter,\r\n  onDeleteCounter\r\n}) => {\r\n  const { isOnline, isLoading } = useFirebase();\r\n  const [editingFleet, setEditingFleet] = useState<Fleet | null>(null);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleUpdate = async (fleet: Fleet) => {\r\n    if (!isOnline) {\r\n      setError('Cannot save while offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      await onUpdate(fleet);\r\n      setError(null);\r\n    } catch (err) {\r\n      console.error('Error updating fleet:', err);\r\n      setError('Failed to update fleet');\r\n      throw err; // Re-throw to be handled by the EditModal\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center p-8\">\r\n        <LoadingIndicator size=\"lg\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {!isOnline && (\r\n        <Alert>\r\n          <AlertTitle>Offline Mode</AlertTitle>\r\n          <AlertDescription>\r\n            You are currently offline. Changes will be saved when you reconnect.\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {error && (\r\n        <Alert variant=\"destructive\">\r\n          <AlertTitle>Error</AlertTitle>\r\n          <AlertDescription className=\"flex justify-between items-center\">\r\n            {error}\r\n            <button \r\n              onClick={() => setError(null)}\r\n              className=\"ml-2 text-red-400 hover:text-red-300\"\r\n            >\r\n              <X className=\"w-4 h-4\" />\r\n            </button>\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {fleets.map((fleet) => (\r\n        <div\r\n          key={fleet.id}\r\n          className=\"p-4 rounded-lg bg-space-dark border border-white/10\"\r\n        >\r\n          <div className=\"flex justify-between items-start\">\r\n            {/* Fleet Info */}\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                {fleet.capitalShip && (\r\n                  <UnitImage\r\n                    id={fleet.capitalShip.id}\r\n                    name={fleet.capitalShip.name}\r\n                    type=\"capital-ship\"\r\n                    size=\"md\"\r\n                    className=\"border-2 border-blue-400\"\r\n                    />\r\n                  )}\r\n                  {fleet.startingLineup.map((ship) => (\r\n                    <UnitImage\r\n                      key={ship.id}\r\n                      id={ship.id}\r\n                      name={ship.name}\r\n                      type=\"ship\"\r\n                      size=\"md\"\r\n                      className=\"border-2 border-white/20\"\r\n                    />\r\n                  ))}\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"text-lg font-medium text-white\">{fleet.name}</h3>\r\n                  <span className={`inline-block px-2 py-1 rounded-full text-xs mt-1\r\n                    ${fleet.alignment === 'light' \r\n                      ? 'bg-blue-500/20 text-blue-400' \r\n                      : 'bg-red-500/20 text-red-400'\r\n                    }`}\r\n                  >\r\n                    {fleet.alignment === 'light' ? 'Light Side' : 'Dark Side'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n  \r\n              {/* Actions */}\r\n              <div className=\"flex gap-2\">\r\n                <CounterButton\r\n                  defense={fleet}\r\n                  onAddCounter={() => onAddCounter(fleet)}\r\n                  disabled={!isOnline || saving}\r\n                />\r\n                <button\r\n                  onClick={() => setEditingFleet(fleet)}\r\n                  className=\"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  disabled={!isOnline || saving}\r\n                >\r\n                  <Settings className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n  \r\n            {/* Fleet Details */}\r\n            {fleet.reinforcements.length > 0 && (\r\n              <div className=\"mt-4 border-t border-white/10 pt-4\">\r\n                <span className=\"text-sm text-white/40 block mb-2\">Reinforcements:</span>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {fleet.reinforcements.map((ship, index) => (\r\n                    <div key={ship.id} className=\"relative\">\r\n                      <UnitImage\r\n                        id={ship.id}\r\n                        name={ship.name}\r\n                        type=\"ship\"\r\n                        size=\"sm\"\r\n                        className=\"border-2 border-white/20\"\r\n                      />\r\n                      <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 rounded-full \r\n                                  flex items-center justify-center text-white text-xs\">\r\n                        {index + 1}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n  \r\n            {/* Call Order */}\r\n            {fleet.callOrder && (\r\n              <div className=\"mt-2 text-sm text-white/60\">\r\n                {fleet.callOrder}\r\n              </div>\r\n            )}\r\n  \r\n            {/* Counter List */}\r\n            <div className=\"mt-4\">\r\n              <CounterList\r\n                counters={counters.filter(c => c.targetSquad.id === fleet.id)}\r\n                targetDefense={fleet}\r\n                onEdit={onEditCounter}\r\n                onDelete={onDeleteCounter}\r\n              />\r\n            </div>\r\n          </div>\r\n        ))}\r\n  \r\n        {/* Edit Modal */}\r\n        {editingFleet && (\r\n          <EditModal\r\n            fleet={editingFleet}\r\n            counters={counters}\r\n            availableUnits={availableUnits}\r\n            onClose={() => {\r\n              setEditingFleet(null);\r\n              setError(null);\r\n            }}\r\n            onUpdate={handleUpdate}\r\n            onDelete={onDelete}\r\n            onUpdateCounter={onEditCounter}\r\n            onDeleteCounter={onDeleteCounter}\r\n            onSelectForCounter={onAddCounter}\r\n          />\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n  \r\n  export default FleetEditor;","import React, { useState, useEffect, useCallback } from 'react';\r\nimport { Database, LogOut, AlertTriangle, Users, Ship as ShipIcon, X, Settings, Plus, RefreshCw } from 'lucide-react';\r\nimport { Squad, Fleet, Counter, Character, Ship } from '@/types';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { CounterEditor } from '../Counter/CounterEditor';\r\nimport { FirebaseService } from '@/services/firebaseService';\r\nimport { useFirebase } from '@/contexts/FirebaseContext';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { NewDefenseModal } from './NewDefenseModal';\r\nimport { NotificationManager } from './NotificationManager';\r\nimport { SettingsPanel } from './SettingsPanel';\r\nimport { SyncButton } from './SyncButton';\r\nimport { SearchBar } from '@/components/SearchBar';\r\nimport { SquadEditor } from './SquadEditor';\r\nimport { FleetEditor } from './FleetEditor';\r\nimport ErrorBoundary from '../ErrorBoundary'; \r\n\r\ninterface AdminDashboardProps {\r\n  squads: Squad[];\r\n  fleets: Fleet[];\r\n  counters: Counter[];\r\n  onUpdateSquad: (squad: Squad) => void;\r\n  onDeleteSquad: (id: string) => void;\r\n  onUpdateFleet: (fleet: Fleet) => void;\r\n  onDeleteFleet: (id: string) => void;\r\n  onAddCounter: (counter: Omit<Counter, \"id\">) => Promise<void>;\r\n  onUpdateCounter: (counter: Counter) => void;\r\n  onDeleteCounter: (id: string) => void;\r\n  onLogout: () => void;\r\n}\r\n\r\ninterface ErrorDisplayProps {\r\n  error: string | null;\r\n  onDismiss: () => void;\r\n}\r\n\r\nconst ErrorDisplay: React.FC<ErrorDisplayProps> = ({ error, onDismiss }) => {\r\n  if (!error) return null;\r\n\r\n  return (\r\n    <Alert variant=\"destructive\" className=\"mb-4\">\r\n      <AlertTitle>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <AlertTriangle className=\"w-4 h-4\" />\r\n            <span>Error</span>\r\n          </div>\r\n          <button\r\n            onClick={onDismiss}\r\n            className=\"text-red-400 hover:text-red-300\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      </AlertTitle>\r\n      <AlertDescription>\r\n        {error}\r\n      </AlertDescription>\r\n    </Alert>\r\n  );\r\n};\r\n\r\ninterface AdminUser {\r\n  username: string;\r\n  password: string;\r\n  isMasterAdmin?: boolean;\r\n}\r\n\r\nexport const AdminDashboard: React.FC<AdminDashboardProps> = ({\r\n  squads,\r\n  fleets,\r\n  counters,\r\n  onUpdateSquad,\r\n  onDeleteSquad,\r\n  onUpdateFleet,\r\n  onDeleteFleet,\r\n  onAddCounter,\r\n  onDeleteCounter,\r\n  onLogout\r\n}) => {\r\n  const [activeTab, setActiveTab] = useState('squads');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showCounterEditor, setShowCounterEditor] = useState(false);\r\n  const [selectedDefense, setSelectedDefense] = useState<Squad | Fleet | null>(null);\r\n  const [availableCharacters, setAvailableCharacters] = useState<Character[]>([]);\r\n  const [availableShips, setAvailableShips] = useState<Ship[]>([]);\r\n  const [existingCounter, setExistingCounter] = useState<Counter | null>(null);\r\n  const [showNewDefenseModal, setShowNewDefenseModal] = useState(false);\r\n  const { isOnline, error: firebaseError } = useFirebase();\r\n  const { isAdmin, currentUser } = useAuth();\r\n  const [notifications, setNotifications] = useState<Array<{\r\n    id: string;\r\n    type: 'success' | 'error';\r\n    message: string;\r\n  }>>([]);\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isFleet, setIsFleet] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const loadUnits = async () => {\r\n      try {\r\n        const { characters, ships, capital_ships } = await import('@/data/initialData');\r\n        console.log('Loading initial units:', {\r\n          charactersCount: Object.keys(characters).length,\r\n          shipsCount: Object.keys(ships).length,\r\n          capitalShipsCount: Object.keys(capital_ships).length\r\n        });\r\n        \r\n        const allCharacters = Object.values(characters);\r\n        const allShips = [...Object.values(ships), ...Object.values(capital_ships)];\r\n        \r\n        setAvailableCharacters(allCharacters);\r\n        setAvailableShips(allShips);\r\n\r\n        console.log('Units loaded into state:', {\r\n          charactersLoaded: allCharacters.length,\r\n          shipsLoaded: allShips.length\r\n        });\r\n      } catch (error) {\r\n        console.error('Failed to load units:', error);\r\n        setError('Failed to load available units');\r\n      }\r\n    };\r\n    \r\n    loadUnits();\r\n  }, []);\r\n\r\n  const handleAddCounter = (defense: Squad | Fleet) => {\r\n    const isFleet = !('leader' in defense);\r\n    const units = isFleet ? availableShips : availableCharacters;\r\n    \r\n    console.log('Adding counter for:', {\r\n      defenseType: isFleet ? 'Fleet' : 'Squad',\r\n      defenseName: defense.name,\r\n      availableUnits: units.length\r\n    });\r\n  \r\n    setSelectedDefense(defense);\r\n    setIsFleet(isFleet);  // Sätt isFleet baserat på defense typ\r\n    setShowCounterEditor(true);\r\n    setError(null);\r\n  };\r\n\r\n  const handleSaveCounter = async (counterData: Omit<Counter, 'id'>) => {\r\n    if (!isOnline || !isAdmin || !currentUser) {\r\n      setError('Not authorized or offline');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      console.log('AdminDashboard: Saving counter data:', counterData);\r\n      await onAddCounter(counterData);\r\n      setShowCounterEditor(false);\r\n      setSelectedDefense(null);\r\n      setError(null);\r\n    } catch (error) {\r\n      console.error('Error saving counter:', error);\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to save counter';\r\n      setError(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleDeleteCounter = async (counterId: string) => {\r\n    try {\r\n      console.log('AdminDashboard handling delete for counter:', counterId);\r\n      await FirebaseService.deleteCounter(counterId);\r\n      onDeleteCounter(counterId);\r\n    } catch (error) {\r\n      console.error('Error deleting counter:', error);\r\n      setError('Failed to delete counter');\r\n    }\r\n  };\r\n\r\n  const addNotification = (type: 'success' | 'error', message: string) => {\r\n    const id = Date.now().toString();\r\n    setNotifications(prev => [...prev, { id, type, message }]);\r\n    setTimeout(() => {\r\n      setNotifications(prev => prev.filter(n => n.id !== id));\r\n    }, 3000);\r\n  };\r\n\r\n  const handleSaveDefense = useCallback(async (defense: Squad | Fleet) => {\r\n    // Denna funktion ska ENDAST anropas när användaren klickar på Save\r\n    try {\r\n      if (!isOnline) {\r\n        setError('Cannot save while offline');\r\n        return;\r\n      }\r\n  \r\n      if (defense.type === 'squad') {\r\n        await FirebaseService.addOrUpdateSquad(defense as Squad);\r\n        onUpdateSquad(defense as Squad);\r\n        addNotification('success', 'Squad saved successfully');\r\n      } else {\r\n        await FirebaseService.addOrUpdateFleet(defense as Fleet);\r\n        onUpdateFleet(defense as Fleet);\r\n        addNotification('success', 'Fleet saved successfully');\r\n      }\r\n  \r\n      setError(null);\r\n    } catch (error) {\r\n      console.error('Error saving defense:', error);\r\n      addNotification('error', 'Failed to save defense');\r\n    }\r\n  }, [isOnline, onUpdateSquad, onUpdateFleet]);\r\n\r\n  const handleSaveSettings = async (settings: { users: AdminUser[] }) => {\r\n    try {\r\n      localStorage.setItem('adminUsers', JSON.stringify(settings.users));\r\n      addNotification('success', 'Settings saved successfully');\r\n      setShowSettings(false);\r\n    } catch (error) {\r\n      addNotification('error', 'Failed to save settings');\r\n    }\r\n  };\r\n\r\n  const displayError = error || firebaseError;\r\n\r\n  const handleEditCounter = async (counter: Counter) => {\r\n    setSelectedDefense(counter.targetSquad);\r\n    setShowCounterEditor(true);\r\n    setExistingCounter(counter);\r\n    setError(null);\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setShowNewDefenseModal(false); // This hides the modal\r\n    // Reset any other state if necessary\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-space-darker\">\r\n      <div className=\"container mx-auto px-4 py-6\">\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-2xl font-orbitron text-white flex items-center gap-2\">\r\n            <Database className=\"w-6 h-6\" />\r\n            Defense Manager\r\n          </h1>\r\n          \r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={() => setShowNewDefenseModal(true)}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500 \r\n                       text-white hover:bg-blue-600\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n              Add New Defense\r\n            </button>\r\n            <SyncButton />\r\n            <div className=\"flex-1\" />\r\n            <button\r\n              onClick={() => setShowSettings(true)}\r\n              className=\"p-2 text-blue-400/70 hover:text-blue-400 \r\n                       hover:bg-blue-400/10 rounded-lg transition-colors\"\r\n            >\r\n              <Settings className=\"w-5 h-5\" />\r\n            </button>\r\n            <button\r\n              onClick={onLogout}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                       bg-red-500/20 text-red-400 hover:bg-red-500/30\"\r\n            >\r\n              <LogOut className=\"w-4 h-4\" />\r\n              Logout\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <ErrorDisplay \r\n          error={displayError} \r\n          onDismiss={() => setError(null)} \r\n        />\r\n\r\n        <ErrorBoundary \r\n          fallback={\r\n            <div className=\"min-h-screen bg-space-darker flex items-center justify-center\">\r\n              <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full\">\r\n                <h3 className=\"text-lg font-medium text-red-400 mb-2\">\r\n                  Admin Dashboard Error\r\n                </h3>\r\n                <p className=\"text-sm text-red-400/80 mb-4\">\r\n                  There was an error loading the admin dashboard. Please try logging in again.\r\n                </p>\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    onClick={onLogout}\r\n                    className=\"px-4 py-2 rounded-lg bg-red-500/20 text-red-400 \r\n                             hover:bg-red-500/30\"\r\n                  >\r\n                    Logout\r\n                  </button>\r\n                  <button\r\n                    onClick={() => window.location.reload()}\r\n                    className=\"flex items-center gap-2 px-4 py-2 rounded-lg \r\n                             bg-blue-500 text-white hover:bg-blue-600\"\r\n                  >\r\n                    <RefreshCw className=\"w-4 h-4\" />\r\n                    Refresh\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          }\r\n        >\r\n          {/* Tabs */}\r\n          <div className=\"flex gap-4 mb-6\">\r\n            <button\r\n              onClick={() => setActiveTab('squads')}\r\n              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${\r\n                activeTab === 'squads' \r\n                  ? 'bg-blue-500 text-white' \r\n                  : 'bg-white/5 text-white/60'\r\n              }`}\r\n            >\r\n              <Users className=\"w-4 h-4\" />\r\n              Squad Defense\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('fleets')}\r\n              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${\r\n                activeTab === 'fleets' \r\n                  ? 'bg-blue-500 text-white' \r\n                  : 'bg-white/5 text-white/60'\r\n              }`}\r\n            >\r\n              <ShipIcon className=\"w-4 h-4\" />\r\n              Fleet Defense\r\n            </button>\r\n          </div>\r\n\r\n          {/* Lägg till SearchBar under tabs */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"w-96\">\r\n              <SearchBar\r\n                value={searchTerm}\r\n                onChange={setSearchTerm}\r\n                onClear={() => setSearchTerm('')}\r\n                placeholder={`Search ${activeTab}...`}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content - uppdatera för att använda searchTerm */}\r\n          <div className=\"space-y-6\">\r\n            {activeTab === 'squads' ? (\r\n              <SquadEditor\r\n                squads={squads.filter(squad => \r\n                  squad.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n                )}\r\n                counters={counters.filter(c => 'leader' in c.targetSquad)}\r\n                availableUnits={availableCharacters}\r\n                onUpdate={onUpdateSquad}\r\n                onDelete={onDeleteSquad}\r\n                onAddCounter={handleAddCounter}\r\n                onEditCounter={handleEditCounter}\r\n                onDeleteCounter={handleDeleteCounter}\r\n              />\r\n            ) : (\r\n              <FleetEditor\r\n                fleets={fleets.filter(fleet => \r\n                  fleet.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n                )}\r\n                counters={counters.filter(c => !('leader' in c.targetSquad))}\r\n                availableUnits={availableShips}\r\n                onUpdate={onUpdateFleet}\r\n                onDelete={onDeleteFleet}\r\n                onAddCounter={handleAddCounter}\r\n                onEditCounter={handleEditCounter}\r\n                onDeleteCounter={handleDeleteCounter}\r\n              />\r\n            )}\r\n          </div>\r\n        </ErrorBoundary>\r\n\r\n        {/* Modals */}\r\n        {showCounterEditor && selectedDefense && (\r\n          <CounterEditor\r\n            isOpen={showCounterEditor}\r\n            onClose={() => {\r\n              setShowCounterEditor(false);\r\n              setSelectedDefense(null);\r\n              setExistingCounter(null);\r\n              setError(null);\r\n            }}\r\n            targetDefense={selectedDefense}\r\n            onSave={handleSaveCounter}\r\n            onDelete={handleDeleteCounter}\r\n            availableUnits={'leader' in selectedDefense ? availableCharacters : availableShips}\r\n            existingCounter={existingCounter}\r\n            isFleet={isFleet}\r\n          />\r\n        )}\r\n\r\n        {showNewDefenseModal && (\r\n          <NewDefenseModal\r\n            isOpen={showNewDefenseModal}\r\n            onClose={handleCloseModal}\r\n            onSave={handleSaveDefense}\r\n            initialType={activeTab === 'squads' ? 'squad' : 'fleet'}\r\n            availableUnits={activeTab === 'squads' ? availableCharacters : availableShips}\r\n          />\r\n        )}\r\n\r\n        {/* Settings Panel */}\r\n              {showSettings && (\r\n        <SettingsPanel\r\n          onClose={() => setShowSettings(false)}\r\n          onSave={handleSaveSettings} // handleSaveSettings måste matcha den nya typen\r\n        />\r\n      )}\r\n\r\n\r\n        {/* Notifications */}\r\n        <NotificationManager\r\n          notifications={notifications}\r\n          onDismiss={(id) => \r\n            setNotifications(prev => prev.filter(n => n.id !== id))\r\n          }\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;","import React, { useState, useEffect } from 'react';\r\nimport { Lock, User, EyeOff, Eye, AlertCircle } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\n\r\ninterface AuthProps {\r\n  onLogin: (success: boolean) => void;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const Auth: React.FC<AuthProps> = ({ onLogin, onClose }) => {\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [credentials, setCredentials] = useState({\r\n    email: '',\r\n    password: ''\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { login, error: authError } = useAuth();\r\n  const [localError, setLocalError] = useState<string | null>(null);\r\n  const [attemptCount, setAttemptCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (authError) {\r\n      setLocalError(authError);\r\n    }\r\n  }, [authError]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLocalError(null);\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (attemptCount >= 5) {\r\n        throw new Error('Too many login attempts. Please try again later.');\r\n      }\r\n\r\n      await login(credentials.email, credentials.password);\r\n      onLogin(true);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      setAttemptCount(prev => prev + 1);\r\n      setLocalError(error instanceof Error ? error.message : 'Failed to login');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\"\r\n    >\r\n      <motion.div\r\n        initial={{ scale: 0.95, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        exit={{ scale: 0.95, opacity: 0 }}\r\n        className=\"w-full max-w-md bg-space-darker rounded-lg border border-white/10\"\r\n      >\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-white mb-6\">Admin Login</h2>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"block text-sm font-medium text-white\">\r\n                Email\r\n              </label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  type=\"email\"\r\n                  value={credentials.email}\r\n                  onChange={(e) => setCredentials({ ...credentials, email: e.target.value })}\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                  placeholder=\"Enter email\"\r\n                  required\r\n                  disabled={isLoading}\r\n                />\r\n                <User className=\"absolute left-3 top-2.5 h-5 w-5 text-white/40\" />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <label className=\"block text-sm font-medium text-white\">\r\n                Password\r\n              </label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  type={showPassword ? 'text' : 'password'}\r\n                  value={credentials.password}\r\n                  onChange={(e) => setCredentials({ ...credentials, password: e.target.value })}\r\n                  className=\"w-full pl-10 pr-12 py-2 bg-white/5 border border-white/10 rounded-lg text-white\"\r\n                  placeholder=\"Enter password\"\r\n                  required\r\n                  disabled={isLoading}\r\n                />\r\n                <Lock className=\"absolute left-3 top-2.5 h-5 w-5 text-white/40\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword(!showPassword)}\r\n                  className=\"absolute right-3 top-2.5 text-white/40 hover:text-white\"\r\n                  disabled={isLoading}\r\n                >\r\n                  {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <AnimatePresence>\r\n              {localError && (\r\n                <motion.div\r\n                  initial={{ opacity: 0, y: -10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  exit={{ opacity: 0, y: -10 }}\r\n                  className=\"p-3 rounded-lg bg-red-500/10 border border-red-500/20 \r\n                           flex items-start gap-2 text-red-400 text-sm\"\r\n                >\r\n                  <AlertCircle className=\"w-5 h-5 flex-shrink-0 mt-0.5\" />\r\n                  <span>{localError}</span>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n\r\n            <div className=\"flex justify-end gap-3 pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 \r\n                         disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                disabled={isLoading}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading || attemptCount >= 5}\r\n                className=\"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 \r\n                         disabled:opacity-50 disabled:cursor-not-allowed relative\"\r\n              >\r\n                {isLoading ? (\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <motion.div\r\n                      animate={{ rotate: 360 }}\r\n                      transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\r\n                      className=\"w-4 h-4 border-2 border-white/20 border-t-white rounded-full\"\r\n                    />\r\n                    Logging in...\r\n                  </span>\r\n                ) : (\r\n                  'Login'\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            {attemptCount >= 5 && (\r\n              <motion.p\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                className=\"text-sm text-yellow-400 mt-4\"\r\n              >\r\n                Too many login attempts. Please try again later.\r\n              </motion.p>\r\n            )}\r\n          </form>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};","import React from 'react';\r\nimport { motion, HTMLMotionProps } from 'framer-motion';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface HeroSectionProps extends Omit<HTMLMotionProps<\"div\">, \"className\"> {\r\n  title?: string;\r\n  subtitle?: string;\r\n  className?: string;\r\n  withAnimation?: boolean;\r\n  onAction?: () => void;\r\n}\r\n\r\nexport const HeroSection: React.FC<HeroSectionProps> = ({\r\n  title,\r\n  subtitle,\r\n  className,\r\n  withAnimation = true,\r\n  onAction,\r\n  children,\r\n  ...motionProps\r\n}) => {\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      onAction?.();\r\n    }\r\n  };\r\n\r\n  return (\r\n      <motion.div\r\n        role=\"region\"\r\n        aria-label={title || \"Hero section\"}\r\n        aria-live=\"polite\"\r\n        tabIndex={0}\r\n        onKeyDown={handleKeyDown}\r\n        initial={withAnimation ? { opacity: 0, y: 20 } : false}\r\n        animate={withAnimation ? { opacity: 1, y: 0 } : false}\r\n        transition={{ duration: 0.5 }}\r\n        className={cn(\r\n          \"relative overflow-hidden hero-section\",  // Lägg till hero-section här\r\n          \"min-h-[300px] py-16 px-4\",               // Eventuellt annan padding för större skärmar\r\n          className\r\n        )}\r\n        {...motionProps}\r\n    >\r\n      {/* Background effects */}\r\n      <div className=\"absolute inset-0 bg-hero-pattern bg-cover sm:bg-contain bg-center animate-pulse-slow\" />\r\n      <div className=\"absolute inset-0 bg-grid-pattern bg-grid opacity-20\" />\r\n      \r\n      {/* Animated glow spots */}\r\n      <motion.div\r\n        animate={{\r\n          opacity: [0.4, 0.6, 0.4],\r\n          scale: [1, 1.1, 1.2],\r\n        }}\r\n        transition={{\r\n          duration: 4,\r\n          repeat: Infinity,\r\n          repeatType: \"reverse\",\r\n        }}\r\n        className=\"absolute inset-0 bg-glow-pattern transform-none sm:scale-110 md:scale-125\"\r\n      />\r\n      {/* Content */}\r\n      <div className=\"relative z-10 container mx-auto\">\r\n        {title && (\r\n          <motion.h1\r\n          initial={withAnimation ? { opacity: 0, y: 20 } : false}\r\n          animate={withAnimation ? { opacity: 1, y: 0 } : false}\r\n          transition={{ delay: 0.2 }}\r\n          className=\"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-orbitron text-white text-center mb-4 tracking-wider\"\r\n        >\r\n          {title}\r\n        </motion.h1>\r\n        )}\r\n        \r\n        {subtitle && (\r\n          <motion.p\r\n          initial={withAnimation ? { opacity: 0, y: 20 } : false}\r\n          animate={withAnimation ? { opacity: 1, y: 0 } : false}\r\n          transition={{ delay: 0.3 }}\r\n          className=\"text-xl sm:text-2xl lg:text-3xl text-white/80 text-center mb-8 max-w-3xl mx-auto\"\r\n        >\r\n          {subtitle}\r\n        </motion.p>\r\n        )}\r\n        \r\n        <motion.div\r\n          initial={withAnimation ? { opacity: 0, y: 20 } : false}\r\n          animate={withAnimation ? { opacity: 1, y: 0 } : false}\r\n          transition={{ delay: 0.4 }}\r\n        >\r\n          {children}\r\n        </motion.div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};","import React, { createContext, useContext, useState, useCallback } from 'react';\r\nimport { Squad, Fleet, Counter } from '@/types';\r\nimport { useFirebase } from '@/contexts/FirebaseContext';\r\nimport { FirebaseService } from '@/services/firebaseService';\r\n\r\ninterface CounterState {\r\n  showEditor: boolean;\r\n  targetDefense: Squad | Fleet | null;\r\n  editingCounter: Counter | null;\r\n}\r\n\r\ninterface CounterContextType {\r\n  state: CounterState;\r\n  updateState: (updates: Partial<CounterState>) => void;\r\n  resetState: () => void;\r\n  updateCounter: (counter: Counter) => Promise<void>;\r\n}\r\n\r\nconst initialState: CounterState = {\r\n  showEditor: false,\r\n  targetDefense: null,\r\n  editingCounter: null\r\n};\r\n\r\nconst CounterContext = createContext<CounterContextType | undefined>(undefined);\r\n\r\nexport const CounterProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [state, setState] = useState<CounterState>(initialState);\r\n  const { isOnline } = useFirebase();\r\n\r\n  const updateState = useCallback((updates: Partial<CounterState>) => {\r\n    setState(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  const resetState = useCallback(() => {\r\n    setState(initialState);\r\n  }, []);\r\n\r\n  const updateCounter = useCallback(async (counter: Counter) => {\r\n    if (!isOnline) {\r\n      throw new Error('Cannot update counter while offline');\r\n    }\r\n    \r\n    try {\r\n      // Implementera Firebase counter update logic\r\n      await FirebaseService.addOrUpdateCounter(counter);  // Använder counter parametern\r\n      \r\n      // Uppdatera lokalt state om det behövs\r\n      setState(prev => ({\r\n        ...prev,\r\n        editingCounter: null // Reset editing state efter uppdatering\r\n      }));\r\n\r\n    } catch (error) {\r\n      console.error('Failed to update counter:', error);\r\n      throw error;\r\n    }\r\n  }, [isOnline]);\r\n\r\n  return (\r\n    <CounterContext.Provider value={{ state, updateState, resetState, updateCounter }}>\r\n      {children}\r\n    </CounterContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useCounter = () => {\r\n  const context = useContext(CounterContext);\r\n  if (context === undefined) {\r\n    throw new Error('useCounter must be used within a CounterProvider');\r\n  }\r\n  return context;\r\n};","import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\ntype Theme = 'dark' | 'light';\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  toggleTheme: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | null>(null);\r\n\r\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\r\n  const [theme, setTheme] = useState<Theme>(() => {\r\n    const saved = localStorage.getItem('theme');\r\n    return (saved as Theme) || 'dark';\r\n  });\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('theme', theme);\r\n    document.documentElement.classList.toggle('light-theme', theme === 'light');\r\n    document.documentElement.classList.toggle('dark-theme', theme === 'dark');\r\n  }, [theme]);\r\n\r\n  const toggleTheme = () => {\r\n    setTheme(current => current === 'dark' ? 'light' : 'dark');\r\n  };\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (!context) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  return context;\r\n}","import React, { useState, useEffect, useCallback } from 'react';\nimport { Squad, Fleet, Counter, Filters, FilterKey } from '@/types';\nimport { Header } from '@/components/Header';\nimport { SearchPanel } from '@/components/SearchPanel';\nimport { SquadList } from '@/components/SquadList';\nimport { FleetList } from '@/components/FleetList';\nimport { FiltersMenu } from '@/components/filters/FiltersMenu';\nimport { AdminDashboard } from '@/components/admin/AdminDashboard';\nimport { Auth } from '@/components/Auth';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { HeroSection } from '@/components/layouts/HeroSection';\nimport { AuthProvider, useAuth } from '@/contexts/AuthContext';\nimport { FirebaseService } from '@/services/firebaseService'; \nimport { CounterProvider } from '@/contexts/CounterContext';\nimport { FirebaseProvider, useFirebase } from '@/contexts/FirebaseContext';\nimport { LoadingIndicator } from '@/components/ui/LoadingIndicator';\nimport { ThemeProvider } from '@/contexts/ThemeContext';\nimport { SearchBar } from '@/components/SearchBar';\nimport ErrorBoundary from './components/ErrorBoundary';\nimport { AlertTriangle, RefreshCw } from 'lucide-react';\nimport { ensureFirebaseInitialized } from '@/lib/firebase';\nimport { Helmet } from 'react-helmet';\n\n// I App.tsx\nconst App: React.FC = () => {\n  const currentView = 'Squads';\n\n  return (\n    <>\n      <Helmet>\n        <title>{`SWGOH TW Counters - ${currentView}`}</title>\n        <meta name=\"description\" content={`View ${currentView} counters for SWGOH Territory Wars`} />\n        <meta property=\"og:title\" content={`SWGOH TW Counters - ${currentView}`} />\n        <meta property=\"og:description\" content={`View ${currentView} counters for SWGOH Territory Wars`} />\n      </Helmet>\n      <ErrorBoundary \n        fallback={\n          <div className=\"min-h-screen bg-space-darker flex items-center justify-center\">\n            <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full text-center\">\n              <AlertTriangle className=\"w-12 h-12 text-red-400 mx-auto mb-4\" />\n              <h3 className=\"text-xl font-medium text-red-400 mb-2\">\n                Application Error\n              </h3>\n              <p className=\"text-sm text-red-400/80 mb-6\">\n                We apologize, but something went wrong with the application. \n                Please try refreshing the page.\n              </p>\n              <button\n                onClick={() => window.location.reload()}\n                className=\"flex items-center gap-2 px-6 py-3 rounded-lg \n                         bg-red-500/20 text-red-400 hover:bg-red-500/30 mx-auto\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Reload Application\n              </button>\n            </div>\n          </div>\n        }\n      >\n        <FirebaseProvider>\n          <AuthProvider>\n            <ThemeProvider>\n              <CounterProvider>\n                <AppContent />\n              </CounterProvider>\n            </ThemeProvider>\n          </AuthProvider>\n        </FirebaseProvider>\n      </ErrorBoundary>\n    </>\n  );\n}\n\nfunction filterUnits(units: Squad[] | Fleet[], filters: Filters): (Squad | Fleet)[] {\n  if (!Array.isArray(units)) return [];\n  \n  return units.filter(unit => {\n    // Search filter\n    if (filters.searchTerm) {\n      const searchLower = filters.searchTerm.toLowerCase();\n      const nameMatch = unit.name.toLowerCase().includes(searchLower);\n      \n      if ('characters' in unit) {\n        const characterMatch = unit.characters.some(char => \n          char.name.toLowerCase().includes(searchLower)\n        );\n        const leaderMatch = unit.leader && unit.leader.name.toLowerCase().includes(searchLower);\n        \n        if (!nameMatch && !characterMatch && !leaderMatch) return false;\n      } else if (!nameMatch) {\n        return false;\n      }\n    }\n\n    // Alignment filter\n    if (filters.alignment && unit.alignment !== filters.alignment) {\n      return false;\n    }\n\n    // TW Omicron filter\n    if (filters.showTWOmicronOnly && 'twOmicronRequired' in unit && !unit.twOmicronRequired) {\n      return false;\n    }\n\n    // GL filter\n    if (filters.excludeGL && 'characters' in unit) {\n      const hasGL = unit.characters.some(char => char.isGalacticLegend) || \n                   (unit.leader && unit.leader.isGalacticLegend);\n      if (hasGL) return false;\n    }\n\n    return true;\n  });\n}\n\nfunction AppContent() {\n  const [error, setError] = useState<string | null>(null);\n  const { isOnline, isLoading: firebaseLoading } = useFirebase();\n  const { isAdmin, loading: authLoading, logout } = useAuth();\n  const [showAdminLogin, setShowAdminLogin] = useState(false);\n  const [activeView, setActiveView] = useState<'squads' | 'fleets'>('squads');\n  const [squads, setSquads] = useState<Squad[]>([]);\n  const [fleets, setFleets] = useState<Fleet[]>([]);\n  const [counters, setCounters] = useState<Counter[]>([]);\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n\n  // Filter state\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isFiltersOpen, setFiltersOpen] = useState(false);\n  const [filters, setFilters] = useState<Filters>({\n    battleType: null,\n    alignment: null,\n    showTWOmicronOnly: false,\n    showHardCounters: false,\n    excludeGL: false,\n    searchTerm: ''\n  });\n\n  // Load initial data\n  useEffect(() => {\n    const initializeApp = async () => {\n      setIsLoading(true);\n      setError(null);\n      \n      try {\n        // Vänta på Firebase-initialisering\n        await ensureFirebaseInitialized();\n        \n        // Hämta all data parallellt\n        const { squads, fleets, counters } = await FirebaseService.syncAllData();\n        \n        setSquads(squads);\n        setFleets(fleets);\n        setCounters(counters);\n        setHasUnsavedChanges(false);\n      } catch (error) {\n        console.error('Failed to initialize app:', error);\n        setError('Failed to load application data. Please try again.');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    initializeApp();\n  }, []);\n\n  // Filter the units based on current filters\n  const filteredSquads = activeView === 'squads' ? filterUnits(squads, filters) as Squad[] : [];\n  const filteredFleets = activeView === 'fleets' ? filterUnits(fleets, filters) as Fleet[] : [];\n\n  // Get counters for a specific unit\n  const getCountersForUnit = useCallback((unitId: string, type: 'squad' | 'fleet'): Counter[] => {\n    if (!counters || !unitId) return [];\n    \n    return counters.filter(counter => {\n      if (type === 'squad') {\n        const isTargetSquad = counter?.targetSquad?.id === unitId;\n        const isCounterSquad = counter?.counterSquad?.id === unitId;\n        return isTargetSquad || isCounterSquad;\n      } else {\n        const isTargetFleet = counter?.targetSquad?.id === unitId;\n        const isCounterFleet = counter?.counterSquad?.id === unitId;\n        const isTargetCapitalShip = 'capitalShip' in counter.targetSquad && \n          counter.targetSquad.capitalShip?.id === unitId;\n        \n        return isTargetFleet || isCounterFleet || isTargetCapitalShip;\n      }\n    });\n  }, [counters]);\n\n  // Save data when it changes\n  useEffect(() => {\n    if (!isLoading && hasUnsavedChanges) {\n      const saveData = async () => {\n        try {\n          await Promise.all([\n            ...squads.map(squad => FirebaseService.addOrUpdateSquad(squad)),\n            ...fleets.map(fleet => FirebaseService.addOrUpdateFleet(fleet)),\n            ...counters.map(counter => FirebaseService.addOrUpdateCounter(counter))\n          ]);\n          \n          setHasUnsavedChanges(false);\n        } catch (error) {\n          console.error('Error saving data:', error);\n        }\n      };\n\n      saveData();\n    }\n  }, [squads, fleets, counters, isLoading, hasUnsavedChanges]);\n\n  // Handle unsaved changes\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (hasUnsavedChanges) {\n        e.preventDefault();\n        e.returnValue = '';\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [hasUnsavedChanges]);\n\n  // Admin handlers\n  const handleAdminLogin = () => {\n    setShowAdminLogin(false);\n  };\n\n  const handleAdminLogout = async () => {\n    try {\n      if (hasUnsavedChanges) {\n        const confirmLogout = window.confirm('Du har osparade ändringar. Vill du verkligen logga ut?');\n        if (!confirmLogout) return;\n      }\n      await logout();\n      setShowAdminLogin(false);\n    } catch (error) {\n      console.error('Error logging out:', error);\n    }\n  };\n\n  // Filter handlers\n  const handleFilterChange = (key: FilterKey, value: Filters[FilterKey]) => {\n    setFilters(prev => ({\n      ...prev,\n      [key]: value\n    }));\n    setSelectedId(null);\n  };\n\n  // Search handler\n  const handleSearchChange = (value: string) => {\n    setSearchTerm(value);\n    setFilters(prev => ({\n      ...prev,\n      searchTerm: value\n    }));\n  };\n\n  const handleDeleteCounter = async (counterId: string) => {\n    if (!isOnline) {\n      setError('Cannot delete counter while offline');\n      return;\n    }\n  \n    try {\n      console.log('Starting delete counter process for:', counterId);\n      await FirebaseService.deleteCounter(counterId);\n      \n      // Update local state regardless of whether the counter existed in Firebase\n      setCounters(prevCounters => prevCounters.filter(c => c.id !== counterId));\n      console.log('Counter removed from local state');\n      \n      // Clear any existing error\n      setError(null);\n    } catch (error) {\n      console.error('Error deleting counter:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Failed to delete counter';\n      // Don't set error state if counter was already deleted\n      if (errorMessage !== 'Counter not found') {\n        setError(errorMessage);\n      }\n    }\n  };\n\n  const adminHandlers = {\n    onUpdateSquad: async (squad: Squad) => {\n      try {\n        await FirebaseService.addOrUpdateSquad(squad);\n        setSquads(prev => {\n          const index = prev.findIndex(s => s.id === squad.id);\n          if (index >= 0) {\n            const newSquads = [...prev];\n            newSquads[index] = squad;\n            return newSquads;\n          }\n          return [...prev, squad];\n        });\n      } catch (error) {\n        console.error('Error updating squad:', error);\n      }\n    },\n\n\n    onDeleteSquad: async (id: string) => {\n      if (!isOnline) {\n        setError('Cannot delete while offline');\n        return;\n      }\n  \n      try {\n        // Först ta bort alla relaterade counters\n        const relatedCounters = counters.filter(c => \n          (c?.targetSquad?.id === id || c?.counterSquad?.id === id) && c?.id\n        );\n        \n        // Ta bort counters först\n        await Promise.all(\n          relatedCounters.map(counter => \n            FirebaseService.deleteCounter(counter.id)\n          )\n        );\n  \n        // Sedan ta bort squad\n        await FirebaseService.deleteSquad(id);\n  \n        // Uppdatera local state\n        setCounters(prev => \n          prev.filter(c => \n            c?.targetSquad?.id !== id && c?.counterSquad?.id !== id\n          )\n        );\n        setSquads(prev => prev.filter(s => s.id !== id));\n        \n      } catch (error) {\n        console.error('Error deleting squad:', error);\n        setError('Failed to delete squad and its counters');\n      }\n    },\n\n    onUpdateFleet: async (fleet: Fleet) => {\n      try {\n        await FirebaseService.addOrUpdateFleet(fleet);\n        setFleets(prev => {\n          const index = prev.findIndex(f => f.id === fleet.id);\n          if (index >= 0) {\n            const newFleets = [...prev];\n            newFleets[index] = fleet;\n            return newFleets;\n          }\n          return [...prev, fleet];\n        });\n      } catch (error) {\n        console.error('Error updating fleet:', error);\n      }\n    },\n\n    onDeleteFleet: async (id: string) => {\n      if (!isOnline) {\n        setError('Cannot delete while offline');\n        return;\n      }\n  \n      try {\n        // Först ta bort alla relaterade counters\n        const relatedCounters = counters.filter(c => \n          (c?.targetSquad?.id === id || \n           c?.counterSquad?.id === id || \n           (c?.targetSquad && 'capitalShip' in c.targetSquad && c.targetSquad.capitalShip?.id === id)) && \n           c?.id\n        );\n        \n        // Ta bort counters först\n        await Promise.all(\n          relatedCounters.map(counter => \n            FirebaseService.deleteCounter(counter.id)\n          )\n        );\n  \n        // Sedan ta bort fleet\n        await FirebaseService.deleteFleet(id);\n  \n        // Uppdatera local state\n        setCounters(prev => \n          prev.filter(c => \n            c?.targetSquad?.id !== id && \n            c?.counterSquad?.id !== id &&\n            !('capitalShip' in c?.targetSquad && c.targetSquad.capitalShip?.id === id)\n          )\n        );\n        setFleets(prev => prev.filter(f => f.id !== id));\n        \n      } catch (error) {\n        console.error('Error deleting fleet:', error);\n        setError('Failed to delete fleet and its counters');\n      }\n    },\n\n    onAddCounter: async (counter: Omit<Counter, \"id\">) => {\n      try {\n        const newCounter: Counter = {\n          ...counter,\n          id: `counter-${Date.now()}`\n        };\n        // Save to Firebase first\n        const savedCounter = await FirebaseService.addOrUpdateCounter(newCounter);\n        // Update local state with the saved version\n        setCounters(prevCounters => prevCounters.filter(c => c.id !== savedCounter.id).concat(savedCounter));\n      } catch (error) {\n        console.error('Error adding counter:', error);\n      }\n    },\n\n    onDeleteCounter: async (counterId: string) => {\n      if (!isOnline) {\n        setError('Cannot delete counter while offline');\n        return;\n      }\n\n      try {\n        console.log('Starting delete counter process for:', counterId);\n        await FirebaseService.deleteCounter(counterId);\n        \n        // Uppdatera lokalt state efter lyckad borttagning\n        setCounters(prevCounters => prevCounters.filter(c => c.id !== counterId));\n        console.log('Counter deleted and state updated');\n      } catch (error) {\n        console.error('Error deleting counter:', error);\n        const errorMessage = error instanceof Error ? error.message : 'Failed to delete counter';\n        setError(errorMessage);\n      }\n    },\n\n    onUpdateCounter: async (counter: Counter) => {\n      try {\n        await FirebaseService.addOrUpdateCounter(counter);\n        setCounters(prev => {\n          const index = prev.findIndex(c => c.id === counter.id);\n          if (index >= 0) {\n            const newCounters = [...prev];\n            newCounters[index] = counter;\n            return newCounters;\n          }\n          return prev;\n        });\n      } catch (error) {\n        console.error('Error updating counter:', error);\n      }\n    },\n  };\n\n  // Combined loading state\n// I App.tsx\n// Under combined loading state\nif (firebaseLoading || authLoading || isLoading) {\n  return (\n    <div className=\"min-h-screen bg-space-black flex items-center justify-center\">\n      <LoadingIndicator \n        size=\"lg\"\n        message=\"Loading application data...\"\n      />\n    </div>\n  );\n}\n\n  // Error handling\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-space-black flex items-center justify-center\">\n        <div className=\"p-6 bg-red-500/10 rounded-lg border border-red-500/20 max-w-md w-full text-center\">\n          <AlertTriangle className=\"w-12 h-12 text-red-400 mx-auto mb-4\" />\n          <h3 className=\"text-xl font-medium text-red-400 mb-2\">\n            Application Error\n          </h3>\n          <p className=\"text-sm text-red-400/80 mb-6\">\n            {error}\n          </p>\n          <button\n            onClick={() => window.location.reload()}\n            className=\"flex items-center gap-2 px-6 py-3 rounded-lg \n                     bg-red-500/20 text-red-400 hover:bg-red-500/30 mx-auto\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            Retry Loading\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-space-black text-white\">\n      {!isOnline && (\n        <div className=\"fixed top-0 left-0 right-0 bg-yellow-500/90 text-black py-2 px-4 text-center z-50\">\n          Du är offline. Ändringar kommer att synkroniseras när du återansluter.\n        </div>\n      )}\n      <div className=\"min-h-screen bg-space-gradient bg-fixed\">\n        <AnimatePresence mode=\"wait\">\n          {!isAdmin ? (\n            <motion.div\n              key=\"user-interface\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <Header \n                isAdmin={isAdmin}\n                onAdminClick={() => setShowAdminLogin(true)}\n                onLogout={handleAdminLogout}\n              />\n\n              <HeroSection\n                title=\"SWGOH Territory Wars\"\n                subtitle=\"Find the perfect counter for any squad or fleet\"\n              >\n                <SearchPanel\n                  activeView={activeView}\n                  onViewChange={setActiveView}\n                  onOptionsClick={() => setFiltersOpen(true)}\n                  filters={filters}\n                >\n                  <SearchBar\n                    value={searchTerm}\n                    onChange={handleSearchChange}\n                    onClear={() => handleSearchChange('')}\n                    suggestions={activeView === 'squads' ? filteredSquads : filteredFleets}\n                    onSelectSuggestion={(item) => {\n                      setSelectedId(item.id);\n                      handleSearchChange('');\n                    }}\n                    placeholder={`Search ${activeView === 'squads' ? 'teams' : 'fleets'}...`}\n                  />\n                </SearchPanel>\n              </HeroSection>\n\n              <main className=\"container mx-auto px-4 py-8\">\n                <AnimatePresence mode=\"wait\">\n                  {isLoading ? (\n                    <motion.div\n                      key=\"loading\"\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      exit={{ opacity: 0 }}\n                      className=\"flex justify-center items-center min-h-[400px]\"\n                    >\n                      <motion.div\n                        animate={{ rotate: 360 }}\n                        transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                        className=\"w-12 h-12 border-4 border-saber-blue-400/50 border-t-saber-blue-400 rounded-full\"\n                      />\n                    </motion.div>\n                  ) : (\n                    <motion.div\n                      key={`content-${activeView}`}\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      exit={{ opacity: 0 }}\n                    >\n                      {activeView === 'squads' ? (\n                        <SquadList\n                          squads={squads}\n                          filteredSquads={filteredSquads}\n                          selectedSquadId={selectedId}\n                          onSelectSquad={setSelectedId}\n                          getCounters={(id) => getCountersForUnit(id, 'squad')}\n                          isAdmin={isAdmin}\n                          onDeleteCounter={handleDeleteCounter}\n                          onViewDetails={() => {}}\n                        />\n                      ) : (\n                        <FleetList\n                          fleets={fleets}\n                          filteredFleets={filteredFleets}\n                          selectedFleetId={selectedId}\n                          onSelectFleet={setSelectedId}\n                          getCounters={(id) => getCountersForUnit(id, 'fleet')}\n                          isAdmin={isAdmin}\n                          onDeleteCounter={handleDeleteCounter}\n                          onViewDetails={() => {}}\n                        />\n                      )}\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </main>\n\n              <FiltersMenu\n                isOpen={isFiltersOpen}\n                onClose={() => setFiltersOpen(false)}\n                filters={filters}\n                onFilterChange={handleFilterChange}\n              />\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"admin-interface\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <AdminDashboard\n                squads={squads}\n                fleets={fleets}\n                counters={counters}\n                {...adminHandlers}\n                onLogout={handleAdminLogout}\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {showAdminLogin && (\n          <Auth\n            onLogin={handleAdminLogin}\n            onClose={() => setShowAdminLogin(false)}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default App;","import { StrictMode } from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\nimport App from './App.tsx';\r\nimport './index.css';\r\nimport { AuthProvider } from './contexts/AuthContext';\r\n\r\ncreateRoot(document.getElementById('root')!).render(\r\n  <StrictMode>\r\n    <AuthProvider>\r\n      <App />\r\n    </AuthProvider>\r\n  </StrictMode>\r\n);"],"file":"assets/index-CNhLMpj-.js"}